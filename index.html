<!DOCTYPE html>
<html>

  <head>
    <meta charset='utf-8'>
    <meta http-equiv="X-UA-Compatible" content="chrome=1">
    <meta name="description" content="wewut-code : ">

    <link rel="stylesheet" type="text/css" media="screen" href="stylesheets/stylesheet.css">

    <title>wewut-code</title>
  </head>

  <body>

    <!-- HEADER -->
    <div id="header_wrap" class="outer">
        <header class="inner">
          <a id="forkme_banner" href="https://github.com/jaycfields/wewut-code">View on GitHub</a>

          <h1 id="project_title">wewut-code</h1>
          <h2 id="project_tagline"></h2>

            <section id="downloads">
              <a class="zip_download_link" href="https://github.com/jaycfields/wewut-code/zipball/master">Download this project as a .zip file</a>
              <a class="tar_download_link" href="https://github.com/jaycfields/wewut-code/tarball/master">Download this project as a tar.gz file</a>
            </section>
        </header>
    </div>

    <!-- MAIN CONTENT -->
    <div id="main_content_wrap" class="outer">
      <section id="main_content" class="inner">
        <h1>
<a id="code-examples-for-working-effectively-with-unit-tests" class="anchor" href="#code-examples-for-working-effectively-with-unit-tests" aria-hidden="true"><span class="octicon octicon-link"></span></a>Code Examples for <a href="http://wewut.com/">Working Effectively with Unit Tests</a>
</h1>

<h1>
<a id="acknowledgments" class="anchor" href="#acknowledgments" aria-hidden="true"><span class="octicon octicon-link"></span></a>Acknowledgments</h1>

<h1>
<a id="unit-testing-a-first-example" class="anchor" href="#unit-testing-a-first-example" aria-hidden="true"><span class="octicon octicon-link"></span></a>Unit Testing, a First Example</h1>

<div class="highlight highlight-java"><pre><span class="pl-s">public</span> <span class="pl-s">class</span> <span class="pl-en">CustomerTest</span> {
  <span class="pl-stj">Customer</span> john, steve, pat, david;
  <span class="pl-stj">String</span> johnName <span class="pl-k">=</span> <span class="pl-s1"><span class="pl-pds">"</span>John<span class="pl-pds">"</span></span>,
    steveName <span class="pl-k">=</span> <span class="pl-s1"><span class="pl-pds">"</span>Steve<span class="pl-pds">"</span></span>,
    patName <span class="pl-k">=</span> <span class="pl-s1"><span class="pl-pds">"</span>Pat<span class="pl-pds">"</span></span>,
    davidName <span class="pl-k">=</span> <span class="pl-s1"><span class="pl-pds">"</span>David<span class="pl-pds">"</span></span>;
  <span class="pl-st">Customer</span>[] customers;

  <span class="pl-st">@Before</span>
  <span class="pl-s">public</span> <span class="pl-st">void</span> <span class="pl-en">setup</span>() {
    david <span class="pl-k">=</span> <span class="pl-stj">ObjectMother</span>
      .customerWithNoRentals(
        davidName);
    john <span class="pl-k">=</span> <span class="pl-stj">ObjectMother</span>
      .customerWithOneNewRelease(
        johnName);
    pat <span class="pl-k">=</span> <span class="pl-stj">ObjectMother</span>
      .customerWithOneOfEachRentalType(
        patName);
    steve <span class="pl-k">=</span> <span class="pl-stj">ObjectMother</span>
      .customerWithOneNewReleaseAndOneRegular(
        steveName);
    customers <span class="pl-k">=</span>
      <span class="pl-k">new</span> <span class="pl-stj">Customer</span>[]
      { david, john, steve, pat};
  }</pre></div>

<div class="highlight highlight-java"><pre>  @<span class="pl-stj">Test</span>
  <span class="pl-s">public</span> <span class="pl-st">void</span> getName() {
    assertEquals(
      davidName, david<span class="pl-k">.</span>getName());
    assertEquals(
      johnName, john<span class="pl-k">.</span>getName());
    assertEquals(
      steveName, steve<span class="pl-k">.</span>getName());
    assertEquals(
      patName, pat<span class="pl-k">.</span>getName());
  }

  @<span class="pl-stj">Test</span>
  <span class="pl-s">public</span> <span class="pl-st">void</span> statement() {
    <span class="pl-k">for</span> (<span class="pl-st">int</span> i<span class="pl-k">=</span><span class="pl-c1">0</span>; i<span class="pl-k">&lt;</span>customers<span class="pl-k">.</span>length; i<span class="pl-k">++</span>) {
      assertEquals(
        expStatement(
          <span class="pl-s1"><span class="pl-pds">"</span>Rental record for %s<span class="pl-cce">\n</span><span class="pl-pds">"</span></span> <span class="pl-k">+</span>
          <span class="pl-s1"><span class="pl-pds">"</span>%sAmount owed is %s<span class="pl-cce">\n</span><span class="pl-pds">"</span></span>  <span class="pl-k">+</span>
          <span class="pl-s1"><span class="pl-pds">"</span>You earned %s frequent <span class="pl-pds">"</span></span> <span class="pl-k">+</span>
          <span class="pl-s1"><span class="pl-pds">"</span>renter points<span class="pl-pds">"</span></span>,
          customers[i],
          rentalInfo(
            <span class="pl-s1"><span class="pl-pds">"</span><span class="pl-cce">\t</span><span class="pl-pds">"</span></span>, <span class="pl-s1"><span class="pl-pds">"</span><span class="pl-pds">"</span></span>,
            customers[i]<span class="pl-k">.</span>getRentals())),
        customers[i]<span class="pl-k">.</span>statement());
    }
  }</pre></div>

<div class="highlight highlight-java"><pre>  @<span class="pl-stj">Test</span>
  <span class="pl-s">public</span> <span class="pl-st">void</span> htmlStatement() {
    <span class="pl-k">for</span> (<span class="pl-st">int</span> i<span class="pl-k">=</span><span class="pl-c1">0</span>; i<span class="pl-k">&lt;</span>customers<span class="pl-k">.</span>length; i<span class="pl-k">++</span>) {
      assertEquals(
        expStatement(
          <span class="pl-s1"><span class="pl-pds">"</span>&lt;h1&gt;Rental record for <span class="pl-pds">"</span></span> <span class="pl-k">+</span>
          <span class="pl-s1"><span class="pl-pds">"</span>&lt;em&gt;%s&lt;/em&gt;&lt;/h1&gt;<span class="pl-cce">\n</span>%s<span class="pl-pds">"</span></span> <span class="pl-k">+</span>
          <span class="pl-s1"><span class="pl-pds">"</span>&lt;p&gt;Amount owed is &lt;em&gt;%s&lt;/em&gt;<span class="pl-pds">"</span></span> <span class="pl-k">+</span>
          <span class="pl-s1"><span class="pl-pds">"</span>&lt;/p&gt;<span class="pl-cce">\n</span>&lt;p&gt;You earned &lt;em&gt;%s<span class="pl-pds">"</span></span> <span class="pl-k">+</span>
          <span class="pl-s1"><span class="pl-pds">"</span> frequent renter points&lt;/em&gt;&lt;/p&gt;<span class="pl-pds">"</span></span>,
          customers[i],
          rentalInfo(
            <span class="pl-s1"><span class="pl-pds">"</span>&lt;p&gt;<span class="pl-pds">"</span></span>, <span class="pl-s1"><span class="pl-pds">"</span>&lt;/p&gt;<span class="pl-pds">"</span></span>,
            customers[i]<span class="pl-k">.</span>getRentals())),
        customers[i]<span class="pl-k">.</span>htmlStatement());
    }
  }

  @<span class="pl-stj">Test</span>
  (expected<span class="pl-k">=</span><span class="pl-stj">IllegalArgumentException</span><span class="pl-k">.</span>class)
  <span class="pl-s">public</span> <span class="pl-st">void</span> invalidTitle() {
    <span class="pl-stj">ObjectMother</span>
      .customerWithNoRentals(<span class="pl-s1"><span class="pl-pds">"</span>Bob<span class="pl-pds">"</span></span>)
      .addRental(
        <span class="pl-k">new</span> <span class="pl-stj">Rental</span>(
          <span class="pl-k">new</span> <span class="pl-stj">Movie</span>(<span class="pl-s1"><span class="pl-pds">"</span>Crazy, Stupid, Love.<span class="pl-pds">"</span></span>,
                    <span class="pl-stj">Movie</span><span class="pl-k">.</span><span class="pl-stj">Type</span><span class="pl-c1"><span class="pl-k">.</span>UNKNOWN</span>),
          <span class="pl-c1">4</span>));
  }</pre></div>

<div class="highlight highlight-java"><pre>  <span class="pl-s">public</span> <span class="pl-s">static</span> <span class="pl-stj">String</span> rentalInfo(
    <span class="pl-stj">String</span> startsWith,
    <span class="pl-stj">String</span> endsWith,
    <span class="pl-st">List&lt;<span class="pl-stj">Rental</span>&gt;</span> rentals) {
    <span class="pl-stj">String</span> result <span class="pl-k">=</span> <span class="pl-s1"><span class="pl-pds">"</span><span class="pl-pds">"</span></span>;
    <span class="pl-k">for</span> (<span class="pl-stj">Rental</span> rental <span class="pl-k">:</span> rentals)
      result <span class="pl-k">+=</span> <span class="pl-stj">String</span><span class="pl-k">.</span>format(
        <span class="pl-s1"><span class="pl-pds">"</span>%s%s<span class="pl-cce">\t</span>%s%s<span class="pl-cce">\n</span><span class="pl-pds">"</span></span>,
        startsWith,
        rental<span class="pl-k">.</span>getMovie()<span class="pl-k">.</span>getTitle(),
        rental<span class="pl-k">.</span>getCharge(),
        endsWith);
    <span class="pl-k">return</span> result;
  }

  <span class="pl-s">public</span> <span class="pl-s">static</span> <span class="pl-stj">String</span> expStatement(
    <span class="pl-stj">String</span> formatStr,
    <span class="pl-stj">Customer</span> customer,
    <span class="pl-stj">String</span> rentalInfo) {
    <span class="pl-k">return</span> <span class="pl-stj">String</span><span class="pl-k">.</span>format(
      formatStr,
      customer<span class="pl-k">.</span>getName(),
      rentalInfo,
      customer<span class="pl-k">.</span>getTotalCharge(),
      customer<span class="pl-k">.</span>getTotalPoints());
  }
}</pre></div>

<div class="highlight highlight-java"><pre><span class="pl-s">public</span> <span class="pl-s">class</span> <span class="pl-en">ObjectMother</span> {
  <span class="pl-s">public</span> <span class="pl-s">static</span> <span class="pl-stj">Customer</span>
  customerWithOneOfEachRentalType(
    <span class="pl-stj">String</span> name) {
    <span class="pl-stj">Customer</span> result <span class="pl-k">=</span>
      customerWithOneNewReleaseAndOneRegular(
        name);
    result<span class="pl-k">.</span>addRental(
      <span class="pl-k">new</span> <span class="pl-stj">Rental</span>(
        <span class="pl-k">new</span> <span class="pl-stj">Movie</span>(<span class="pl-s1"><span class="pl-pds">"</span>Lion King<span class="pl-pds">"</span></span>, <span class="pl-c1">CHILDREN</span>), <span class="pl-c1">3</span>));
    <span class="pl-k">return</span> result;
  }

  <span class="pl-s">public</span> <span class="pl-s">static</span> <span class="pl-stj">Customer</span>
  customerWithOneNewReleaseAndOneRegular(
    <span class="pl-stj">String</span> n) {
    <span class="pl-stj">Customer</span> result <span class="pl-k">=</span>
      customerWithOneNewRelease(n);
    result<span class="pl-k">.</span>addRental(
      <span class="pl-k">new</span> <span class="pl-stj">Rental</span>(
        <span class="pl-k">new</span> <span class="pl-stj">Movie</span>(<span class="pl-s1"><span class="pl-pds">"</span>Scarface<span class="pl-pds">"</span></span>, <span class="pl-c1">REGULAR</span>), <span class="pl-c1">3</span>));
    <span class="pl-k">return</span> result;
  }</pre></div>

<div class="highlight highlight-java"><pre>  <span class="pl-s">public</span> <span class="pl-s">static</span> <span class="pl-stj">Customer</span>
  customerWithOneNewRelease(
    <span class="pl-stj">String</span> name) {
    <span class="pl-stj">Customer</span> result <span class="pl-k">=</span>
      customerWithNoRentals(name);
    result<span class="pl-k">.</span>addRental(
      <span class="pl-k">new</span> <span class="pl-stj">Rental</span>(
        <span class="pl-k">new</span> <span class="pl-stj">Movie</span>(
          <span class="pl-s1"><span class="pl-pds">"</span>Godfather 4<span class="pl-pds">"</span></span>, <span class="pl-c1">NEW_RELEASE</span>), <span class="pl-c1">3</span>));
    <span class="pl-k">return</span> result;
  }

  <span class="pl-s">public</span> <span class="pl-s">static</span> <span class="pl-stj">Customer</span>
  customerWithNoRentals(<span class="pl-stj">String</span> name) {
    <span class="pl-k">return</span> <span class="pl-k">new</span> <span class="pl-stj">Customer</span>(name);
  }
}</pre></div>

<h2>
<a id="thoughts-on-our-tests" class="anchor" href="#thoughts-on-our-tests" aria-hidden="true"><span class="octicon octicon-link"></span></a>Thoughts on our Tests</h2>

<h2>
<a id="the-domain-code" class="anchor" href="#the-domain-code" aria-hidden="true"><span class="octicon octicon-link"></span></a>The Domain Code</h2>

<div class="highlight highlight-java"><pre><span class="pl-s">public</span> <span class="pl-s">class</span> <span class="pl-en">Customer</span> {

  <span class="pl-s">private</span> <span class="pl-stj">String</span> name;
  <span class="pl-s">private</span> <span class="pl-st">List&lt;<span class="pl-stj">Rental</span>&gt;</span> rentals <span class="pl-k">=</span>
    <span class="pl-k">new</span> <span class="pl-st">ArrayList&lt;<span class="pl-stj">Rental</span>&gt;</span>();

  <span class="pl-s">public</span> <span class="pl-en">Customer</span>(<span class="pl-stj">String</span> <span class="pl-v">name</span>) {
    <span class="pl-v">this</span><span class="pl-k">.</span>name <span class="pl-k">=</span> name;
  }

  <span class="pl-s">public</span> <span class="pl-stj">String</span> <span class="pl-en">getName</span>() {
    <span class="pl-k">return</span> name;
  }

  <span class="pl-s">public</span> <span class="pl-st">List&lt;<span class="pl-stj">Rental</span>&gt;</span> <span class="pl-en">getRentals</span>() {
    <span class="pl-k">return</span> rentals;
  }

  <span class="pl-s">public</span> <span class="pl-st">void</span> <span class="pl-en">addRental</span>(<span class="pl-stj">Rental</span> <span class="pl-v">rental</span>) {
    rentals<span class="pl-k">.</span>add(rental);
  }</pre></div>

<div class="highlight highlight-java"><pre>  <span class="pl-s">public</span> <span class="pl-stj">String</span> statement() {
    <span class="pl-stj">String</span> result <span class="pl-k">=</span>
      <span class="pl-s1"><span class="pl-pds">"</span>Rental record for <span class="pl-pds">"</span></span> <span class="pl-k">+</span> getName() <span class="pl-k">+</span> <span class="pl-s1"><span class="pl-pds">"</span><span class="pl-cce">\n</span><span class="pl-pds">"</span></span>;
    <span class="pl-k">for</span> (<span class="pl-stj">Rental</span> rental <span class="pl-k">:</span> rentals)
      result <span class="pl-k">+=</span>
        <span class="pl-s1"><span class="pl-pds">"</span><span class="pl-cce">\t</span><span class="pl-pds">"</span></span> <span class="pl-k">+</span> rental<span class="pl-k">.</span>getLineItem() <span class="pl-k">+</span> <span class="pl-s1"><span class="pl-pds">"</span><span class="pl-cce">\n</span><span class="pl-pds">"</span></span>;
    result <span class="pl-k">+=</span>
      <span class="pl-s1"><span class="pl-pds">"</span>Amount owed is <span class="pl-pds">"</span></span> <span class="pl-k">+</span> getTotalCharge() <span class="pl-k">+</span>
      <span class="pl-s1"><span class="pl-pds">"</span><span class="pl-cce">\n</span><span class="pl-pds">"</span></span> <span class="pl-k">+</span> <span class="pl-s1"><span class="pl-pds">"</span>You earned <span class="pl-pds">"</span></span> <span class="pl-k">+</span>
      getTotalPoints() <span class="pl-k">+</span>
      <span class="pl-s1"><span class="pl-pds">"</span> frequent renter points<span class="pl-pds">"</span></span>;
    <span class="pl-k">return</span> result;
  }

  <span class="pl-s">public</span> <span class="pl-stj">String</span> htmlStatement() {
    <span class="pl-stj">String</span> result <span class="pl-k">=</span>
      <span class="pl-s1"><span class="pl-pds">"</span>&lt;h1&gt;Rental record for &lt;em&gt;<span class="pl-pds">"</span></span> <span class="pl-k">+</span>
      getName() <span class="pl-k">+</span> <span class="pl-s1"><span class="pl-pds">"</span>&lt;/em&gt;&lt;/h1&gt;<span class="pl-cce">\n</span><span class="pl-pds">"</span></span>;
    <span class="pl-k">for</span> (<span class="pl-stj">Rental</span> rental <span class="pl-k">:</span> rentals)
      result <span class="pl-k">+=</span> <span class="pl-s1"><span class="pl-pds">"</span>&lt;p&gt;<span class="pl-pds">"</span></span> <span class="pl-k">+</span> rental<span class="pl-k">.</span>getLineItem() <span class="pl-k">+</span>
        <span class="pl-s1"><span class="pl-pds">"</span>&lt;/p&gt;<span class="pl-cce">\n</span><span class="pl-pds">"</span></span>;
    result <span class="pl-k">+=</span>
      <span class="pl-s1"><span class="pl-pds">"</span>&lt;p&gt;Amount owed is &lt;em&gt;<span class="pl-pds">"</span></span> <span class="pl-k">+</span>
      getTotalCharge() <span class="pl-k">+</span> <span class="pl-s1"><span class="pl-pds">"</span>&lt;/em&gt;&lt;/p&gt;<span class="pl-cce">\n</span><span class="pl-pds">"</span></span> <span class="pl-k">+</span>
      <span class="pl-s1"><span class="pl-pds">"</span>&lt;p&gt;You earned &lt;em&gt;<span class="pl-pds">"</span></span> <span class="pl-k">+</span>
      getTotalPoints() <span class="pl-k">+</span>
      <span class="pl-s1"><span class="pl-pds">"</span> frequent renter points&lt;/em&gt;&lt;/p&gt;<span class="pl-pds">"</span></span>;
    <span class="pl-k">return</span> result;

  }</pre></div>

<div class="highlight highlight-java"><pre>  <span class="pl-s">public</span> <span class="pl-st">double</span> getTotalCharge() {
    <span class="pl-st">double</span> total <span class="pl-k">=</span> <span class="pl-c1">0</span>;
    <span class="pl-k">for</span> (<span class="pl-stj">Rental</span> rental <span class="pl-k">:</span> rentals)
      total <span class="pl-k">+=</span> rental<span class="pl-k">.</span>getCharge();
    <span class="pl-k">return</span> total;
  }

  <span class="pl-s">public</span> <span class="pl-st">int</span> getTotalPoints() {
    <span class="pl-st">int</span> total <span class="pl-k">=</span> <span class="pl-c1">0</span>;
    <span class="pl-k">for</span> (<span class="pl-stj">Rental</span> rental <span class="pl-k">:</span> rentals)
      total <span class="pl-k">+=</span> rental<span class="pl-k">.</span>getPoints();
    <span class="pl-k">return</span> total;
  }
}</pre></div>

<div class="highlight highlight-java"><pre><span class="pl-s">public</span> <span class="pl-s">class</span> <span class="pl-en">Rental</span> {

  <span class="pl-stj">Movie</span> movie;
  <span class="pl-s">private</span> <span class="pl-st">int</span> daysRented;

  <span class="pl-s">public</span> <span class="pl-en">Rental</span>(<span class="pl-stj">Movie</span> <span class="pl-v">movie</span>, <span class="pl-st">int</span> <span class="pl-v">daysRented</span>) {
    <span class="pl-v">this</span><span class="pl-k">.</span>movie <span class="pl-k">=</span> movie;
    <span class="pl-v">this</span><span class="pl-k">.</span>daysRented <span class="pl-k">=</span> daysRented;
  }

  <span class="pl-s">public</span> <span class="pl-stj">Movie</span> <span class="pl-en">getMovie</span>() {
    <span class="pl-k">return</span> movie;
  }

  <span class="pl-s">public</span> <span class="pl-st">int</span> <span class="pl-en">getDaysRented</span>() {
    <span class="pl-k">return</span> daysRented;
  }

  <span class="pl-s">public</span> <span class="pl-st">double</span> <span class="pl-en">getCharge</span>() {
    <span class="pl-k">return</span> movie<span class="pl-k">.</span>getCharge(daysRented);
  }

  <span class="pl-s">public</span> <span class="pl-st">int</span> <span class="pl-en">getPoints</span>() {
    <span class="pl-k">return</span> movie<span class="pl-k">.</span>getPoints(daysRented);
  }

  <span class="pl-s">public</span> <span class="pl-stj">String</span> <span class="pl-en">getLineItem</span>() {
    <span class="pl-k">return</span>
      movie<span class="pl-k">.</span>getTitle() <span class="pl-k">+</span> <span class="pl-s1"><span class="pl-pds">"</span> <span class="pl-pds">"</span></span> <span class="pl-k">+</span> getCharge();
  }
}</pre></div>

<div class="highlight highlight-java"><pre><span class="pl-s">public</span> <span class="pl-s">class</span> <span class="pl-en">Movie</span> {

  <span class="pl-s">public</span> <span class="pl-s">enum</span> <span class="pl-en">Type</span> {
    <span class="pl-c1">REGULAR</span>, <span class="pl-c1">NEW_RELEASE</span>, <span class="pl-c1">CHILDREN</span>, <span class="pl-c1">UNKNOWN</span>;
  }

  <span class="pl-s">private</span> <span class="pl-stj">String</span> title;
  <span class="pl-stj">Price</span> price;

  <span class="pl-s">public</span> <span class="pl-en">Movie</span>(
    <span class="pl-stj">String</span> <span class="pl-v">title</span>, <span class="pl-stj">Movie</span>.<span class="pl-stj">Type</span> <span class="pl-v">priceCode</span>) {
    <span class="pl-v">this</span><span class="pl-k">.</span>title <span class="pl-k">=</span> title;
    setPriceCode(priceCode);
  }

  <span class="pl-s">public</span> <span class="pl-stj">String</span> <span class="pl-en">getTitle</span>() {
    <span class="pl-k">return</span> title;
  }</pre></div>

<div class="highlight highlight-java"><pre>  <span class="pl-s">private</span> <span class="pl-st">void</span> setPriceCode(
    <span class="pl-stj">Movie</span><span class="pl-k">.</span><span class="pl-stj">Type</span> priceCode) {
    <span class="pl-k">switch</span> (priceCode) {
    <span class="pl-k">case</span> <span class="pl-c1">CHILDREN</span><span class="pl-k">:</span>
      price <span class="pl-k">=</span> <span class="pl-k">new</span> <span class="pl-stj">ChildrensPrice</span>();
      <span class="pl-k">break</span>;
    <span class="pl-k">case</span> <span class="pl-c1">NEW_RELEASE</span><span class="pl-k">:</span>
      price <span class="pl-k">=</span> <span class="pl-k">new</span> <span class="pl-stj">NewReleasePrice</span>();
      <span class="pl-k">break</span>;
    <span class="pl-k">case</span> <span class="pl-c1">REGULAR</span><span class="pl-k">:</span>
      price <span class="pl-k">=</span> <span class="pl-k">new</span> <span class="pl-stj">RegularPrice</span>();
      <span class="pl-k">break</span>;
    <span class="pl-k">default</span><span class="pl-k">:</span>
      <span class="pl-k">throw</span> <span class="pl-k">new</span> <span class="pl-stj">IllegalArgumentException</span>(
        <span class="pl-s1"><span class="pl-pds">"</span>invalid price code<span class="pl-pds">"</span></span>);
    }
  }

  <span class="pl-s">public</span> <span class="pl-st">double</span> getCharge(<span class="pl-st">int</span> daysRented) {
    <span class="pl-k">return</span> price<span class="pl-k">.</span>getCharge(daysRented);
  }

  <span class="pl-s">public</span> <span class="pl-st">int</span> getPoints(<span class="pl-st">int</span> daysRented) {
    <span class="pl-k">return</span> price<span class="pl-k">.</span>getPoints(daysRented);
  }
}</pre></div>

<div class="highlight highlight-java"><pre><span class="pl-s">public</span> <span class="pl-s">abstract</span> <span class="pl-s">class</span> <span class="pl-en">Price</span> {
  <span class="pl-s">abstract</span> <span class="pl-st">double</span> <span class="pl-en">getCharge</span>(<span class="pl-st">int</span> <span class="pl-v">daysRented</span>);

  <span class="pl-st">int</span> <span class="pl-en">getPoints</span>(<span class="pl-st">int</span> <span class="pl-v">daysRented</span>) {
    <span class="pl-k">return</span> <span class="pl-c1">1</span>;
  }
}</pre></div>

<div class="highlight highlight-java"><pre><span class="pl-s">public</span> <span class="pl-s">class</span> <span class="pl-en">ChildrensPrice</span> <span class="pl-s">extends</span> <span class="pl-e">Price</span> {
  <span class="pl-st">@Override</span>
  <span class="pl-st">double</span> <span class="pl-en">getCharge</span>(<span class="pl-st">int</span> <span class="pl-v">daysRented</span>) {
    <span class="pl-st">double</span> amount <span class="pl-k">=</span> <span class="pl-c1">1.5</span>;
    <span class="pl-k">if</span> (daysRented <span class="pl-k">&gt;</span> <span class="pl-c1">3</span>)
      amount <span class="pl-k">+=</span> (daysRented <span class="pl-k">-</span> <span class="pl-c1">3</span>) <span class="pl-k">*</span> <span class="pl-c1">1.5</span>;
    <span class="pl-k">return</span> amount;
  }
}</pre></div>

<div class="highlight highlight-java"><pre><span class="pl-s">public</span> <span class="pl-s">class</span> <span class="pl-en">RegularPrice</span> <span class="pl-s">extends</span> <span class="pl-e">Price</span> {
  <span class="pl-st">@Override</span>
  <span class="pl-s">public</span> <span class="pl-st">double</span> <span class="pl-en">getCharge</span>(<span class="pl-st">int</span> <span class="pl-v">daysRented</span>) {
    <span class="pl-st">double</span> amount <span class="pl-k">=</span> <span class="pl-c1">2</span>;
    <span class="pl-k">if</span> (daysRented <span class="pl-k">&gt;</span> <span class="pl-c1">2</span>)
      amount <span class="pl-k">+=</span> (daysRented <span class="pl-k">-</span> <span class="pl-c1">2</span>) <span class="pl-k">*</span> <span class="pl-c1">1.5</span>;
    <span class="pl-k">return</span> amount;
  }
}</pre></div>

<div class="highlight highlight-java"><pre><span class="pl-s">public</span> <span class="pl-s">class</span> <span class="pl-en">NewReleasePrice</span> <span class="pl-s">extends</span> <span class="pl-e">Price</span> {
  <span class="pl-st">@Override</span>
  <span class="pl-s">public</span> <span class="pl-st">double</span> <span class="pl-en">getCharge</span>(<span class="pl-st">int</span> <span class="pl-v">daysRented</span>) {
    <span class="pl-k">return</span> daysRented <span class="pl-k">*</span> <span class="pl-c1">3</span>;
  }

  <span class="pl-st">@Override</span>
  <span class="pl-st">int</span> <span class="pl-en">getPoints</span>(<span class="pl-st">int</span> <span class="pl-v">daysRented</span>) {
    <span class="pl-k">if</span> (daysRented <span class="pl-k">&gt;</span> <span class="pl-c1">1</span>)
      <span class="pl-k">return</span> <span class="pl-c1">2</span>;
    <span class="pl-k">return</span> <span class="pl-c1">1</span>;
  }
}</pre></div>

<h2>
<a id="moving-towards-readability" class="anchor" href="#moving-towards-readability" aria-hidden="true"><span class="octicon octicon-link"></span></a>Moving Towards Readability</h2>

<h2>
<a id="replace-loop-with-individual-tests" class="anchor" href="#replace-loop-with-individual-tests" aria-hidden="true"><span class="octicon octicon-link"></span></a>Replace Loop with Individual Tests</h2>

<div class="highlight highlight-java"><pre><span class="pl-s">public</span> <span class="pl-s">class</span> <span class="pl-en">CustomerTest</span> {
  <span class="pl-stj">Customer</span> john, steve, pat, david;
  <span class="pl-stj">String</span> johnName <span class="pl-k">=</span> <span class="pl-s1"><span class="pl-pds">"</span>John<span class="pl-pds">"</span></span>,
    steveName <span class="pl-k">=</span> <span class="pl-s1"><span class="pl-pds">"</span>Steve<span class="pl-pds">"</span></span>,
    patName <span class="pl-k">=</span> <span class="pl-s1"><span class="pl-pds">"</span>Pat<span class="pl-pds">"</span></span>,
    davidName <span class="pl-k">=</span> <span class="pl-s1"><span class="pl-pds">"</span>David<span class="pl-pds">"</span></span>;
  <span class="pl-st">Customer</span>[] customers;

  <span class="pl-st">@Before</span>
  <span class="pl-s">public</span> <span class="pl-st">void</span> <span class="pl-en">setup</span>() {
    david <span class="pl-k">=</span> <span class="pl-stj">ObjectMother</span>
      .customerWithNoRentals(davidName);
    john <span class="pl-k">=</span> <span class="pl-stj">ObjectMother</span>
      .customerWithOneNewRelease(johnName);
    pat <span class="pl-k">=</span> <span class="pl-stj">ObjectMother</span>
      .customerWithOneOfEachRentalType(
        patName);
    steve <span class="pl-k">=</span> <span class="pl-stj">ObjectMother</span>
      .customerWithOneNewReleaseAndOneRegular(
        steveName);
    customers <span class="pl-k">=</span> <span class="pl-k">new</span> <span class="pl-stj">Customer</span>[] {
      david, john, steve, pat };
  }</pre></div>

<div class="highlight highlight-java"><pre>
  @<span class="pl-stj">Test</span>
  <span class="pl-s">public</span> <span class="pl-st">void</span> davidStatement() {
    assertEquals(
      expStatement(
        <span class="pl-s1"><span class="pl-pds">"</span>Rental record for %s<span class="pl-cce">\n</span>%sAmount <span class="pl-pds">"</span></span> <span class="pl-k">+</span>
        <span class="pl-s1"><span class="pl-pds">"</span>owed is %s<span class="pl-cce">\n</span>You earned %s <span class="pl-pds">"</span></span> <span class="pl-k">+</span>
        <span class="pl-s1"><span class="pl-pds">"</span>frequent renter points<span class="pl-pds">"</span></span>,
        david,
        rentalInfo(
          <span class="pl-s1"><span class="pl-pds">"</span><span class="pl-cce">\t</span><span class="pl-pds">"</span></span>, <span class="pl-s1"><span class="pl-pds">"</span><span class="pl-pds">"</span></span>, david<span class="pl-k">.</span>getRentals())),
      david<span class="pl-k">.</span>statement());
  }

  @<span class="pl-stj">Test</span>
  <span class="pl-s">public</span> <span class="pl-st">void</span> johnStatement() {
    assertEquals(
      expStatement(
        <span class="pl-s1"><span class="pl-pds">"</span>Rental record for %s<span class="pl-cce">\n</span>%sAmount <span class="pl-pds">"</span></span> <span class="pl-k">+</span>
        <span class="pl-s1"><span class="pl-pds">"</span>owed is %s<span class="pl-cce">\n</span>You earned %s <span class="pl-pds">"</span></span> <span class="pl-k">+</span>
        <span class="pl-s1"><span class="pl-pds">"</span>frequent renter points<span class="pl-pds">"</span></span>,
        john,
        rentalInfo(
          <span class="pl-s1"><span class="pl-pds">"</span><span class="pl-cce">\t</span><span class="pl-pds">"</span></span>, <span class="pl-s1"><span class="pl-pds">"</span><span class="pl-pds">"</span></span>, john<span class="pl-k">.</span>getRentals())),
      john<span class="pl-k">.</span>statement());
  }</pre></div>

<div class="highlight highlight-java"><pre>  @<span class="pl-stj">Test</span>
  <span class="pl-s">public</span> <span class="pl-st">void</span> patStatement() {
    assertEquals(
      expStatement(
        <span class="pl-s1"><span class="pl-pds">"</span>Rental record for %s<span class="pl-cce">\n</span>%sAmount <span class="pl-pds">"</span></span> <span class="pl-k">+</span>
        <span class="pl-s1"><span class="pl-pds">"</span>owed is %s<span class="pl-cce">\n</span>You earned %s <span class="pl-pds">"</span></span> <span class="pl-k">+</span>
        <span class="pl-s1"><span class="pl-pds">"</span>frequent renter points<span class="pl-pds">"</span></span>,
        pat,
        rentalInfo(
          <span class="pl-s1"><span class="pl-pds">"</span><span class="pl-cce">\t</span><span class="pl-pds">"</span></span>, <span class="pl-s1"><span class="pl-pds">"</span><span class="pl-pds">"</span></span>, pat<span class="pl-k">.</span>getRentals())),
      pat<span class="pl-k">.</span>statement());
  }

  @<span class="pl-stj">Test</span>
  <span class="pl-s">public</span> <span class="pl-st">void</span> steveStatement() {
    assertEquals(
      expStatement(
        <span class="pl-s1"><span class="pl-pds">"</span>Rental record for %s<span class="pl-cce">\n</span>%s<span class="pl-pds">"</span></span> <span class="pl-k">+</span>
        <span class="pl-s1"><span class="pl-pds">"</span>Amount owed is %s<span class="pl-cce">\n</span>You earned %s <span class="pl-pds">"</span></span> <span class="pl-k">+</span>
        <span class="pl-s1"><span class="pl-pds">"</span>frequent renter points<span class="pl-pds">"</span></span>,
        steve,
        rentalInfo(
          <span class="pl-s1"><span class="pl-pds">"</span><span class="pl-cce">\t</span><span class="pl-pds">"</span></span>, <span class="pl-s1"><span class="pl-pds">"</span><span class="pl-pds">"</span></span>, steve<span class="pl-k">.</span>getRentals())),
      steve<span class="pl-k">.</span>statement());
  }</pre></div>

<div class="highlight highlight-java"><pre>

  <span class="pl-s">public</span> <span class="pl-s">static</span> <span class="pl-stj">String</span> rentalInfo(
    <span class="pl-stj">String</span> startsWith,
    <span class="pl-stj">String</span> endsWith,
    <span class="pl-st">List&lt;<span class="pl-stj">Rental</span>&gt;</span> rentals) {
    <span class="pl-stj">String</span> result <span class="pl-k">=</span> <span class="pl-s1"><span class="pl-pds">"</span><span class="pl-pds">"</span></span>;
    <span class="pl-k">for</span> (<span class="pl-stj">Rental</span> rental <span class="pl-k">:</span> rentals)
      result <span class="pl-k">+=</span> <span class="pl-stj">String</span><span class="pl-k">.</span>format(
        <span class="pl-s1"><span class="pl-pds">"</span>%s%s<span class="pl-cce">\t</span>%s%s<span class="pl-cce">\n</span><span class="pl-pds">"</span></span>,
        startsWith,
        rental<span class="pl-k">.</span>getMovie()<span class="pl-k">.</span>getTitle(),
        rental<span class="pl-k">.</span>getCharge(),
        endsWith);
    <span class="pl-k">return</span> result;
  }

  <span class="pl-s">public</span> <span class="pl-s">static</span> <span class="pl-stj">String</span> expStatement(
    <span class="pl-stj">String</span> formatStr,
    <span class="pl-stj">Customer</span> customer,
    <span class="pl-stj">String</span> rentalInfo) {
    <span class="pl-k">return</span> <span class="pl-stj">String</span><span class="pl-k">.</span>format(
      formatStr,
      customer<span class="pl-k">.</span>getName(),
      rentalInfo,
      customer<span class="pl-k">.</span>getTotalCharge(),
      customer<span class="pl-k">.</span>getTotalPoints());
  }
}</pre></div>

<h2>
<a id="expect-literals" class="anchor" href="#expect-literals" aria-hidden="true"><span class="octicon octicon-link"></span></a>Expect Literals</h2>

<div class="highlight highlight-java"><pre><span class="pl-s">public</span> <span class="pl-s">class</span> <span class="pl-en">CustomerTest</span> {
  <span class="pl-stj">Customer</span> john, steve, pat, david;
  <span class="pl-stj">String</span> johnName <span class="pl-k">=</span> <span class="pl-s1"><span class="pl-pds">"</span>John<span class="pl-pds">"</span></span>,
    steveName <span class="pl-k">=</span> <span class="pl-s1"><span class="pl-pds">"</span>Steve<span class="pl-pds">"</span></span>,
    patName <span class="pl-k">=</span> <span class="pl-s1"><span class="pl-pds">"</span>Pat<span class="pl-pds">"</span></span>,
    davidName <span class="pl-k">=</span> <span class="pl-s1"><span class="pl-pds">"</span>David<span class="pl-pds">"</span></span>;
  <span class="pl-st">Customer</span>[] customers;

  <span class="pl-st">@Before</span>
  <span class="pl-s">public</span> <span class="pl-st">void</span> <span class="pl-en">setup</span>() {
    david <span class="pl-k">=</span> <span class="pl-stj">ObjectMother</span>
      .customerWithNoRentals(davidName);
    john <span class="pl-k">=</span> <span class="pl-stj">ObjectMother</span>
      .customerWithOneNewRelease(johnName);
    pat <span class="pl-k">=</span> <span class="pl-stj">ObjectMother</span>
      .customerWithOneOfEachRentalType(
        patName);
    steve <span class="pl-k">=</span> <span class="pl-stj">ObjectMother</span>
      .customerWithOneNewReleaseAndOneRegular(
        steveName);
    customers <span class="pl-k">=</span> <span class="pl-k">new</span> <span class="pl-stj">Customer</span>[] {
      david, john, steve, pat };
  }

  <span class="pl-st">@Test</span>
  <span class="pl-s">public</span> <span class="pl-st">void</span> <span class="pl-en">davidStatement</span>() {
    assertEquals(

      <span class="pl-s1"><span class="pl-pds">"</span>Rental record for David<span class="pl-cce">\n</span>Amount <span class="pl-pds">"</span></span> <span class="pl-k">+</span>
      <span class="pl-s1"><span class="pl-pds">"</span>owed is 0.0<span class="pl-cce">\n</span><span class="pl-pds">"</span></span> <span class="pl-k">+</span>
      <span class="pl-s1"><span class="pl-pds">"</span>You earned 0 frequent renter points<span class="pl-pds">"</span></span>,

      david<span class="pl-k">.</span>statement());
  }</pre></div>

<div class="highlight highlight-java"><pre>  @<span class="pl-stj">Test</span>
  <span class="pl-s">public</span> <span class="pl-st">void</span> johnStatement() {
    assertEquals(

      <span class="pl-s1"><span class="pl-pds">"</span>Rental record for John<span class="pl-cce">\n\t</span><span class="pl-pds">"</span></span> <span class="pl-k">+</span>
      <span class="pl-s1"><span class="pl-pds">"</span>Godfather 4<span class="pl-cce">\t</span>9.0<span class="pl-cce">\n</span><span class="pl-pds">"</span></span> <span class="pl-k">+</span>
      <span class="pl-s1"><span class="pl-pds">"</span>Amount owed is 9.0<span class="pl-cce">\n</span><span class="pl-pds">"</span></span> <span class="pl-k">+</span>
      <span class="pl-s1"><span class="pl-pds">"</span>You earned 2 frequent renter points<span class="pl-pds">"</span></span>,

      john<span class="pl-k">.</span>statement());
  }

  @<span class="pl-stj">Test</span>
  <span class="pl-s">public</span> <span class="pl-st">void</span> patStatement() {
    assertEquals(

      <span class="pl-s1"><span class="pl-pds">"</span>Rental record for Pat<span class="pl-cce">\n\t</span><span class="pl-pds">"</span></span> <span class="pl-k">+</span>
      <span class="pl-s1"><span class="pl-pds">"</span>Godfather 4<span class="pl-cce">\t</span>9.0<span class="pl-cce">\n</span><span class="pl-pds">"</span></span> <span class="pl-k">+</span>
      <span class="pl-s1"><span class="pl-pds">"</span><span class="pl-cce">\t</span>Scarface<span class="pl-cce">\t</span>3.5<span class="pl-cce">\n</span><span class="pl-pds">"</span></span> <span class="pl-k">+</span>
      <span class="pl-s1"><span class="pl-pds">"</span><span class="pl-cce">\t</span>Lion King<span class="pl-cce">\t</span>1.5<span class="pl-cce">\n</span><span class="pl-pds">"</span></span> <span class="pl-k">+</span>
      <span class="pl-s1"><span class="pl-pds">"</span>Amount owed is 14.0<span class="pl-cce">\n</span><span class="pl-pds">"</span></span> <span class="pl-k">+</span>
      <span class="pl-s1"><span class="pl-pds">"</span>You earned 4 frequent renter points<span class="pl-pds">"</span></span>,

      pat<span class="pl-k">.</span>statement());
  }</pre></div>

<div class="highlight highlight-java"><pre>  @<span class="pl-stj">Test</span>
  <span class="pl-s">public</span> <span class="pl-st">void</span> steveStatement() {
    assertEquals(

      <span class="pl-s1"><span class="pl-pds">"</span>Rental record for Steve<span class="pl-cce">\n\t</span><span class="pl-pds">"</span></span> <span class="pl-k">+</span>
      <span class="pl-s1"><span class="pl-pds">"</span>Godfather 4<span class="pl-cce">\t</span>9.0<span class="pl-cce">\n</span><span class="pl-pds">"</span></span> <span class="pl-k">+</span>
      <span class="pl-s1"><span class="pl-pds">"</span><span class="pl-cce">\t</span>Scarface<span class="pl-cce">\t</span>3.5<span class="pl-cce">\n</span><span class="pl-pds">"</span></span> <span class="pl-k">+</span>
      <span class="pl-s1"><span class="pl-pds">"</span>Amount owed is 12.5<span class="pl-cce">\n</span><span class="pl-pds">"</span></span> <span class="pl-k">+</span>
      <span class="pl-s1"><span class="pl-pds">"</span>You earned 3 frequent renter points<span class="pl-pds">"</span></span>,

      steve<span class="pl-k">.</span>statement());
  }
}</pre></div>

<h2>
<a id="inline-setup" class="anchor" href="#inline-setup" aria-hidden="true"><span class="octicon octicon-link"></span></a>Inline Setup</h2>

<div class="highlight highlight-java"><pre><span class="pl-s">public</span> <span class="pl-s">class</span> <span class="pl-en">CustomerTest</span> {
  <span class="pl-st">@Test</span>
  <span class="pl-s">public</span> <span class="pl-st">void</span> <span class="pl-en">noRentalsStatement</span>() {
    assertEquals(
      <span class="pl-s1"><span class="pl-pds">"</span>Rental record for David<span class="pl-cce">\n</span>Amount <span class="pl-pds">"</span></span> <span class="pl-k">+</span>
      <span class="pl-s1"><span class="pl-pds">"</span>owed is 0.0<span class="pl-cce">\n</span><span class="pl-pds">"</span></span> <span class="pl-k">+</span>
      <span class="pl-s1"><span class="pl-pds">"</span>You earned 0 frequent renter points<span class="pl-pds">"</span></span>,

      <span class="pl-stj">ObjectMother</span>
      .customerWithNoRentals(
        <span class="pl-s1"><span class="pl-pds">"</span>David<span class="pl-pds">"</span></span>)<span class="pl-k">.</span>statement());

  }

  <span class="pl-st">@Test</span>
  <span class="pl-s">public</span> <span class="pl-st">void</span> <span class="pl-en">oneNewReleaseStatement</span>() {
    assertEquals(
      <span class="pl-s1"><span class="pl-pds">"</span>Rental record for John<span class="pl-cce">\n\t</span><span class="pl-pds">"</span></span> <span class="pl-k">+</span>
      <span class="pl-s1"><span class="pl-pds">"</span>Godfather 4 9.0<span class="pl-cce">\n</span><span class="pl-pds">"</span></span> <span class="pl-k">+</span>
      <span class="pl-s1"><span class="pl-pds">"</span>Amount owed is 9.0<span class="pl-cce">\n</span><span class="pl-pds">"</span></span> <span class="pl-k">+</span>
      <span class="pl-s1"><span class="pl-pds">"</span>You earned 2 frequent renter points<span class="pl-pds">"</span></span>,

      <span class="pl-stj">ObjectMother</span>
      .customerWithOneNewRelease(
        <span class="pl-s1"><span class="pl-pds">"</span>John<span class="pl-pds">"</span></span>)<span class="pl-k">.</span>statement());

  }</pre></div>

<div class="highlight highlight-java"><pre>  @<span class="pl-stj">Test</span>
  <span class="pl-s">public</span> <span class="pl-st">void</span> allRentalTypesStatement() {
    assertEquals(
      <span class="pl-s1"><span class="pl-pds">"</span>Rental record for Pat<span class="pl-cce">\n\t</span><span class="pl-pds">"</span></span> <span class="pl-k">+</span>
      <span class="pl-s1"><span class="pl-pds">"</span>Godfather 4 9.0<span class="pl-cce">\n</span><span class="pl-pds">"</span></span> <span class="pl-k">+</span>
      <span class="pl-s1"><span class="pl-pds">"</span><span class="pl-cce">\t</span>Scarface 3.5<span class="pl-cce">\n\t</span>Lion King 1.5<span class="pl-cce">\n</span><span class="pl-pds">"</span></span> <span class="pl-k">+</span>
      <span class="pl-s1"><span class="pl-pds">"</span>Amount owed is 14.0<span class="pl-cce">\n</span><span class="pl-pds">"</span></span> <span class="pl-k">+</span>
      <span class="pl-s1"><span class="pl-pds">"</span>You earned 4 frequent renter points<span class="pl-pds">"</span></span>,

      <span class="pl-stj">ObjectMother</span>
      .customerWithOneOfEachRentalType(
        <span class="pl-s1"><span class="pl-pds">"</span>Pat<span class="pl-pds">"</span></span>)<span class="pl-k">.</span>statement());

  }

  @<span class="pl-stj">Test</span>
  <span class="pl-s">public</span> <span class="pl-st">void</span>
  newReleaseAndRegularStatement() {
    assertEquals(
      <span class="pl-s1"><span class="pl-pds">"</span>Rental record for Steve<span class="pl-cce">\n\t</span><span class="pl-pds">"</span></span> <span class="pl-k">+</span>
      <span class="pl-s1"><span class="pl-pds">"</span>Godfather 4 9.0<span class="pl-cce">\n</span><span class="pl-pds">"</span></span> <span class="pl-k">+</span>
      <span class="pl-s1"><span class="pl-pds">"</span><span class="pl-cce">\t</span>Scarface 3.5<span class="pl-cce">\n</span><span class="pl-pds">"</span></span> <span class="pl-k">+</span>
      <span class="pl-s1"><span class="pl-pds">"</span>Amount owed is 12.5<span class="pl-cce">\n</span><span class="pl-pds">"</span></span> <span class="pl-k">+</span>
      <span class="pl-s1"><span class="pl-pds">"</span>You earned 3 frequent renter points<span class="pl-pds">"</span></span>,

      <span class="pl-stj">ObjectMother</span>
      .customerWithOneNewReleaseAndOneRegular(
        <span class="pl-s1"><span class="pl-pds">"</span>Steve<span class="pl-pds">"</span></span>)<span class="pl-k">.</span>statement());

  }
}</pre></div>

<h2>
<a id="replace-objectmother-with-databuilder" class="anchor" href="#replace-objectmother-with-databuilder" aria-hidden="true"><span class="octicon octicon-link"></span></a>Replace ObjectMother with DataBuilder</h2>

<div class="highlight highlight-java"><pre><span class="pl-s">public</span> <span class="pl-s">class</span> <span class="pl-en">a</span> {
  <span class="pl-s">public</span> <span class="pl-s">static</span> <span class="pl-stj">CustomerBuilder</span> customer <span class="pl-k">=</span>
    <span class="pl-k">new</span> <span class="pl-stj">CustomerBuilder</span>();
  <span class="pl-s">public</span> <span class="pl-s">static</span> <span class="pl-stj">RentalBuilder</span> rental <span class="pl-k">=</span>
    <span class="pl-k">new</span> <span class="pl-stj">RentalBuilder</span>();
  <span class="pl-s">public</span> <span class="pl-s">static</span> <span class="pl-stj">MovieBuilder</span> movie <span class="pl-k">=</span>
    <span class="pl-k">new</span> <span class="pl-stj">MovieBuilder</span>();

  <span class="pl-s">public</span> <span class="pl-s">static</span> <span class="pl-s">class</span> <span class="pl-en">CustomerBuilder</span> {
    <span class="pl-st">Rental</span>[] rentals;
    <span class="pl-stj">String</span> name;

    <span class="pl-en">CustomerBuilder</span>() {
      <span class="pl-v">this</span>(<span class="pl-s1"><span class="pl-pds">"</span>Jim<span class="pl-pds">"</span></span>, <span class="pl-k">new</span> <span class="pl-stj">Rental</span>[<span class="pl-c1">0</span>]);
    }

    <span class="pl-en">CustomerBuilder</span>(
      <span class="pl-stj">String</span> <span class="pl-v">name</span>, <span class="pl-st">Rental</span>[] <span class="pl-v">rentals</span>) {
      <span class="pl-v">this</span><span class="pl-k">.</span>name <span class="pl-k">=</span> name;
      <span class="pl-v">this</span><span class="pl-k">.</span>rentals <span class="pl-k">=</span> rentals;
    }

    <span class="pl-s">public</span> <span class="pl-stj">CustomerBuilder</span> <span class="pl-en">w</span>(
      <span class="pl-stj">RentalBuilder</span>... <span class="pl-v">builders</span>) {
      <span class="pl-st">Rental</span>[] rentals <span class="pl-k">=</span>
        <span class="pl-k">new</span> <span class="pl-stj">Rental</span>[builders<span class="pl-k">.</span>length];
      <span class="pl-k">for</span> (<span class="pl-st">int</span> i<span class="pl-k">=</span><span class="pl-c1">0</span>; i<span class="pl-k">&lt;</span>builders<span class="pl-k">.</span>length; i<span class="pl-k">++</span>) {
        rentals[i] <span class="pl-k">=</span> builders[i]<span class="pl-k">.</span>build();
      }
      <span class="pl-k">return</span>
        <span class="pl-k">new</span> <span class="pl-stj">CustomerBuilder</span>(name, rentals);
    }

    <span class="pl-s">public</span> <span class="pl-stj">CustomerBuilder</span> <span class="pl-en">w</span>(<span class="pl-stj">String</span> <span class="pl-v">name</span>) {
      <span class="pl-k">return</span>
        <span class="pl-k">new</span> <span class="pl-stj">CustomerBuilder</span>(name, rentals);
    }

    <span class="pl-s">public</span> <span class="pl-stj">Customer</span> <span class="pl-en">build</span>() {
      <span class="pl-stj">Customer</span> result <span class="pl-k">=</span> <span class="pl-k">new</span> <span class="pl-stj">Customer</span>(name);
      <span class="pl-k">for</span> (<span class="pl-stj">Rental</span> rental <span class="pl-k">:</span> rentals) {
        result<span class="pl-k">.</span>addRental(rental);
      }
      <span class="pl-k">return</span> result;
    }
  }</pre></div>

<div class="highlight highlight-java"><pre>  <span class="pl-s">public</span> <span class="pl-s">static</span> <span class="pl-s">class</span> <span class="pl-en">RentalBuilder</span> {
    <span class="pl-s">final</span> <span class="pl-stj">Movie</span> movie;
    <span class="pl-s">final</span> <span class="pl-st">int</span> days;

    <span class="pl-en">RentalBuilder</span>() {
      <span class="pl-v">this</span>(<span class="pl-k">new</span> <span class="pl-stj">MovieBuilder</span>()<span class="pl-k">.</span>build(), <span class="pl-c1">3</span>);
    }

    <span class="pl-en">RentalBuilder</span>(<span class="pl-stj">Movie</span> <span class="pl-v">movie</span>, <span class="pl-st">int</span> <span class="pl-v">days</span>) {
      <span class="pl-v">this</span><span class="pl-k">.</span>movie <span class="pl-k">=</span> movie;
      <span class="pl-v">this</span><span class="pl-k">.</span>days <span class="pl-k">=</span> days;
    }

    <span class="pl-s">public</span> <span class="pl-stj">RentalBuilder</span> <span class="pl-en">w</span>(
      <span class="pl-stj">MovieBuilder</span> <span class="pl-v">movie</span>) {
      <span class="pl-k">return</span>
        <span class="pl-k">new</span> <span class="pl-stj">RentalBuilder</span>(
          movie<span class="pl-k">.</span>build(), days);
    }

    <span class="pl-s">public</span> <span class="pl-stj">Rental</span> <span class="pl-en">build</span>() {
      <span class="pl-k">return</span> <span class="pl-k">new</span> <span class="pl-stj">Rental</span>(movie, days);
    }
  }</pre></div>

<div class="highlight highlight-java"><pre>  <span class="pl-s">public</span> <span class="pl-s">static</span> <span class="pl-s">class</span> <span class="pl-en">MovieBuilder</span> {
    <span class="pl-s">final</span> <span class="pl-stj">String</span> name;
    <span class="pl-s">final</span> <span class="pl-stj">Movie</span><span class="pl-k">.</span><span class="pl-stj">Type</span> type;

    <span class="pl-en">MovieBuilder</span>() {
      <span class="pl-v">this</span>(<span class="pl-s1"><span class="pl-pds">"</span>Godfather 4<span class="pl-pds">"</span></span>,
           <span class="pl-stj">Movie</span><span class="pl-k">.</span><span class="pl-stj">Type</span><span class="pl-c1"><span class="pl-k">.</span>NEW_RELEASE</span>);
    }

    <span class="pl-en">MovieBuilder</span>(
      <span class="pl-stj">String</span> <span class="pl-v">name</span>, <span class="pl-stj">Movie</span>.<span class="pl-stj">Type</span> <span class="pl-v">type</span>) {
      <span class="pl-v">this</span><span class="pl-k">.</span>name <span class="pl-k">=</span> name;
      <span class="pl-v">this</span><span class="pl-k">.</span>type <span class="pl-k">=</span> type;
    }

    <span class="pl-s">public</span> <span class="pl-stj">MovieBuilder</span> <span class="pl-en">w</span>(<span class="pl-stj">Movie</span>.<span class="pl-stj">Type</span> <span class="pl-v">type</span>) {
      <span class="pl-k">return</span> <span class="pl-k">new</span> <span class="pl-stj">MovieBuilder</span>(name, type);
    }

    <span class="pl-s">public</span> <span class="pl-stj">MovieBuilder</span> <span class="pl-en">w</span>(<span class="pl-stj">String</span> <span class="pl-v">name</span>) {
      <span class="pl-k">return</span> <span class="pl-k">new</span> <span class="pl-stj">MovieBuilder</span>(name, type);
    }

    <span class="pl-s">public</span> <span class="pl-stj">Movie</span> <span class="pl-en">build</span>() {
      <span class="pl-k">return</span> <span class="pl-k">new</span> <span class="pl-stj">Movie</span>(name, type);
    }
  }
}</pre></div>

<div class="highlight highlight-java"><pre><span class="pl-s">public</span> <span class="pl-s">class</span> <span class="pl-en">CustomerTest</span> {
  <span class="pl-st">@Test</span>
  <span class="pl-s">public</span> <span class="pl-st">void</span> <span class="pl-en">noRentalsStatement</span>() {
    assertEquals(
      <span class="pl-s1"><span class="pl-pds">"</span>Rental record for David<span class="pl-cce">\n</span>Amount <span class="pl-pds">"</span></span> <span class="pl-k">+</span>
      <span class="pl-s1"><span class="pl-pds">"</span>owed is 0.0<span class="pl-cce">\n</span>You earned 0 frequent <span class="pl-pds">"</span></span> <span class="pl-k">+</span>
      <span class="pl-s1"><span class="pl-pds">"</span>renter points<span class="pl-pds">"</span></span>,

      a<span class="pl-k">.</span>customer<span class="pl-k">.</span>w(
        <span class="pl-s1"><span class="pl-pds">"</span>David<span class="pl-pds">"</span></span>)<span class="pl-k">.</span>build()<span class="pl-k">.</span>statement());

  }

  <span class="pl-st">@Test</span>
  <span class="pl-s">public</span> <span class="pl-st">void</span> <span class="pl-en">oneNewReleaseStatement</span>() {
    assertEquals(
      <span class="pl-s1"><span class="pl-pds">"</span>Rental record for John<span class="pl-cce">\n\t</span><span class="pl-pds">"</span></span> <span class="pl-k">+</span>
      <span class="pl-s1"><span class="pl-pds">"</span>Godfather 4 9.0<span class="pl-cce">\n</span>Amount owed is <span class="pl-pds">"</span></span> <span class="pl-k">+</span>
      <span class="pl-s1"><span class="pl-pds">"</span>9.0<span class="pl-cce">\n</span>You earned 2 frequent renter <span class="pl-pds">"</span></span> <span class="pl-k">+</span>
      <span class="pl-s1"><span class="pl-pds">"</span>points<span class="pl-pds">"</span></span>,

      a<span class="pl-k">.</span>customer<span class="pl-k">.</span>w(<span class="pl-s1"><span class="pl-pds">"</span>John<span class="pl-pds">"</span></span>)<span class="pl-k">.</span>w(
        a<span class="pl-k">.</span>rental<span class="pl-k">.</span>w(
          a<span class="pl-k">.</span>movie<span class="pl-k">.</span>w(<span class="pl-c1">NEW_RELEASE</span>)))<span class="pl-k">.</span>build()

      .statement());
  }</pre></div>

<div class="highlight highlight-java"><pre>  @<span class="pl-stj">Test</span>
  <span class="pl-s">public</span> <span class="pl-st">void</span> allRentalTypesStatement() {
    assertEquals(
      <span class="pl-s1"><span class="pl-pds">"</span>Rental record for Pat<span class="pl-cce">\n\t</span><span class="pl-pds">"</span></span> <span class="pl-k">+</span>
      <span class="pl-s1"><span class="pl-pds">"</span>Godfather 4 9.0<span class="pl-cce">\n\t</span>Scarface 3.5<span class="pl-cce">\n</span><span class="pl-pds">"</span></span> <span class="pl-k">+</span>
      <span class="pl-s1"><span class="pl-pds">"</span><span class="pl-cce">\t</span>Lion King 1.5<span class="pl-cce">\n</span>Amount owed is <span class="pl-pds">"</span></span> <span class="pl-k">+</span>
      <span class="pl-s1"><span class="pl-pds">"</span>14.0<span class="pl-cce">\n</span>You earned 4 frequent renter <span class="pl-pds">"</span></span> <span class="pl-k">+</span>
      <span class="pl-s1"><span class="pl-pds">"</span>points<span class="pl-pds">"</span></span>,

      a<span class="pl-k">.</span>customer<span class="pl-k">.</span>w(<span class="pl-s1"><span class="pl-pds">"</span>Pat<span class="pl-pds">"</span></span>)<span class="pl-k">.</span>w(
        a<span class="pl-k">.</span>rental<span class="pl-k">.</span>w(a<span class="pl-k">.</span>movie<span class="pl-k">.</span>w(<span class="pl-c1">NEW_RELEASE</span>)),
        a<span class="pl-k">.</span>rental<span class="pl-k">.</span>w(a<span class="pl-k">.</span>movie<span class="pl-k">.</span>w(<span class="pl-s1"><span class="pl-pds">"</span>Scarface<span class="pl-pds">"</span></span>)<span class="pl-k">.</span>w(
                     <span class="pl-c1">REGULAR</span>)),
        a<span class="pl-k">.</span>rental<span class="pl-k">.</span>w(a<span class="pl-k">.</span>movie<span class="pl-k">.</span>w(<span class="pl-s1"><span class="pl-pds">"</span>Lion King<span class="pl-pds">"</span></span>)<span class="pl-k">.</span>w(
                     <span class="pl-c1">CHILDREN</span>)))<span class="pl-k">.</span>build()

      .statement());
  }</pre></div>

<div class="highlight highlight-java"><pre>  @<span class="pl-stj">Test</span>
  <span class="pl-s">public</span> <span class="pl-st">void</span>
  newReleaseAndRegularStatement() {
    assertEquals(
      <span class="pl-s1"><span class="pl-pds">"</span>Rental record for Steve<span class="pl-cce">\n\t</span><span class="pl-pds">"</span></span> <span class="pl-k">+</span>
      <span class="pl-s1"><span class="pl-pds">"</span>Godfather 4 9.0<span class="pl-cce">\n\t</span>Scarface 3.5<span class="pl-cce">\n</span><span class="pl-pds">"</span></span> <span class="pl-k">+</span>
      <span class="pl-s1"><span class="pl-pds">"</span>Amount owed is 12.5<span class="pl-cce">\n</span>You earned 3 <span class="pl-pds">"</span></span> <span class="pl-k">+</span>
      <span class="pl-s1"><span class="pl-pds">"</span>frequent renter points<span class="pl-pds">"</span></span>,

      a<span class="pl-k">.</span>customer<span class="pl-k">.</span>w(<span class="pl-s1"><span class="pl-pds">"</span>Steve<span class="pl-pds">"</span></span>)<span class="pl-k">.</span>w(
        a<span class="pl-k">.</span>rental<span class="pl-k">.</span>w(a<span class="pl-k">.</span>movie<span class="pl-k">.</span>w(<span class="pl-c1">NEW_RELEASE</span>)),
        a<span class="pl-k">.</span>rental<span class="pl-k">.</span>w(
          a<span class="pl-k">.</span>movie<span class="pl-k">.</span>w(
            <span class="pl-s1"><span class="pl-pds">"</span>Scarface<span class="pl-pds">"</span></span>)<span class="pl-k">.</span>w(<span class="pl-c1">REGULAR</span>)))<span class="pl-k">.</span>build()

      .statement());
  }
}</pre></div>

<h2>
<a id="comparing-the-results" class="anchor" href="#comparing-the-results" aria-hidden="true"><span class="octicon octicon-link"></span></a>Comparing the Results</h2>

<div class="highlight highlight-java"><pre><span class="pl-s">public</span> <span class="pl-s">class</span> <span class="pl-en">CustomerTest</span> {
  <span class="pl-stj">Customer</span> john, steve, pat, david;
  <span class="pl-stj">String</span> johnName <span class="pl-k">=</span> <span class="pl-s1"><span class="pl-pds">"</span>John<span class="pl-pds">"</span></span>,
    steveName <span class="pl-k">=</span> <span class="pl-s1"><span class="pl-pds">"</span>Steve<span class="pl-pds">"</span></span>,
    patName <span class="pl-k">=</span> <span class="pl-s1"><span class="pl-pds">"</span>Pat<span class="pl-pds">"</span></span>,
    davidName <span class="pl-k">=</span> <span class="pl-s1"><span class="pl-pds">"</span>David<span class="pl-pds">"</span></span>;
  <span class="pl-st">Customer</span>[] customers;

  <span class="pl-st">@Before</span>
  <span class="pl-s">public</span> <span class="pl-st">void</span> <span class="pl-en">setup</span>() {
    david <span class="pl-k">=</span> <span class="pl-stj">ObjectMother</span>
      .customerWithNoRentals(
        davidName);
    john <span class="pl-k">=</span> <span class="pl-stj">ObjectMother</span>
      .customerWithOneNewRelease(
        johnName);
    pat <span class="pl-k">=</span> <span class="pl-stj">ObjectMother</span>
      .customerWithOneOfEachRentalType(
        patName);
    steve <span class="pl-k">=</span> <span class="pl-stj">ObjectMother</span>
      .customerWithOneNewReleaseAndOneRegular(
        steveName);
    customers <span class="pl-k">=</span>
      <span class="pl-k">new</span> <span class="pl-stj">Customer</span>[]
      { david, john, steve, pat};
  }</pre></div>

<div class="highlight highlight-java"><pre>  @<span class="pl-stj">Test</span>
  <span class="pl-s">public</span> <span class="pl-st">void</span> getName() {
    assertEquals(
      davidName, david<span class="pl-k">.</span>getName());
    assertEquals(
      johnName, john<span class="pl-k">.</span>getName());
    assertEquals(
      steveName, steve<span class="pl-k">.</span>getName());
    assertEquals(
      patName, pat<span class="pl-k">.</span>getName());
  }

  @<span class="pl-stj">Test</span>
  <span class="pl-s">public</span> <span class="pl-st">void</span> statement() {
    <span class="pl-k">for</span> (<span class="pl-st">int</span> i<span class="pl-k">=</span><span class="pl-c1">0</span>; i<span class="pl-k">&lt;</span>customers<span class="pl-k">.</span>length; i<span class="pl-k">++</span>) {
      assertEquals(
        expStatement(
          <span class="pl-s1"><span class="pl-pds">"</span>Rental record for %s<span class="pl-cce">\n</span><span class="pl-pds">"</span></span> <span class="pl-k">+</span>
          <span class="pl-s1"><span class="pl-pds">"</span>%sAmount owed is %s<span class="pl-cce">\n</span><span class="pl-pds">"</span></span>  <span class="pl-k">+</span>
          <span class="pl-s1"><span class="pl-pds">"</span>You earned %s frequent <span class="pl-pds">"</span></span> <span class="pl-k">+</span>
          <span class="pl-s1"><span class="pl-pds">"</span>renter points<span class="pl-pds">"</span></span>,
          customers[i],
          rentalInfo(
            <span class="pl-s1"><span class="pl-pds">"</span><span class="pl-cce">\t</span><span class="pl-pds">"</span></span>, <span class="pl-s1"><span class="pl-pds">"</span><span class="pl-pds">"</span></span>,
            customers[i]<span class="pl-k">.</span>getRentals())),
        customers[i]<span class="pl-k">.</span>statement());
    }
  }</pre></div>

<div class="highlight highlight-java"><pre>  @<span class="pl-stj">Test</span>
  <span class="pl-s">public</span> <span class="pl-st">void</span> htmlStatement() {
    <span class="pl-k">for</span> (<span class="pl-st">int</span> i<span class="pl-k">=</span><span class="pl-c1">0</span>; i<span class="pl-k">&lt;</span>customers<span class="pl-k">.</span>length; i<span class="pl-k">++</span>) {
      assertEquals(
        expStatement(
          <span class="pl-s1"><span class="pl-pds">"</span>&lt;h1&gt;Rental record for <span class="pl-pds">"</span></span> <span class="pl-k">+</span>
          <span class="pl-s1"><span class="pl-pds">"</span>&lt;em&gt;%s&lt;/em&gt;&lt;/h1&gt;<span class="pl-cce">\n</span>%s<span class="pl-pds">"</span></span> <span class="pl-k">+</span>
          <span class="pl-s1"><span class="pl-pds">"</span>&lt;p&gt;Amount owed is &lt;em&gt;%s&lt;/em&gt;<span class="pl-pds">"</span></span> <span class="pl-k">+</span>
          <span class="pl-s1"><span class="pl-pds">"</span>&lt;/p&gt;<span class="pl-cce">\n</span>&lt;p&gt;You earned &lt;em&gt;%s<span class="pl-pds">"</span></span> <span class="pl-k">+</span>
          <span class="pl-s1"><span class="pl-pds">"</span> frequent renter points&lt;/em&gt;&lt;/p&gt;<span class="pl-pds">"</span></span>,
          customers[i],
          rentalInfo(
            <span class="pl-s1"><span class="pl-pds">"</span>&lt;p&gt;<span class="pl-pds">"</span></span>, <span class="pl-s1"><span class="pl-pds">"</span>&lt;/p&gt;<span class="pl-pds">"</span></span>,
            customers[i]<span class="pl-k">.</span>getRentals())),
        customers[i]<span class="pl-k">.</span>htmlStatement());
    }
  }

  @<span class="pl-stj">Test</span>
  (expected<span class="pl-k">=</span><span class="pl-stj">IllegalArgumentException</span><span class="pl-k">.</span>class)
  <span class="pl-s">public</span> <span class="pl-st">void</span> invalidTitle() {
    <span class="pl-stj">ObjectMother</span>
      .customerWithNoRentals(<span class="pl-s1"><span class="pl-pds">"</span>Bob<span class="pl-pds">"</span></span>)
      .addRental(
        <span class="pl-k">new</span> <span class="pl-stj">Rental</span>(
          <span class="pl-k">new</span> <span class="pl-stj">Movie</span>(<span class="pl-s1"><span class="pl-pds">"</span>Crazy, Stupid, Love.<span class="pl-pds">"</span></span>,
                    <span class="pl-stj">Movie</span><span class="pl-k">.</span><span class="pl-stj">Type</span><span class="pl-c1"><span class="pl-k">.</span>UNKNOWN</span>),
          <span class="pl-c1">4</span>));
  }</pre></div>

<div class="highlight highlight-java"><pre>  <span class="pl-s">public</span> <span class="pl-s">static</span> <span class="pl-stj">String</span> rentalInfo(
    <span class="pl-stj">String</span> startsWith,
    <span class="pl-stj">String</span> endsWith,
    <span class="pl-st">List&lt;<span class="pl-stj">Rental</span>&gt;</span> rentals) {
    <span class="pl-stj">String</span> result <span class="pl-k">=</span> <span class="pl-s1"><span class="pl-pds">"</span><span class="pl-pds">"</span></span>;
    <span class="pl-k">for</span> (<span class="pl-stj">Rental</span> rental <span class="pl-k">:</span> rentals)
      result <span class="pl-k">+=</span> <span class="pl-stj">String</span><span class="pl-k">.</span>format(
        <span class="pl-s1"><span class="pl-pds">"</span>%s%s<span class="pl-cce">\t</span>%s%s<span class="pl-cce">\n</span><span class="pl-pds">"</span></span>,
        startsWith,
        rental<span class="pl-k">.</span>getMovie()<span class="pl-k">.</span>getTitle(),
        rental<span class="pl-k">.</span>getCharge(),
        endsWith);
    <span class="pl-k">return</span> result;
  }

  <span class="pl-s">public</span> <span class="pl-s">static</span> <span class="pl-stj">String</span> expStatement(
    <span class="pl-stj">String</span> formatStr,
    <span class="pl-stj">Customer</span> customer,
    <span class="pl-stj">String</span> rentalInfo) {
    <span class="pl-k">return</span> <span class="pl-stj">String</span><span class="pl-k">.</span>format(
      formatStr,
      customer<span class="pl-k">.</span>getName(),
      rentalInfo,
      customer<span class="pl-k">.</span>getTotalCharge(),
      customer<span class="pl-k">.</span>getTotalPoints());
  }
}</pre></div>

<div class="highlight highlight-java"><pre><span class="pl-s">public</span> <span class="pl-s">class</span> <span class="pl-en">CustomerTest</span> {
  <span class="pl-st">@Test</span>
  <span class="pl-s">public</span> <span class="pl-st">void</span> <span class="pl-en">getName</span>() {
    assertEquals(
      <span class="pl-s1"><span class="pl-pds">"</span>John<span class="pl-pds">"</span></span>,
      a<span class="pl-k">.</span>customer<span class="pl-k">.</span>w(
        <span class="pl-s1"><span class="pl-pds">"</span>John<span class="pl-pds">"</span></span>)<span class="pl-k">.</span>build()<span class="pl-k">.</span>getName());
  }

  <span class="pl-st">@Test</span>
  <span class="pl-s">public</span> <span class="pl-st">void</span> <span class="pl-en">noRentalsStatement</span>() {
    assertEquals(
      <span class="pl-s1"><span class="pl-pds">"</span>Rental record for David<span class="pl-cce">\n</span>Amount <span class="pl-pds">"</span></span> <span class="pl-k">+</span>
      <span class="pl-s1"><span class="pl-pds">"</span>owed is 0.0<span class="pl-cce">\n</span>You earned 0 frequent <span class="pl-pds">"</span></span> <span class="pl-k">+</span>
      <span class="pl-s1"><span class="pl-pds">"</span>renter points<span class="pl-pds">"</span></span>,
      a<span class="pl-k">.</span>customer<span class="pl-k">.</span>w(
        <span class="pl-s1"><span class="pl-pds">"</span>David<span class="pl-pds">"</span></span>)<span class="pl-k">.</span>build()<span class="pl-k">.</span>statement());
  }

  <span class="pl-st">@Test</span>
  <span class="pl-s">public</span> <span class="pl-st">void</span> <span class="pl-en">oneNewReleaseStatement</span>() {
    assertEquals(
      <span class="pl-s1"><span class="pl-pds">"</span>Rental record for John<span class="pl-cce">\n</span><span class="pl-pds">"</span></span> <span class="pl-k">+</span>
      <span class="pl-s1"><span class="pl-pds">"</span><span class="pl-cce">\t</span>Godfather 4 9.0<span class="pl-cce">\n</span><span class="pl-pds">"</span></span> <span class="pl-k">+</span>
      <span class="pl-s1"><span class="pl-pds">"</span>Amount owed is 9.0<span class="pl-cce">\n</span><span class="pl-pds">"</span></span> <span class="pl-k">+</span>
      <span class="pl-s1"><span class="pl-pds">"</span>You earned 2 frequent renter points<span class="pl-pds">"</span></span>,
      a<span class="pl-k">.</span>customer<span class="pl-k">.</span>w(<span class="pl-s1"><span class="pl-pds">"</span>John<span class="pl-pds">"</span></span>)<span class="pl-k">.</span>w(
        a<span class="pl-k">.</span>rental<span class="pl-k">.</span>w(
          a<span class="pl-k">.</span>movie<span class="pl-k">.</span>w(
            <span class="pl-c1">NEW_RELEASE</span>)))<span class="pl-k">.</span>build()
      .statement());
  }</pre></div>

<div class="highlight highlight-java"><pre>  @<span class="pl-stj">Test</span>
  <span class="pl-s">public</span> <span class="pl-st">void</span> allRentalTypesStatement() {
    assertEquals(
      <span class="pl-s1"><span class="pl-pds">"</span>Rental record for Pat<span class="pl-cce">\n</span><span class="pl-pds">"</span></span> <span class="pl-k">+</span>
      <span class="pl-s1"><span class="pl-pds">"</span><span class="pl-cce">\t</span>Godfather 4 9.0<span class="pl-cce">\n</span><span class="pl-pds">"</span></span> <span class="pl-k">+</span>
      <span class="pl-s1"><span class="pl-pds">"</span><span class="pl-cce">\t</span>Scarface 3.5<span class="pl-cce">\n</span><span class="pl-pds">"</span></span> <span class="pl-k">+</span>
      <span class="pl-s1"><span class="pl-pds">"</span><span class="pl-cce">\t</span>Lion King 1.5<span class="pl-cce">\n</span><span class="pl-pds">"</span></span> <span class="pl-k">+</span>
      <span class="pl-s1"><span class="pl-pds">"</span>Amount owed is 14.0<span class="pl-cce">\n</span><span class="pl-pds">"</span></span> <span class="pl-k">+</span>
      <span class="pl-s1"><span class="pl-pds">"</span>You earned 4 frequent renter points<span class="pl-pds">"</span></span>,
      a<span class="pl-k">.</span>customer<span class="pl-k">.</span>w(<span class="pl-s1"><span class="pl-pds">"</span>Pat<span class="pl-pds">"</span></span>)<span class="pl-k">.</span>w(
        a<span class="pl-k">.</span>rental<span class="pl-k">.</span>w(a<span class="pl-k">.</span>movie<span class="pl-k">.</span>w(<span class="pl-c1">NEW_RELEASE</span>)),
        a<span class="pl-k">.</span>rental<span class="pl-k">.</span>w(
          a<span class="pl-k">.</span>movie<span class="pl-k">.</span>w(<span class="pl-s1"><span class="pl-pds">"</span>Scarface<span class="pl-pds">"</span></span>)<span class="pl-k">.</span>w(<span class="pl-c1">REGULAR</span>)),
        a<span class="pl-k">.</span>rental<span class="pl-k">.</span>w(
          a<span class="pl-k">.</span>movie<span class="pl-k">.</span>w(<span class="pl-s1"><span class="pl-pds">"</span>Lion King<span class="pl-pds">"</span></span>)<span class="pl-k">.</span>w(
            <span class="pl-c1">CHILDREN</span>)))<span class="pl-k">.</span>build()<span class="pl-k">.</span>statement());
  }</pre></div>

<div class="highlight highlight-java"><pre>  @<span class="pl-stj">Test</span>
  <span class="pl-s">public</span> <span class="pl-st">void</span>
  newReleaseAndRegularStatement() {
    assertEquals(
      <span class="pl-s1"><span class="pl-pds">"</span>Rental record for Steve<span class="pl-cce">\n</span><span class="pl-pds">"</span></span> <span class="pl-k">+</span>
      <span class="pl-s1"><span class="pl-pds">"</span><span class="pl-cce">\t</span>Godfather 4 9.0<span class="pl-cce">\n</span><span class="pl-pds">"</span></span> <span class="pl-k">+</span>
      <span class="pl-s1"><span class="pl-pds">"</span><span class="pl-cce">\t</span>Scarface 3.5<span class="pl-cce">\n</span><span class="pl-pds">"</span></span> <span class="pl-k">+</span>
      <span class="pl-s1"><span class="pl-pds">"</span>Amount owed is 12.5<span class="pl-cce">\n</span><span class="pl-pds">"</span></span> <span class="pl-k">+</span>
      <span class="pl-s1"><span class="pl-pds">"</span>You earned 3 frequent renter points<span class="pl-pds">"</span></span>,
      a<span class="pl-k">.</span>customer<span class="pl-k">.</span>w(<span class="pl-s1"><span class="pl-pds">"</span>Steve<span class="pl-pds">"</span></span>)<span class="pl-k">.</span>w(
        a<span class="pl-k">.</span>rental<span class="pl-k">.</span>w(a<span class="pl-k">.</span>movie<span class="pl-k">.</span>w(<span class="pl-c1">NEW_RELEASE</span>)),
        a<span class="pl-k">.</span>rental<span class="pl-k">.</span>w(
          a<span class="pl-k">.</span>movie<span class="pl-k">.</span>w(<span class="pl-s1"><span class="pl-pds">"</span>Scarface<span class="pl-pds">"</span></span>)<span class="pl-k">.</span>w(
            <span class="pl-c1">REGULAR</span>)))<span class="pl-k">.</span>build()<span class="pl-k">.</span>statement());
  }

  @<span class="pl-stj">Test</span>
  <span class="pl-s">public</span> <span class="pl-st">void</span> noRentalsHtmlStatement() {
    assertEquals(
      <span class="pl-s1"><span class="pl-pds">"</span>&lt;h1&gt;Rental record for &lt;em&gt;David<span class="pl-pds">"</span></span> <span class="pl-k">+</span>
      <span class="pl-s1"><span class="pl-pds">"</span>&lt;/em&gt;&lt;/h1&gt;<span class="pl-cce">\n</span>&lt;p&gt;Amount owed is &lt;em&gt;<span class="pl-pds">"</span></span> <span class="pl-k">+</span>
      <span class="pl-s1"><span class="pl-pds">"</span>0.0&lt;/em&gt;&lt;/p&gt;<span class="pl-cce">\n</span>&lt;p&gt;You earned &lt;em&gt;0 <span class="pl-pds">"</span></span> <span class="pl-k">+</span>
      <span class="pl-s1"><span class="pl-pds">"</span>frequent renter points&lt;/em&gt;&lt;/p&gt;<span class="pl-pds">"</span></span>,
      a<span class="pl-k">.</span>customer<span class="pl-k">.</span>w(
        <span class="pl-s1"><span class="pl-pds">"</span>David<span class="pl-pds">"</span></span>)<span class="pl-k">.</span>build()<span class="pl-k">.</span>htmlStatement());
  }</pre></div>

<div class="highlight highlight-java"><pre>  @<span class="pl-stj">Test</span>
  <span class="pl-s">public</span> <span class="pl-st">void</span> oneNewReleaseHtmlStatement() {
    assertEquals(
      <span class="pl-s1"><span class="pl-pds">"</span>&lt;h1&gt;Rental record for &lt;em&gt;John&lt;/em&gt;<span class="pl-pds">"</span></span> <span class="pl-k">+</span>
      <span class="pl-s1"><span class="pl-pds">"</span>&lt;/h1&gt;<span class="pl-cce">\n</span>&lt;p&gt;Godfather 4 9.0&lt;/p&gt;<span class="pl-cce">\n</span><span class="pl-pds">"</span></span> <span class="pl-k">+</span>
      <span class="pl-s1"><span class="pl-pds">"</span>&lt;p&gt;Amount owed is &lt;em&gt;9.0&lt;/em&gt;&lt;/p&gt;<span class="pl-pds">"</span></span> <span class="pl-k">+</span>
      <span class="pl-s1"><span class="pl-pds">"</span><span class="pl-cce">\n</span>&lt;p&gt;You earned &lt;em&gt;2 frequent <span class="pl-pds">"</span></span> <span class="pl-k">+</span>
      <span class="pl-s1"><span class="pl-pds">"</span>renter points&lt;/em&gt;&lt;/p&gt;<span class="pl-pds">"</span></span>,
      a<span class="pl-k">.</span>customer<span class="pl-k">.</span>w(<span class="pl-s1"><span class="pl-pds">"</span>John<span class="pl-pds">"</span></span>)<span class="pl-k">.</span>w(
        a<span class="pl-k">.</span>rental<span class="pl-k">.</span>w(
          a<span class="pl-k">.</span>movie<span class="pl-k">.</span>w(
            <span class="pl-c1">NEW_RELEASE</span>)))<span class="pl-k">.</span>build()
      .htmlStatement());
  }</pre></div>

<div class="highlight highlight-java"><pre>  @<span class="pl-stj">Test</span>
  <span class="pl-s">public</span> <span class="pl-st">void</span> allRentalTypesHtmlStatement() {
    assertEquals(
      <span class="pl-s1"><span class="pl-pds">"</span>&lt;h1&gt;Rental record for &lt;em&gt;Pat&lt;/em&gt;<span class="pl-pds">"</span></span> <span class="pl-k">+</span>
      <span class="pl-s1"><span class="pl-pds">"</span>&lt;/h1&gt;<span class="pl-cce">\n</span>&lt;p&gt;Godfather 4 9.0&lt;/p&gt;<span class="pl-cce">\n</span><span class="pl-pds">"</span></span> <span class="pl-k">+</span>
      <span class="pl-s1"><span class="pl-pds">"</span>&lt;p&gt;Scarface 3.5&lt;/p&gt;<span class="pl-cce">\n</span>&lt;p&gt;Lion King<span class="pl-pds">"</span></span> <span class="pl-k">+</span>
      <span class="pl-s1"><span class="pl-pds">"</span> 1.5&lt;/p&gt;<span class="pl-cce">\n</span>&lt;p&gt;Amount owed is &lt;em&gt;<span class="pl-pds">"</span></span> <span class="pl-k">+</span>
      <span class="pl-s1"><span class="pl-pds">"</span>14.0&lt;/em&gt;&lt;/p&gt;<span class="pl-cce">\n</span>&lt;p&gt;You earned &lt;em&gt;<span class="pl-pds">"</span></span> <span class="pl-k">+</span>
      <span class="pl-s1"><span class="pl-pds">"</span>4 frequent renter points&lt;/em&gt;&lt;/p&gt;<span class="pl-pds">"</span></span>,
      a<span class="pl-k">.</span>customer<span class="pl-k">.</span>w(<span class="pl-s1"><span class="pl-pds">"</span>Pat<span class="pl-pds">"</span></span>)<span class="pl-k">.</span>w(
        a<span class="pl-k">.</span>rental<span class="pl-k">.</span>w(a<span class="pl-k">.</span>movie<span class="pl-k">.</span>w(<span class="pl-c1">NEW_RELEASE</span>)),
        a<span class="pl-k">.</span>rental<span class="pl-k">.</span>w(
          a<span class="pl-k">.</span>movie<span class="pl-k">.</span>w(<span class="pl-s1"><span class="pl-pds">"</span>Scarface<span class="pl-pds">"</span></span>)<span class="pl-k">.</span>w(<span class="pl-c1">REGULAR</span>)),
        a<span class="pl-k">.</span>rental<span class="pl-k">.</span>w(
          a<span class="pl-k">.</span>movie<span class="pl-k">.</span>w(<span class="pl-s1"><span class="pl-pds">"</span>Lion King<span class="pl-pds">"</span></span>)<span class="pl-k">.</span>w(
            <span class="pl-c1">CHILDREN</span>)))<span class="pl-k">.</span>build()
      .htmlStatement());
  }</pre></div>

<div class="highlight highlight-java"><pre>  @<span class="pl-stj">Test</span>
  <span class="pl-s">public</span> <span class="pl-st">void</span>
  newReleaseAndRegularHtmlStatement() {
    assertEquals(
      <span class="pl-s1"><span class="pl-pds">"</span>&lt;h1&gt;Rental record for &lt;em&gt;Steve<span class="pl-pds">"</span></span> <span class="pl-k">+</span>
      <span class="pl-s1"><span class="pl-pds">"</span>&lt;/em&gt;&lt;/h1&gt;<span class="pl-cce">\n</span>&lt;p&gt;Godfather 4 9.0&lt;/p&gt;<span class="pl-pds">"</span></span> <span class="pl-k">+</span>
      <span class="pl-s1"><span class="pl-pds">"</span><span class="pl-cce">\n</span>&lt;p&gt;Scarface 3.5&lt;/p&gt;<span class="pl-cce">\n</span>&lt;p&gt;Amount <span class="pl-pds">"</span></span> <span class="pl-k">+</span>
      <span class="pl-s1"><span class="pl-pds">"</span>owed is &lt;em&gt;12.5&lt;/em&gt;&lt;/p&gt;<span class="pl-cce">\n</span>&lt;p&gt;<span class="pl-pds">"</span></span> <span class="pl-k">+</span>
      <span class="pl-s1"><span class="pl-pds">"</span>You earned &lt;em&gt;3 frequent renter <span class="pl-pds">"</span></span> <span class="pl-k">+</span>
      <span class="pl-s1"><span class="pl-pds">"</span>points&lt;/em&gt;&lt;/p&gt;<span class="pl-pds">"</span></span>,
      a<span class="pl-k">.</span>customer<span class="pl-k">.</span>w(<span class="pl-s1"><span class="pl-pds">"</span>Steve<span class="pl-pds">"</span></span>)<span class="pl-k">.</span>w(
        a<span class="pl-k">.</span>rental<span class="pl-k">.</span>w(a<span class="pl-k">.</span>movie<span class="pl-k">.</span>w(<span class="pl-c1">NEW_RELEASE</span>)),
        a<span class="pl-k">.</span>rental<span class="pl-k">.</span>w(
          a<span class="pl-k">.</span>movie<span class="pl-k">.</span>w(<span class="pl-s1"><span class="pl-pds">"</span>Scarface<span class="pl-pds">"</span></span>)<span class="pl-k">.</span>w(
            <span class="pl-c1">REGULAR</span>)))<span class="pl-k">.</span>build()
      .htmlStatement());
  }

  @<span class="pl-stj">Test</span>
  (expected<span class="pl-k">=</span><span class="pl-stj">IllegalArgumentException</span><span class="pl-k">.</span>class)
  <span class="pl-s">public</span> <span class="pl-st">void</span> invalidTitle() {
    a<span class="pl-k">.</span>customer<span class="pl-k">.</span>w(
      a<span class="pl-k">.</span>rental<span class="pl-k">.</span>w(
        a<span class="pl-k">.</span>movie<span class="pl-k">.</span>w(<span class="pl-c1">UNKNOWN</span>)))<span class="pl-k">.</span>build();
  }
}</pre></div>

<h2>
<a id="final-thoughts-on-our-tests" class="anchor" href="#final-thoughts-on-our-tests" aria-hidden="true"><span class="octicon octicon-link"></span></a>Final Thoughts on our Tests</h2>

<h1>
<a id="motivators" class="anchor" href="#motivators" aria-hidden="true"><span class="octicon octicon-link"></span></a>Motivators</h1>

<h3>
<a id="validate-the-system" class="anchor" href="#validate-the-system" aria-hidden="true"><span class="octicon octicon-link"></span></a>Validate the System</h3>

<h4>
<a id="common-motivators-that-would-be-a-subset-of-validate-the-system" class="anchor" href="#common-motivators-that-would-be-a-subset-of-validate-the-system" aria-hidden="true"><span class="octicon octicon-link"></span></a>Common motivators that would be a subset of Validate the System</h4>

<h3>
<a id="code-coverage" class="anchor" href="#code-coverage" aria-hidden="true"><span class="octicon octicon-link"></span></a>Code Coverage</h3>

<h3>
<a id="enable-refactoring" class="anchor" href="#enable-refactoring" aria-hidden="true"><span class="octicon octicon-link"></span></a>Enable Refactoring</h3>

<h3>
<a id="document-the-behavior-of-the-system" class="anchor" href="#document-the-behavior-of-the-system" aria-hidden="true"><span class="octicon octicon-link"></span></a>Document the Behavior of the System</h3>

<h3>
<a id="your-manager-told-you-to" class="anchor" href="#your-manager-told-you-to" aria-hidden="true"><span class="octicon octicon-link"></span></a>Your Manager Told You To</h3>

<h3>
<a id="test-driven-development" class="anchor" href="#test-driven-development" aria-hidden="true"><span class="octicon octicon-link"></span></a>Test Driven Development</h3>

<h4>
<a id="common-motivators-that-would-be-a-subset-of-tdd" class="anchor" href="#common-motivators-that-would-be-a-subset-of-tdd" aria-hidden="true"><span class="octicon octicon-link"></span></a>Common motivators that would be a subset of TDD</h4>

<h3>
<a id="customer-acceptance" class="anchor" href="#customer-acceptance" aria-hidden="true"><span class="octicon octicon-link"></span></a>Customer Acceptance</h3>

<h3>
<a id="ping-pong-pair-programming" class="anchor" href="#ping-pong-pair-programming" aria-hidden="true"><span class="octicon octicon-link"></span></a>Ping Pong Pair-Programming</h3>

<h3>
<a id="what-motivates-you-or-your-team" class="anchor" href="#what-motivates-you-or-your-team" aria-hidden="true"><span class="octicon octicon-link"></span></a>What Motivates You (or Your Team)</h3>

<h1>
<a id="types-of-tests" class="anchor" href="#types-of-tests" aria-hidden="true"><span class="octicon octicon-link"></span></a>Types of Tests</h1>

<h3>
<a id="strongly-recommended-reference-material" class="anchor" href="#strongly-recommended-reference-material" aria-hidden="true"><span class="octicon octicon-link"></span></a>Strongly Recommended Reference Material</h3>

<h2>
<a id="state-verification" class="anchor" href="#state-verification" aria-hidden="true"><span class="octicon octicon-link"></span></a>State Verification</h2>

<div class="highlight highlight-java"><pre><span class="pl-s">public</span> <span class="pl-s">class</span> <span class="pl-en">RentalTest</span> {
  <span class="pl-st">@Test</span>
  <span class="pl-s">public</span> <span class="pl-st">void</span> <span class="pl-en">rentalIsStartedIfInStore</span>() {
    <span class="pl-stj">Movie</span> movie <span class="pl-k">=</span> a<span class="pl-k">.</span>movie<span class="pl-k">.</span>build();
    <span class="pl-stj">Rental</span> rental <span class="pl-k">=</span>
      a<span class="pl-k">.</span>rental<span class="pl-k">.</span>w(movie)<span class="pl-k">.</span>build();
    <span class="pl-stj">Store</span> store <span class="pl-k">=</span> a<span class="pl-k">.</span>store<span class="pl-k">.</span>w(movie)<span class="pl-k">.</span>build();
    rental<span class="pl-k">.</span>start(store);
    assertTrue(rental<span class="pl-k">.</span>isStarted());
    assertEquals(
      <span class="pl-c1">0</span>, store<span class="pl-k">.</span>getAvailability(movie));
  }

  <span class="pl-st">@Test</span>
  <span class="pl-s">public</span> <span class="pl-st">void</span>
  <span class="pl-en">rentalDoesNotStartIfNotAvailable</span>() {
    <span class="pl-stj">Movie</span> movie <span class="pl-k">=</span> a<span class="pl-k">.</span>movie<span class="pl-k">.</span>build();
    <span class="pl-stj">Rental</span> rental <span class="pl-k">=</span> a<span class="pl-k">.</span>rental<span class="pl-k">.</span>build();
    <span class="pl-stj">Store</span> store <span class="pl-k">=</span> a<span class="pl-k">.</span>store<span class="pl-k">.</span>build();
    rental<span class="pl-k">.</span>start(store);
    assertFalse(rental<span class="pl-k">.</span>isStarted());
    assertEquals(
      <span class="pl-c1">0</span>, store<span class="pl-k">.</span>getAvailability(movie));
  }
}</pre></div>

<h2>
<a id="behavior-verification" class="anchor" href="#behavior-verification" aria-hidden="true"><span class="octicon octicon-link"></span></a>Behavior Verification</h2>

<div class="highlight highlight-java"><pre><span class="pl-s">public</span> <span class="pl-s">class</span> <span class="pl-en">RentalTest</span> {
  <span class="pl-st">@Test</span>
  <span class="pl-s">public</span> <span class="pl-st">void</span> <span class="pl-en">rentalIsStartedIfInStore</span>() {
    <span class="pl-stj">Movie</span> movie <span class="pl-k">=</span> a<span class="pl-k">.</span>movie<span class="pl-k">.</span>build();
    <span class="pl-stj">Rental</span> rental <span class="pl-k">=</span>
      a<span class="pl-k">.</span>rental<span class="pl-k">.</span>w(movie)<span class="pl-k">.</span>build();
    <span class="pl-stj">Store</span> store <span class="pl-k">=</span> mock(<span class="pl-stj">Store</span><span class="pl-k">.</span>class);
    when(store<span class="pl-k">.</span>getAvailability(movie))
      .thenReturn(<span class="pl-c1">1</span>);
    rental<span class="pl-k">.</span>start(store);
    assertTrue(rental<span class="pl-k">.</span>isStarted());
    verify(store)<span class="pl-k">.</span>remove(movie);
  }

  <span class="pl-st">@Test</span>
  <span class="pl-s">public</span> <span class="pl-st">void</span>
  <span class="pl-en">rentalDoesNotStartIfNotAvailable</span>() {
    <span class="pl-stj">Rental</span> rental <span class="pl-k">=</span> a<span class="pl-k">.</span>rental<span class="pl-k">.</span>build();
    <span class="pl-stj">Store</span> store <span class="pl-k">=</span> mock(<span class="pl-stj">Store</span><span class="pl-k">.</span>class);
    rental<span class="pl-k">.</span>start(store);
    assertFalse(rental<span class="pl-k">.</span>isStarted());
    verify(
      store, never())<span class="pl-k">.</span>remove(
        any(<span class="pl-stj">Movie</span><span class="pl-k">.</span>class));
  }
}</pre></div>

<h3>
<a id="picking-a-side" class="anchor" href="#picking-a-side" aria-hidden="true"><span class="octicon octicon-link"></span></a>Picking a Side</h3>

<h2>
<a id="unit-test" class="anchor" href="#unit-test" aria-hidden="true"><span class="octicon octicon-link"></span></a>Unit Test</h2>

<h2>
<a id="solitary-unit-test" class="anchor" href="#solitary-unit-test" aria-hidden="true"><span class="octicon octicon-link"></span></a>Solitary Unit Test</h2>

<h2>
<a id="sociable-unit-test" class="anchor" href="#sociable-unit-test" aria-hidden="true"><span class="octicon octicon-link"></span></a>Sociable Unit Test</h2>

<h2>
<a id="continuing-with-examples-from-chapter-1" class="anchor" href="#continuing-with-examples-from-chapter-1" aria-hidden="true"><span class="octicon octicon-link"></span></a>Continuing with Examples From Chapter 1</h2>

<div class="highlight highlight-java"><pre><span class="pl-s">public</span> <span class="pl-s">class</span> <span class="pl-en">CustomerTest</span> {
  <span class="pl-st">@Test</span>
  <span class="pl-s">public</span> <span class="pl-st">void</span> <span class="pl-en">getName</span>() {
    assertEquals(
      <span class="pl-s1"><span class="pl-pds">"</span>John<span class="pl-pds">"</span></span>,
      a<span class="pl-k">.</span>customer<span class="pl-k">.</span>w(
        <span class="pl-s1"><span class="pl-pds">"</span>John<span class="pl-pds">"</span></span>)<span class="pl-k">.</span>build()<span class="pl-k">.</span>getName());
  }

  <span class="pl-st">@Test</span>
  <span class="pl-s">public</span> <span class="pl-st">void</span> <span class="pl-en">noRentalsStatement</span>() {
    assertEquals(
      <span class="pl-s1"><span class="pl-pds">"</span>Rental record for David<span class="pl-cce">\n</span>Amount<span class="pl-pds">"</span></span> <span class="pl-k">+</span>
      <span class="pl-s1"><span class="pl-pds">"</span> owed is 0.0<span class="pl-cce">\n</span><span class="pl-pds">"</span></span> <span class="pl-k">+</span>
      <span class="pl-s1"><span class="pl-pds">"</span>You earned 0 frequent renter points<span class="pl-pds">"</span></span>,
      a<span class="pl-k">.</span>customer<span class="pl-k">.</span>w(
        <span class="pl-s1"><span class="pl-pds">"</span>David<span class="pl-pds">"</span></span>)<span class="pl-k">.</span>build()<span class="pl-k">.</span>statement());
  }

  <span class="pl-st">@Test</span>
  <span class="pl-s">public</span> <span class="pl-st">void</span> <span class="pl-en">oneNewReleaseStatement</span>() {
    assertEquals(
      <span class="pl-s1"><span class="pl-pds">"</span>Rental record for John<span class="pl-cce">\n</span><span class="pl-pds">"</span></span> <span class="pl-k">+</span>
      <span class="pl-s1"><span class="pl-pds">"</span><span class="pl-cce">\t</span>Godfather 4 9.0<span class="pl-cce">\n</span><span class="pl-pds">"</span></span> <span class="pl-k">+</span>
      <span class="pl-s1"><span class="pl-pds">"</span>Amount owed is 9.0<span class="pl-cce">\n</span><span class="pl-pds">"</span></span> <span class="pl-k">+</span>
      <span class="pl-s1"><span class="pl-pds">"</span>You earned 2 frequent renter points<span class="pl-pds">"</span></span>,
      a<span class="pl-k">.</span>customer<span class="pl-k">.</span>w(<span class="pl-s1"><span class="pl-pds">"</span>John<span class="pl-pds">"</span></span>)<span class="pl-k">.</span>w(
        a<span class="pl-k">.</span>rental<span class="pl-k">.</span>w(
          a<span class="pl-k">.</span>movie<span class="pl-k">.</span>w(
            <span class="pl-c1">NEW_RELEASE</span>)))<span class="pl-k">.</span>build()
      .statement());
  }</pre></div>

<div class="highlight highlight-java"><pre>  @<span class="pl-stj">Test</span>
  <span class="pl-s">public</span> <span class="pl-st">void</span> allRentalTypesStatement() {
    assertEquals(
      <span class="pl-s1"><span class="pl-pds">"</span>Rental record for Pat<span class="pl-cce">\n</span><span class="pl-pds">"</span></span> <span class="pl-k">+</span>
      <span class="pl-s1"><span class="pl-pds">"</span><span class="pl-cce">\t</span>Godfather 4 9.0<span class="pl-cce">\n</span><span class="pl-pds">"</span></span> <span class="pl-k">+</span>
      <span class="pl-s1"><span class="pl-pds">"</span><span class="pl-cce">\t</span>Scarface 3.5<span class="pl-cce">\n</span><span class="pl-pds">"</span></span> <span class="pl-k">+</span>
      <span class="pl-s1"><span class="pl-pds">"</span><span class="pl-cce">\t</span>Lion King 1.5<span class="pl-cce">\n</span><span class="pl-pds">"</span></span> <span class="pl-k">+</span>
      <span class="pl-s1"><span class="pl-pds">"</span>Amount owed is 14.0<span class="pl-cce">\n</span><span class="pl-pds">"</span></span> <span class="pl-k">+</span>
      <span class="pl-s1"><span class="pl-pds">"</span>You earned 4 frequent renter points<span class="pl-pds">"</span></span>,
      a<span class="pl-k">.</span>customer<span class="pl-k">.</span>w(<span class="pl-s1"><span class="pl-pds">"</span>Pat<span class="pl-pds">"</span></span>)<span class="pl-k">.</span>w(
        a<span class="pl-k">.</span>rental<span class="pl-k">.</span>w(a<span class="pl-k">.</span>movie<span class="pl-k">.</span>w(<span class="pl-c1">NEW_RELEASE</span>)),
        a<span class="pl-k">.</span>rental<span class="pl-k">.</span>w(
          a<span class="pl-k">.</span>movie<span class="pl-k">.</span>w(<span class="pl-s1"><span class="pl-pds">"</span>Scarface<span class="pl-pds">"</span></span>)<span class="pl-k">.</span>w(<span class="pl-c1">REGULAR</span>)),
        a<span class="pl-k">.</span>rental<span class="pl-k">.</span>w(
          a<span class="pl-k">.</span>movie<span class="pl-k">.</span>w(
            <span class="pl-s1"><span class="pl-pds">"</span>Lion King<span class="pl-pds">"</span></span>)<span class="pl-k">.</span>w(
              <span class="pl-c1">CHILDREN</span>)))<span class="pl-k">.</span>build()
      .statement());
  }</pre></div>

<div class="highlight highlight-java"><pre>  @<span class="pl-stj">Test</span>
  <span class="pl-s">public</span> <span class="pl-st">void</span>
  newReleaseAndRegularStatement() {
    assertEquals(
      <span class="pl-s1"><span class="pl-pds">"</span>Rental record for Steve<span class="pl-cce">\n</span><span class="pl-pds">"</span></span> <span class="pl-k">+</span>
      <span class="pl-s1"><span class="pl-pds">"</span><span class="pl-cce">\t</span>Godfather 4 9.0<span class="pl-cce">\n</span><span class="pl-pds">"</span></span> <span class="pl-k">+</span>
      <span class="pl-s1"><span class="pl-pds">"</span><span class="pl-cce">\t</span>Scarface 3.5<span class="pl-cce">\n</span><span class="pl-pds">"</span></span> <span class="pl-k">+</span>
      <span class="pl-s1"><span class="pl-pds">"</span>Amount owed is 12.5<span class="pl-cce">\n</span><span class="pl-pds">"</span></span> <span class="pl-k">+</span>
      <span class="pl-s1"><span class="pl-pds">"</span>You earned 3 frequent renter points<span class="pl-pds">"</span></span>,
      a<span class="pl-k">.</span>customer<span class="pl-k">.</span>w(<span class="pl-s1"><span class="pl-pds">"</span>Steve<span class="pl-pds">"</span></span>)<span class="pl-k">.</span>w(
        a<span class="pl-k">.</span>rental<span class="pl-k">.</span>w(a<span class="pl-k">.</span>movie<span class="pl-k">.</span>w(<span class="pl-c1">NEW_RELEASE</span>)),
        a<span class="pl-k">.</span>rental<span class="pl-k">.</span>w(
          a<span class="pl-k">.</span>movie<span class="pl-k">.</span>w(<span class="pl-s1"><span class="pl-pds">"</span>Scarface<span class="pl-pds">"</span></span>)<span class="pl-k">.</span>w(
            <span class="pl-c1">REGULAR</span>)))<span class="pl-k">.</span>build()
      .statement());
  }

  @<span class="pl-stj">Test</span>
  <span class="pl-s">public</span> <span class="pl-st">void</span> noRentalsHtmlStatement() {
    assertEquals(
      <span class="pl-s1"><span class="pl-pds">"</span>&lt;h1&gt;Rental record for &lt;em&gt;David<span class="pl-pds">"</span></span> <span class="pl-k">+</span>
      <span class="pl-s1"><span class="pl-pds">"</span>&lt;/em&gt;&lt;/h1&gt;<span class="pl-cce">\n</span>&lt;p&gt;Amount owed is <span class="pl-pds">"</span></span> <span class="pl-k">+</span>
      <span class="pl-s1"><span class="pl-pds">"</span>&lt;em&gt;0.0&lt;/em&gt;&lt;/p&gt;<span class="pl-cce">\n</span>&lt;p&gt;<span class="pl-pds">"</span></span> <span class="pl-k">+</span>
      <span class="pl-s1"><span class="pl-pds">"</span>You earned &lt;em&gt;0 frequent renter <span class="pl-pds">"</span></span> <span class="pl-k">+</span>
      <span class="pl-s1"><span class="pl-pds">"</span>points&lt;/em&gt;&lt;/p&gt;<span class="pl-pds">"</span></span>,
      a<span class="pl-k">.</span>customer<span class="pl-k">.</span>w(
        <span class="pl-s1"><span class="pl-pds">"</span>David<span class="pl-pds">"</span></span>)<span class="pl-k">.</span>build()<span class="pl-k">.</span>htmlStatement());
  }</pre></div>

<div class="highlight highlight-java"><pre>  @<span class="pl-stj">Test</span>
  <span class="pl-s">public</span> <span class="pl-st">void</span> oneNewReleaseHtmlStatement() {
    assertEquals(
      <span class="pl-s1"><span class="pl-pds">"</span>&lt;h1&gt;Rental record for &lt;em&gt;John&lt;/em&gt;<span class="pl-pds">"</span></span> <span class="pl-k">+</span>
      <span class="pl-s1"><span class="pl-pds">"</span>&lt;/h1&gt;<span class="pl-cce">\n</span>&lt;p&gt;Godfather 4 9.0&lt;/p&gt;<span class="pl-cce">\n</span><span class="pl-pds">"</span></span> <span class="pl-k">+</span>
      <span class="pl-s1"><span class="pl-pds">"</span>&lt;p&gt;Amount owed is &lt;em&gt;9.0&lt;/em&gt;&lt;/p&gt;<span class="pl-pds">"</span></span> <span class="pl-k">+</span>
      <span class="pl-s1"><span class="pl-pds">"</span><span class="pl-cce">\n</span>&lt;p&gt;You earned &lt;em&gt;2 frequent <span class="pl-pds">"</span></span> <span class="pl-k">+</span>
      <span class="pl-s1"><span class="pl-pds">"</span>renter points&lt;/em&gt;&lt;/p&gt;<span class="pl-pds">"</span></span>,
      a<span class="pl-k">.</span>customer<span class="pl-k">.</span>w(<span class="pl-s1"><span class="pl-pds">"</span>John<span class="pl-pds">"</span></span>)<span class="pl-k">.</span>w(
        a<span class="pl-k">.</span>rental<span class="pl-k">.</span>w(
          a<span class="pl-k">.</span>movie<span class="pl-k">.</span>w(<span class="pl-c1">NEW_RELEASE</span>)))<span class="pl-k">.</span>build()
      .htmlStatement());
  }

  @<span class="pl-stj">Test</span>
  <span class="pl-s">public</span> <span class="pl-st">void</span> allRentalTypesHtmlStatement() {
    assertEquals(
      <span class="pl-s1"><span class="pl-pds">"</span>&lt;h1&gt;Rental record for &lt;em&gt;Pat&lt;/em&gt;<span class="pl-pds">"</span></span> <span class="pl-k">+</span>
      <span class="pl-s1"><span class="pl-pds">"</span>&lt;/h1&gt;<span class="pl-cce">\n</span>&lt;p&gt;Godfather 4 9.0&lt;/p&gt;<span class="pl-cce">\n</span>&lt;p&gt;<span class="pl-pds">"</span></span> <span class="pl-k">+</span>
      <span class="pl-s1"><span class="pl-pds">"</span>Scarface 3.5&lt;/p&gt;<span class="pl-cce">\n</span>&lt;p&gt;Lion King 1.5<span class="pl-pds">"</span></span> <span class="pl-k">+</span>
      <span class="pl-s1"><span class="pl-pds">"</span>&lt;/p&gt;<span class="pl-cce">\n</span>&lt;p&gt;Amount owed is &lt;em&gt;14.0<span class="pl-pds">"</span></span> <span class="pl-k">+</span>
      <span class="pl-s1"><span class="pl-pds">"</span>&lt;/em&gt;&lt;/p&gt;<span class="pl-cce">\n</span>&lt;p&gt;You earned &lt;em&gt;4 <span class="pl-pds">"</span></span> <span class="pl-k">+</span>
      <span class="pl-s1"><span class="pl-pds">"</span>frequent renter points&lt;/em&gt;&lt;/p&gt;<span class="pl-pds">"</span></span>,
      a<span class="pl-k">.</span>customer<span class="pl-k">.</span>w(<span class="pl-s1"><span class="pl-pds">"</span>Pat<span class="pl-pds">"</span></span>)<span class="pl-k">.</span>w(
        a<span class="pl-k">.</span>rental<span class="pl-k">.</span>w(a<span class="pl-k">.</span>movie<span class="pl-k">.</span>w(<span class="pl-c1">NEW_RELEASE</span>)),
        a<span class="pl-k">.</span>rental<span class="pl-k">.</span>w(a<span class="pl-k">.</span>movie<span class="pl-k">.</span>w(<span class="pl-s1"><span class="pl-pds">"</span>Scarface<span class="pl-pds">"</span></span>)<span class="pl-k">.</span>w(
                     <span class="pl-c1">REGULAR</span>)),
        a<span class="pl-k">.</span>rental<span class="pl-k">.</span>w(a<span class="pl-k">.</span>movie<span class="pl-k">.</span>w(<span class="pl-s1"><span class="pl-pds">"</span>Lion King<span class="pl-pds">"</span></span>)<span class="pl-k">.</span>w(
                     <span class="pl-c1">CHILDREN</span>)))<span class="pl-k">.</span>build()
      .htmlStatement());
  }</pre></div>

<div class="highlight highlight-java"><pre>  @<span class="pl-stj">Test</span>
  <span class="pl-s">public</span> <span class="pl-st">void</span>
  newReleaseAndRegularHtmlStatement() {
    assertEquals(
      <span class="pl-s1"><span class="pl-pds">"</span>&lt;h1&gt;Rental record for &lt;em&gt;Steve<span class="pl-pds">"</span></span> <span class="pl-k">+</span>
      <span class="pl-s1"><span class="pl-pds">"</span>&lt;/em&gt;&lt;/h1&gt;<span class="pl-cce">\n</span>&lt;p&gt;Godfather 4 9.0&lt;/p&gt;<span class="pl-pds">"</span></span> <span class="pl-k">+</span>
      <span class="pl-s1"><span class="pl-pds">"</span><span class="pl-cce">\n</span>&lt;p&gt;Scarface 3.5&lt;/p&gt;<span class="pl-cce">\n</span>&lt;p&gt;Amount <span class="pl-pds">"</span></span> <span class="pl-k">+</span>
      <span class="pl-s1"><span class="pl-pds">"</span>owed is &lt;em&gt;12.5&lt;/em&gt;&lt;/p&gt;<span class="pl-cce">\n</span>&lt;p&gt;You <span class="pl-pds">"</span></span> <span class="pl-k">+</span>
      <span class="pl-s1"><span class="pl-pds">"</span>earned &lt;em&gt;3 frequent renter points<span class="pl-pds">"</span></span> <span class="pl-k">+</span>
      <span class="pl-s1"><span class="pl-pds">"</span>&lt;/em&gt;&lt;/p&gt;<span class="pl-pds">"</span></span>,
      a<span class="pl-k">.</span>customer<span class="pl-k">.</span>w(<span class="pl-s1"><span class="pl-pds">"</span>Steve<span class="pl-pds">"</span></span>)<span class="pl-k">.</span>w(
        a<span class="pl-k">.</span>rental<span class="pl-k">.</span>w(a<span class="pl-k">.</span>movie<span class="pl-k">.</span>w(<span class="pl-c1">NEW_RELEASE</span>)),
        a<span class="pl-k">.</span>rental<span class="pl-k">.</span>w(a<span class="pl-k">.</span>movie<span class="pl-k">.</span>w(<span class="pl-s1"><span class="pl-pds">"</span>Scarface<span class="pl-pds">"</span></span>)<span class="pl-k">.</span>w(
                     <span class="pl-c1">REGULAR</span>)))<span class="pl-k">.</span>build()
      .htmlStatement());
  }

  @<span class="pl-stj">Test</span>
  (expected<span class="pl-k">=</span><span class="pl-stj">IllegalArgumentException</span><span class="pl-k">.</span>class)
  <span class="pl-s">public</span> <span class="pl-st">void</span> invalidTitle() {
    a<span class="pl-k">.</span>customer<span class="pl-k">.</span>w(
      a<span class="pl-k">.</span>rental<span class="pl-k">.</span>w(
        a<span class="pl-k">.</span>movie<span class="pl-k">.</span>w(<span class="pl-c1">UNKNOWN</span>)))<span class="pl-k">.</span>build();
  }
}</pre></div>

<div class="highlight highlight-java"><pre><span class="pl-s">public</span> <span class="pl-s">class</span> <span class="pl-en">MovieTest</span> {
  <span class="pl-st">@Test</span>
  (expected<span class="pl-k">=</span><span class="pl-stj">IllegalArgumentException</span><span class="pl-k">.</span>class)
  <span class="pl-s">public</span> <span class="pl-st">void</span> <span class="pl-en">invalidTitle</span>() {
    a<span class="pl-k">.</span>movie<span class="pl-k">.</span>w(<span class="pl-c1">UNKNOWN</span>)<span class="pl-k">.</span>build();
  }
}</pre></div>

<div class="highlight highlight-java"><pre><span class="pl-s">public</span> <span class="pl-s">class</span> <span class="pl-en">CustomerTest</span> {
  <span class="pl-st">@Test</span>
  <span class="pl-s">public</span> <span class="pl-st">void</span> <span class="pl-en">noRentalsStatement</span>() {
    assertEquals(
      <span class="pl-s1"><span class="pl-pds">"</span>Rental record for Jim<span class="pl-cce">\n</span>Amount owed<span class="pl-pds">"</span></span> <span class="pl-k">+</span>
      <span class="pl-s1"><span class="pl-pds">"</span> is 0.0<span class="pl-cce">\n</span><span class="pl-pds">"</span></span> <span class="pl-k">+</span>
      <span class="pl-s1"><span class="pl-pds">"</span>You earned 0 frequent renter points<span class="pl-pds">"</span></span>,
      a<span class="pl-k">.</span>customer<span class="pl-k">.</span>build()<span class="pl-k">.</span>statement());
  }

  <span class="pl-st">@Test</span>
  <span class="pl-s">public</span> <span class="pl-st">void</span> <span class="pl-en">oneRentalStatement</span>() {
    assertEquals(
      <span class="pl-s1"><span class="pl-pds">"</span>Rental record for Jim<span class="pl-cce">\n\t</span>null<span class="pl-cce">\n</span><span class="pl-pds">"</span></span> <span class="pl-k">+</span>
      <span class="pl-s1"><span class="pl-pds">"</span>Amount owed is 0.0<span class="pl-cce">\n</span><span class="pl-pds">"</span></span> <span class="pl-k">+</span>
      <span class="pl-s1"><span class="pl-pds">"</span>You earned 0 frequent renter points<span class="pl-pds">"</span></span>,
      a<span class="pl-k">.</span>customer<span class="pl-k">.</span>w(

        mock(<span class="pl-stj">Rental</span><span class="pl-k">.</span>class))<span class="pl-k">.</span>build()

      .statement());
  }</pre></div>

<div class="highlight highlight-java"><pre>  @<span class="pl-stj">Test</span>
  <span class="pl-s">public</span> <span class="pl-st">void</span> twoRentalsStatement() {
    assertEquals(
      <span class="pl-s1"><span class="pl-pds">"</span>Rental record for Jim<span class="pl-cce">\n\t</span><span class="pl-pds">"</span></span> <span class="pl-k">+</span>
      <span class="pl-s1"><span class="pl-pds">"</span>null<span class="pl-cce">\n\t</span>null<span class="pl-cce">\n</span><span class="pl-pds">"</span></span> <span class="pl-k">+</span>
      <span class="pl-s1"><span class="pl-pds">"</span>Amount owed is 0.0<span class="pl-cce">\n</span><span class="pl-pds">"</span></span> <span class="pl-k">+</span>
      <span class="pl-s1"><span class="pl-pds">"</span>You earned 0 frequent renter points<span class="pl-pds">"</span></span>,
      a<span class="pl-k">.</span>customer<span class="pl-k">.</span>w(

        mock(<span class="pl-stj">Rental</span><span class="pl-k">.</span>class),
        mock(<span class="pl-stj">Rental</span><span class="pl-k">.</span>class))<span class="pl-k">.</span>build()

      .statement());
  }
}</pre></div>

<div class="highlight highlight-java"><pre><span class="pl-s">public</span> <span class="pl-s">class</span> <span class="pl-en">CustomerTest</span> {
  <span class="pl-st">@Test</span>
  <span class="pl-s">public</span> <span class="pl-st">void</span> <span class="pl-en">noRentalsCharge</span>() {
    assertEquals(
      <span class="pl-c1">0.0</span>,
      a<span class="pl-k">.</span>customer<span class="pl-k">.</span>build()<span class="pl-k">.</span>getTotalCharge(),
      <span class="pl-c1">0</span>);
  }

  <span class="pl-st">@Test</span>
  <span class="pl-s">public</span> <span class="pl-st">void</span> <span class="pl-en">twoRentalsCharge</span>() {
    <span class="pl-stj">Rental</span> rental <span class="pl-k">=</span> mock(<span class="pl-stj">Rental</span><span class="pl-k">.</span>class);
    when(rental<span class="pl-k">.</span>getCharge())<span class="pl-k">.</span>thenReturn(<span class="pl-c1">2.0</span>);
    assertEquals(
      <span class="pl-c1">4.0</span>,
      a<span class="pl-k">.</span>customer<span class="pl-k">.</span>w(
        rental,
        rental)<span class="pl-k">.</span>build()<span class="pl-k">.</span>getTotalCharge(),
      <span class="pl-c1">0</span>);
  }</pre></div>

<div class="highlight highlight-java"><pre>  @<span class="pl-stj">Test</span>
  <span class="pl-s">public</span> <span class="pl-st">void</span> threeRentalsCharge() {
    <span class="pl-stj">Rental</span> rental <span class="pl-k">=</span> mock(<span class="pl-stj">Rental</span><span class="pl-k">.</span>class);
    when(rental<span class="pl-k">.</span>getCharge())<span class="pl-k">.</span>thenReturn(<span class="pl-c1">2.0</span>);
    assertEquals(
      <span class="pl-c1">6.0</span>,
      a<span class="pl-k">.</span>customer<span class="pl-k">.</span>w(
        rental,
        rental,
        rental)<span class="pl-k">.</span>build()<span class="pl-k">.</span>getTotalCharge(),
      <span class="pl-c1">0</span>);
  }

  @<span class="pl-stj">Test</span>
  <span class="pl-s">public</span> <span class="pl-st">void</span> noRentalsPoints() {
    assertEquals(
      <span class="pl-c1">0</span>,
      a<span class="pl-k">.</span>customer<span class="pl-k">.</span>build()<span class="pl-k">.</span>getTotalPoints());
  }

  @<span class="pl-stj">Test</span>
  <span class="pl-s">public</span> <span class="pl-st">void</span> twoRentalsPoints() {
    <span class="pl-stj">Rental</span> rental <span class="pl-k">=</span> mock(<span class="pl-stj">Rental</span><span class="pl-k">.</span>class);
    when(rental<span class="pl-k">.</span>getPoints())<span class="pl-k">.</span>thenReturn(<span class="pl-c1">2</span>);
    assertEquals(
      <span class="pl-c1">4</span>,
      a<span class="pl-k">.</span>customer<span class="pl-k">.</span>w(
        rental,
        rental)<span class="pl-k">.</span>build()<span class="pl-k">.</span>getTotalPoints());
  }</pre></div>

<div class="highlight highlight-java"><pre>  @<span class="pl-stj">Test</span>
  <span class="pl-s">public</span> <span class="pl-st">void</span> threeRentalsPoints() {
    <span class="pl-stj">Rental</span> rental <span class="pl-k">=</span> mock(<span class="pl-stj">Rental</span><span class="pl-k">.</span>class);
    when(rental<span class="pl-k">.</span>getPoints())<span class="pl-k">.</span>thenReturn(<span class="pl-c1">2</span>);
    assertEquals(
      <span class="pl-c1">6</span>,
      a<span class="pl-k">.</span>customer<span class="pl-k">.</span>w(
        rental,
        rental,
        rental)<span class="pl-k">.</span>build()<span class="pl-k">.</span>getTotalPoints());
  }
}</pre></div>

<div class="highlight highlight-java"><pre><span class="pl-s">public</span> <span class="pl-s">class</span> <span class="pl-en">MovieTest</span> {
  <span class="pl-st">@Test</span>
  <span class="pl-s">public</span> <span class="pl-st">void</span> <span class="pl-en">getChargeForChildrens</span>() {
    assertEquals(
      <span class="pl-c1">1.5</span>,
      a<span class="pl-k">.</span>movie<span class="pl-k">.</span>w(
        <span class="pl-c1">CHILDREN</span>)<span class="pl-k">.</span>build()<span class="pl-k">.</span>getCharge(<span class="pl-c1">1</span>),
      <span class="pl-c1">0</span>);
    assertEquals(
      <span class="pl-c1">1.5</span>,
      a<span class="pl-k">.</span>movie<span class="pl-k">.</span>w(
        <span class="pl-c1">CHILDREN</span>)<span class="pl-k">.</span>build()<span class="pl-k">.</span>getCharge(<span class="pl-c1">2</span>),
      <span class="pl-c1">0</span>);
    assertEquals(
      <span class="pl-c1">1.5</span>,
      a<span class="pl-k">.</span>movie<span class="pl-k">.</span>w(
        <span class="pl-c1">CHILDREN</span>)<span class="pl-k">.</span>build()<span class="pl-k">.</span>getCharge(<span class="pl-c1">3</span>),
      <span class="pl-c1">0</span>);
    assertEquals(
      <span class="pl-c1">3.0</span>,
      a<span class="pl-k">.</span>movie<span class="pl-k">.</span>w(
        <span class="pl-c1">CHILDREN</span>)<span class="pl-k">.</span>build()<span class="pl-k">.</span>getCharge(<span class="pl-c1">4</span>),
      <span class="pl-c1">0</span>);
    assertEquals(
      <span class="pl-c1">4.5</span>,
      a<span class="pl-k">.</span>movie<span class="pl-k">.</span>w(
        <span class="pl-c1">CHILDREN</span>)<span class="pl-k">.</span>build()<span class="pl-k">.</span>getCharge(<span class="pl-c1">5</span>),
      <span class="pl-c1">0</span>);
  }</pre></div>

<div class="highlight highlight-java"><pre>  @<span class="pl-stj">Test</span>
  <span class="pl-s">public</span> <span class="pl-st">void</span> getChargeForNewRelease() {
    assertEquals(
      <span class="pl-c1">3.0</span>,
      a<span class="pl-k">.</span>movie<span class="pl-k">.</span>w(
        <span class="pl-c1">NEW_RELEASE</span>)<span class="pl-k">.</span>build()<span class="pl-k">.</span>getCharge(<span class="pl-c1">1</span>),
      <span class="pl-c1">0</span>);
    assertEquals(
      <span class="pl-c1">6.0</span>,
      a<span class="pl-k">.</span>movie<span class="pl-k">.</span>w(
        <span class="pl-c1">NEW_RELEASE</span>)<span class="pl-k">.</span>build()<span class="pl-k">.</span>getCharge(<span class="pl-c1">2</span>),
      <span class="pl-c1">0</span>);
    assertEquals(
      <span class="pl-c1">9.0</span>,
      a<span class="pl-k">.</span>movie<span class="pl-k">.</span>w(
        <span class="pl-c1">NEW_RELEASE</span>)<span class="pl-k">.</span>build()<span class="pl-k">.</span>getCharge(<span class="pl-c1">3</span>),
      <span class="pl-c1">0</span>);
  }</pre></div>

<div class="highlight highlight-java"><pre>  @<span class="pl-stj">Test</span>
  <span class="pl-s">public</span> <span class="pl-st">void</span> getChargeForRegular() {
    assertEquals(
      <span class="pl-c1">2.0</span>,
      a<span class="pl-k">.</span>movie<span class="pl-k">.</span>w(
        <span class="pl-c1">REGULAR</span>)<span class="pl-k">.</span>build()<span class="pl-k">.</span>getCharge(<span class="pl-c1">1</span>),
      <span class="pl-c1">0</span>);
    assertEquals(
      <span class="pl-c1">2.0</span>,
      a<span class="pl-k">.</span>movie<span class="pl-k">.</span>w(
        <span class="pl-c1">REGULAR</span>)<span class="pl-k">.</span>build()<span class="pl-k">.</span>getCharge(<span class="pl-c1">2</span>),
      <span class="pl-c1">0</span>);
    assertEquals(
      <span class="pl-c1">3.5</span>,
      a<span class="pl-k">.</span>movie<span class="pl-k">.</span>w(
        <span class="pl-c1">REGULAR</span>)<span class="pl-k">.</span>build()<span class="pl-k">.</span>getCharge(<span class="pl-c1">3</span>),
      <span class="pl-c1">0</span>);
    assertEquals(
      <span class="pl-c1">5.0</span>,
      a<span class="pl-k">.</span>movie<span class="pl-k">.</span>w(
        <span class="pl-c1">REGULAR</span>)<span class="pl-k">.</span>build()<span class="pl-k">.</span>getCharge(<span class="pl-c1">4</span>),
      <span class="pl-c1">0</span>);
  }</pre></div>

<div class="highlight highlight-java"><pre>  @<span class="pl-stj">Test</span>
  <span class="pl-s">public</span> <span class="pl-st">void</span> getPointsForChildrens() {
    assertEquals(
      <span class="pl-c1">1</span>,
      a<span class="pl-k">.</span>movie<span class="pl-k">.</span>w(
        <span class="pl-c1">CHILDREN</span>)<span class="pl-k">.</span>build()<span class="pl-k">.</span>getPoints(<span class="pl-c1">1</span>));
    assertEquals(
      <span class="pl-c1">1</span>,
      a<span class="pl-k">.</span>movie<span class="pl-k">.</span>w(
        <span class="pl-c1">CHILDREN</span>)<span class="pl-k">.</span>build()<span class="pl-k">.</span>getPoints(<span class="pl-c1">2</span>));
  }

  @<span class="pl-stj">Test</span>
  <span class="pl-s">public</span> <span class="pl-st">void</span> getPointsForNewRelease() {
    assertEquals(
      <span class="pl-c1">1</span>,
      a<span class="pl-k">.</span>movie<span class="pl-k">.</span>w(
        <span class="pl-c1">NEW_RELEASE</span>)<span class="pl-k">.</span>build()<span class="pl-k">.</span>getPoints(<span class="pl-c1">1</span>));
    assertEquals(
      <span class="pl-c1">2</span>,
      a<span class="pl-k">.</span>movie<span class="pl-k">.</span>w(
        <span class="pl-c1">NEW_RELEASE</span>)<span class="pl-k">.</span>build()<span class="pl-k">.</span>getPoints(<span class="pl-c1">2</span>));
    assertEquals(
      <span class="pl-c1">2</span>,
      a<span class="pl-k">.</span>movie<span class="pl-k">.</span>w(
        <span class="pl-c1">NEW_RELEASE</span>)<span class="pl-k">.</span>build()<span class="pl-k">.</span>getPoints(<span class="pl-c1">3</span>));
  }</pre></div>

<div class="highlight highlight-java"><pre>  @<span class="pl-stj">Test</span>
  <span class="pl-s">public</span> <span class="pl-st">void</span> getPointsForRegular() {
    assertEquals(
      <span class="pl-c1">1</span>,
      a<span class="pl-k">.</span>movie<span class="pl-k">.</span>w(
        <span class="pl-c1">REGULAR</span>)<span class="pl-k">.</span>build()<span class="pl-k">.</span>getPoints(<span class="pl-c1">1</span>));
    assertEquals(
      <span class="pl-c1">1</span>,
      a<span class="pl-k">.</span>movie<span class="pl-k">.</span>w(
        <span class="pl-c1">REGULAR</span>)<span class="pl-k">.</span>build()<span class="pl-k">.</span>getPoints(<span class="pl-c1">2</span>));
  }
}</pre></div>

<div class="highlight highlight-java"><pre><span class="pl-s">public</span> <span class="pl-s">class</span> <span class="pl-en">CustomerTest</span> {
  <span class="pl-st">@Test</span>
  <span class="pl-s">public</span> <span class="pl-st">void</span> <span class="pl-en">allRentalTypesStatement</span>() {
    assertEquals(
      <span class="pl-s1"><span class="pl-pds">"</span>Rental record for Pat<span class="pl-cce">\n</span><span class="pl-pds">"</span></span> <span class="pl-k">+</span>
      <span class="pl-s1"><span class="pl-pds">"</span><span class="pl-cce">\t</span>Godfather 4 9.0<span class="pl-cce">\n</span><span class="pl-pds">"</span></span> <span class="pl-k">+</span>
      <span class="pl-s1"><span class="pl-pds">"</span><span class="pl-cce">\t</span>Scarface 3.5<span class="pl-cce">\n</span><span class="pl-pds">"</span></span> <span class="pl-k">+</span>
      <span class="pl-s1"><span class="pl-pds">"</span><span class="pl-cce">\t</span>Lion King 1.5<span class="pl-cce">\n</span><span class="pl-pds">"</span></span> <span class="pl-k">+</span>
      <span class="pl-s1"><span class="pl-pds">"</span>Amount owed is 14.0<span class="pl-cce">\n</span><span class="pl-pds">"</span></span> <span class="pl-k">+</span>
      <span class="pl-s1"><span class="pl-pds">"</span>You earned 4 frequent renter points<span class="pl-pds">"</span></span>,
      a<span class="pl-k">.</span>customer<span class="pl-k">.</span>w(<span class="pl-s1"><span class="pl-pds">"</span>Pat<span class="pl-pds">"</span></span>)<span class="pl-k">.</span>w(
        a<span class="pl-k">.</span>rental<span class="pl-k">.</span>w(a<span class="pl-k">.</span>movie<span class="pl-k">.</span>w(<span class="pl-c1">NEW_RELEASE</span>)),
        a<span class="pl-k">.</span>rental<span class="pl-k">.</span>w(a<span class="pl-k">.</span>movie<span class="pl-k">.</span>w(<span class="pl-s1"><span class="pl-pds">"</span>Scarface<span class="pl-pds">"</span></span>)<span class="pl-k">.</span>w(
                     <span class="pl-c1">REGULAR</span>)),
        a<span class="pl-k">.</span>rental<span class="pl-k">.</span>w(a<span class="pl-k">.</span>movie<span class="pl-k">.</span>w(<span class="pl-s1"><span class="pl-pds">"</span>Lion King<span class="pl-pds">"</span></span>)<span class="pl-k">.</span>w(
                     <span class="pl-c1">CHILDREN</span>)))
      .build()<span class="pl-k">.</span>statement());
  }</pre></div>

<div class="highlight highlight-java"><pre>  @<span class="pl-stj">Test</span>
  <span class="pl-s">public</span> <span class="pl-st">void</span> allRentalTypesHtmlStatement() {
    assertEquals(
      <span class="pl-s1"><span class="pl-pds">"</span>&lt;h1&gt;Rental record for <span class="pl-pds">"</span></span> <span class="pl-k">+</span>
      <span class="pl-s1"><span class="pl-pds">"</span>&lt;em&gt;Pat&lt;/em&gt;&lt;/h1&gt;<span class="pl-cce">\n</span><span class="pl-pds">"</span></span> <span class="pl-k">+</span>
      <span class="pl-s1"><span class="pl-pds">"</span>&lt;p&gt;Godfather 4 9.0&lt;/p&gt;<span class="pl-cce">\n</span><span class="pl-pds">"</span></span> <span class="pl-k">+</span>
      <span class="pl-s1"><span class="pl-pds">"</span>&lt;p&gt;Scarface 3.5&lt;/p&gt;<span class="pl-cce">\n</span><span class="pl-pds">"</span></span> <span class="pl-k">+</span>
      <span class="pl-s1"><span class="pl-pds">"</span>&lt;p&gt;Lion King 1.5&lt;/p&gt;<span class="pl-cce">\n</span><span class="pl-pds">"</span></span> <span class="pl-k">+</span>
      <span class="pl-s1"><span class="pl-pds">"</span>&lt;p&gt;Amount owed is <span class="pl-pds">"</span></span> <span class="pl-k">+</span>
      <span class="pl-s1"><span class="pl-pds">"</span>&lt;em&gt;14.0&lt;/em&gt;&lt;/p&gt;<span class="pl-cce">\n</span>&lt;p&gt;<span class="pl-pds">"</span></span> <span class="pl-k">+</span>
      <span class="pl-s1"><span class="pl-pds">"</span>You earned &lt;em&gt;4 frequent <span class="pl-pds">"</span></span> <span class="pl-k">+</span>
      <span class="pl-s1"><span class="pl-pds">"</span>renter points&lt;/em&gt;&lt;/p&gt;<span class="pl-pds">"</span></span>,
      a<span class="pl-k">.</span>customer<span class="pl-k">.</span>w(<span class="pl-s1"><span class="pl-pds">"</span>Pat<span class="pl-pds">"</span></span>)<span class="pl-k">.</span>w(
        a<span class="pl-k">.</span>rental<span class="pl-k">.</span>w(a<span class="pl-k">.</span>movie<span class="pl-k">.</span>w(<span class="pl-c1">NEW_RELEASE</span>)),
        a<span class="pl-k">.</span>rental<span class="pl-k">.</span>w(a<span class="pl-k">.</span>movie<span class="pl-k">.</span>w(<span class="pl-s1"><span class="pl-pds">"</span>Scarface<span class="pl-pds">"</span></span>)<span class="pl-k">.</span>w(
                     <span class="pl-c1">REGULAR</span>)),
        a<span class="pl-k">.</span>rental<span class="pl-k">.</span>w(a<span class="pl-k">.</span>movie<span class="pl-k">.</span>w(<span class="pl-s1"><span class="pl-pds">"</span>Lion King<span class="pl-pds">"</span></span>)<span class="pl-k">.</span>w(
                     <span class="pl-c1">CHILDREN</span>)))
      .build()<span class="pl-k">.</span>htmlStatement());
  }
}</pre></div>

<h2>
<a id="final-thoughts-again" class="anchor" href="#final-thoughts-again" aria-hidden="true"><span class="octicon octicon-link"></span></a>Final Thoughts, Again</h2>

<h3>
<a id="the-failure" class="anchor" href="#the-failure" aria-hidden="true"><span class="octicon octicon-link"></span></a>The Failure</h3>

<div class="highlight highlight-java"><pre><span class="pl-s">public</span> <span class="pl-s">class</span> <span class="pl-en">CustomerTest</span> {
  <span class="pl-st">@Test</span>
  <span class="pl-s">public</span> <span class="pl-st">void</span> <span class="pl-en">getName</span>() {
    assertEquals(
      <span class="pl-s1"><span class="pl-pds">"</span>John<span class="pl-pds">"</span></span>,
      a<span class="pl-k">.</span>customer<span class="pl-k">.</span>w(
        <span class="pl-s1"><span class="pl-pds">"</span>John<span class="pl-pds">"</span></span>)<span class="pl-k">.</span>build()<span class="pl-k">.</span>getName());
  }

  <span class="pl-st">@Test</span>
  <span class="pl-s">public</span> <span class="pl-st">void</span> <span class="pl-en">noRentalsStatement</span>() {
    assertEquals(
      <span class="pl-s1"><span class="pl-pds">"</span>Rental record for Jim<span class="pl-cce">\n</span>Amount owed<span class="pl-pds">"</span></span> <span class="pl-k">+</span>
      <span class="pl-s1"><span class="pl-pds">"</span> is 0.0<span class="pl-cce">\n</span>You earned 0 frequent <span class="pl-pds">"</span></span> <span class="pl-k">+</span>
      <span class="pl-s1"><span class="pl-pds">"</span>renter points<span class="pl-pds">"</span></span>,
      a<span class="pl-k">.</span>customer<span class="pl-k">.</span>build()<span class="pl-k">.</span>statement());
  }

  <span class="pl-st">@Test</span>
  <span class="pl-s">public</span> <span class="pl-st">void</span> <span class="pl-en">oneRentalStatement</span>() {
    assertEquals(
      <span class="pl-s1"><span class="pl-pds">"</span>Rental record for Jim<span class="pl-cce">\n\t</span>null<span class="pl-cce">\n</span><span class="pl-pds">"</span></span> <span class="pl-k">+</span>
      <span class="pl-s1"><span class="pl-pds">"</span>Amount owed is 0.0<span class="pl-cce">\n</span><span class="pl-pds">"</span></span> <span class="pl-k">+</span>
      <span class="pl-s1"><span class="pl-pds">"</span>You earned 0 frequent renter points<span class="pl-pds">"</span></span>,
      a<span class="pl-k">.</span>customer<span class="pl-k">.</span>w(
        mock(<span class="pl-stj">Rental</span><span class="pl-k">.</span>class))<span class="pl-k">.</span>build()
      .statement());
  }</pre></div>

<div class="highlight highlight-java"><pre>  @<span class="pl-stj">Test</span>
  <span class="pl-s">public</span> <span class="pl-st">void</span> twoRentalsStatement() {
    assertEquals(
      <span class="pl-s1"><span class="pl-pds">"</span>Rental record for Jim<span class="pl-cce">\n\t</span>null<span class="pl-cce">\n</span><span class="pl-pds">"</span></span> <span class="pl-k">+</span>
      <span class="pl-s1"><span class="pl-pds">"</span><span class="pl-cce">\t</span>null<span class="pl-cce">\n</span>Amount owed is 0.0<span class="pl-cce">\n</span><span class="pl-pds">"</span></span> <span class="pl-k">+</span>
      <span class="pl-s1"><span class="pl-pds">"</span>You earned 0 frequent renter points<span class="pl-pds">"</span></span>,
      a<span class="pl-k">.</span>customer<span class="pl-k">.</span>w(
        mock(<span class="pl-stj">Rental</span><span class="pl-k">.</span>class),
        mock(<span class="pl-stj">Rental</span><span class="pl-k">.</span>class))<span class="pl-k">.</span>build()
      .statement());
  }

  @<span class="pl-stj">Test</span>
  <span class="pl-s">public</span> <span class="pl-st">void</span> noRentalsHtmlStatement() {
    assertEquals(
      <span class="pl-s1"><span class="pl-pds">"</span>&lt;h1&gt;Rental record for &lt;em&gt;Jim&lt;/em&gt;<span class="pl-pds">"</span></span> <span class="pl-k">+</span>
      <span class="pl-s1"><span class="pl-pds">"</span>&lt;/h1&gt;<span class="pl-cce">\n</span>&lt;p&gt;Amount owed is &lt;em&gt;0.0<span class="pl-pds">"</span></span> <span class="pl-k">+</span>
      <span class="pl-s1"><span class="pl-pds">"</span>&lt;/em&gt;&lt;/p&gt;<span class="pl-cce">\n</span>&lt;p&gt;You earned &lt;em&gt;0 <span class="pl-pds">"</span></span> <span class="pl-k">+</span>
      <span class="pl-s1"><span class="pl-pds">"</span>frequent renter points&lt;/em&gt;&lt;/p&gt;<span class="pl-pds">"</span></span>,
      a<span class="pl-k">.</span>customer<span class="pl-k">.</span>build()<span class="pl-k">.</span>htmlStatement());
  }</pre></div>

<div class="highlight highlight-java"><pre>  @<span class="pl-stj">Test</span>
  <span class="pl-s">public</span> <span class="pl-st">void</span> oneRentalHtmlStatement() {
    <span class="pl-stj">Rental</span> rental <span class="pl-k">=</span> mock(<span class="pl-stj">Rental</span><span class="pl-k">.</span>class);
    assertEquals(
      <span class="pl-s1"><span class="pl-pds">"</span>&lt;h1&gt;Rental record for &lt;em&gt;Jim&lt;/em&gt;<span class="pl-pds">"</span></span> <span class="pl-k">+</span>
      <span class="pl-s1"><span class="pl-pds">"</span>&lt;/h1&gt;<span class="pl-cce">\n</span>&lt;p&gt;null&lt;/p&gt;<span class="pl-cce">\n</span>&lt;p&gt;Amount owed <span class="pl-pds">"</span></span> <span class="pl-k">+</span>
      <span class="pl-s1"><span class="pl-pds">"</span>is &lt;em&gt;0.0&lt;/em&gt;&lt;/p&gt;<span class="pl-cce">\n</span>&lt;p&gt;You earned <span class="pl-pds">"</span></span> <span class="pl-k">+</span>
      <span class="pl-s1"><span class="pl-pds">"</span>&lt;em&gt;0 frequent renter points&lt;/em&gt;<span class="pl-pds">"</span></span> <span class="pl-k">+</span>
      <span class="pl-s1"><span class="pl-pds">"</span>&lt;/p&gt;<span class="pl-pds">"</span></span>,
      a<span class="pl-k">.</span>customer<span class="pl-k">.</span>w(
        mock(<span class="pl-stj">Rental</span><span class="pl-k">.</span>class))<span class="pl-k">.</span>build()
      .htmlStatement());
  }

  @<span class="pl-stj">Test</span>
  <span class="pl-s">public</span> <span class="pl-st">void</span> twoRentalsHtmlStatement() {
    assertEquals(
      <span class="pl-s1"><span class="pl-pds">"</span>&lt;h1&gt;Rental record for &lt;em&gt;Jim&lt;/em&gt;<span class="pl-pds">"</span></span> <span class="pl-k">+</span>
      <span class="pl-s1"><span class="pl-pds">"</span>&lt;/h1&gt;<span class="pl-cce">\n</span>&lt;p&gt;null&lt;/p&gt;<span class="pl-cce">\n</span>&lt;p&gt;null&lt;/p&gt;<span class="pl-cce">\n</span><span class="pl-pds">"</span></span> <span class="pl-k">+</span>
      <span class="pl-s1"><span class="pl-pds">"</span>&lt;p&gt;Amount owed is &lt;em&gt;0.0&lt;/em&gt;&lt;/p&gt;<span class="pl-pds">"</span></span> <span class="pl-k">+</span>
      <span class="pl-s1"><span class="pl-pds">"</span><span class="pl-cce">\n</span>&lt;p&gt;You earned &lt;em&gt;0 frequent<span class="pl-pds">"</span></span> <span class="pl-k">+</span>
      <span class="pl-s1"><span class="pl-pds">"</span> renter points&lt;/em&gt;&lt;/p&gt;<span class="pl-pds">"</span></span>,
      a<span class="pl-k">.</span>customer<span class="pl-k">.</span>w(
        mock(<span class="pl-stj">Rental</span><span class="pl-k">.</span>class),
        mock(<span class="pl-stj">Rental</span><span class="pl-k">.</span>class))<span class="pl-k">.</span>build()
      .htmlStatement());
  }</pre></div>

<div class="highlight highlight-java"><pre>  @<span class="pl-stj">Test</span>
  <span class="pl-s">public</span> <span class="pl-st">void</span> noRentalsCharge() {
    assertEquals(
      <span class="pl-c1">0.0</span>,
      a<span class="pl-k">.</span>customer<span class="pl-k">.</span>build()<span class="pl-k">.</span>getTotalCharge(),
      <span class="pl-c1">0</span>);
  }

  @<span class="pl-stj">Test</span>
  <span class="pl-s">public</span> <span class="pl-st">void</span> twoRentalsCharge() {
    <span class="pl-stj">Rental</span> rental <span class="pl-k">=</span> mock(<span class="pl-stj">Rental</span><span class="pl-k">.</span>class);
    when(rental<span class="pl-k">.</span>getCharge())<span class="pl-k">.</span>thenReturn(<span class="pl-c1">2.0</span>);
    assertEquals(
      <span class="pl-c1">6.0</span>,
      a<span class="pl-k">.</span>customer<span class="pl-k">.</span>w(
        rental,
        rental)<span class="pl-k">.</span>build()<span class="pl-k">.</span>getTotalCharge(),
      <span class="pl-c1">0</span>);
  }

  @<span class="pl-stj">Test</span>
  <span class="pl-s">public</span> <span class="pl-st">void</span> threeRentalsCharge() {
    <span class="pl-stj">Rental</span> rental <span class="pl-k">=</span> mock(<span class="pl-stj">Rental</span><span class="pl-k">.</span>class);
    when(rental<span class="pl-k">.</span>getCharge())<span class="pl-k">.</span>thenReturn(<span class="pl-c1">2.0</span>);
    assertEquals(
      <span class="pl-c1">6.0</span>,
      a<span class="pl-k">.</span>customer<span class="pl-k">.</span>w(
        rental,
        rental,
        rental)<span class="pl-k">.</span>build()<span class="pl-k">.</span>getTotalCharge(),
      <span class="pl-c1">0</span>);
  }</pre></div>

<div class="highlight highlight-java"><pre>  @<span class="pl-stj">Test</span>
  <span class="pl-s">public</span> <span class="pl-st">void</span> noRentalsPoints() {
    assertEquals(
      <span class="pl-c1">0</span>,
      a<span class="pl-k">.</span>customer<span class="pl-k">.</span>build()<span class="pl-k">.</span>getTotalPoints());
  }

  @<span class="pl-stj">Test</span>
  <span class="pl-s">public</span> <span class="pl-st">void</span> twoRentalsPoints() {
    <span class="pl-stj">Rental</span> rental <span class="pl-k">=</span> mock(<span class="pl-stj">Rental</span><span class="pl-k">.</span>class);
    when(rental<span class="pl-k">.</span>getPoints())<span class="pl-k">.</span>thenReturn(<span class="pl-c1">2</span>);
    assertEquals(
      <span class="pl-c1">4</span>,
      a<span class="pl-k">.</span>customer<span class="pl-k">.</span>w(
        rental,
        rental)<span class="pl-k">.</span>build()<span class="pl-k">.</span>getTotalPoints());
  }

  @<span class="pl-stj">Test</span>
  <span class="pl-s">public</span> <span class="pl-st">void</span> threeRentalsPoints() {
    <span class="pl-stj">Rental</span> rental <span class="pl-k">=</span> mock(<span class="pl-stj">Rental</span><span class="pl-k">.</span>class);
    when(rental<span class="pl-k">.</span>getPoints())<span class="pl-k">.</span>thenReturn(<span class="pl-c1">2</span>);
    assertEquals(
      <span class="pl-c1">6</span>,
      a<span class="pl-k">.</span>customer<span class="pl-k">.</span>w(
        rental,
        rental,
        rental)<span class="pl-k">.</span>build()<span class="pl-k">.</span>getTotalPoints());
  }
}</pre></div>

<div class="highlight highlight-java"><pre><span class="pl-s">public</span> <span class="pl-s">class</span> <span class="pl-en">CustomerTest</span> {
  <span class="pl-st">@Test</span>
  <span class="pl-s">public</span> <span class="pl-st">void</span> <span class="pl-en">allRentalTypesStatement</span>() {
    assertEquals(
      <span class="pl-s1"><span class="pl-pds">"</span>Rental record for Pat<span class="pl-cce">\n</span><span class="pl-pds">"</span></span> <span class="pl-k">+</span>
      <span class="pl-s1"><span class="pl-pds">"</span><span class="pl-cce">\t</span>Godfather 4 9.0<span class="pl-cce">\n</span><span class="pl-pds">"</span></span> <span class="pl-k">+</span>
      <span class="pl-s1"><span class="pl-pds">"</span><span class="pl-cce">\t</span>Scarface 3.5<span class="pl-cce">\n</span><span class="pl-pds">"</span></span> <span class="pl-k">+</span>
      <span class="pl-s1"><span class="pl-pds">"</span><span class="pl-cce">\t</span>Lion King 1.5<span class="pl-cce">\n</span><span class="pl-pds">"</span></span> <span class="pl-k">+</span>
      <span class="pl-s1"><span class="pl-pds">"</span>Amount owed is 14.0<span class="pl-cce">\n</span><span class="pl-pds">"</span></span> <span class="pl-k">+</span>
      <span class="pl-s1"><span class="pl-pds">"</span>You earned 4 frequent renter points<span class="pl-pds">"</span></span>,
      a<span class="pl-k">.</span>customer<span class="pl-k">.</span>w(<span class="pl-s1"><span class="pl-pds">"</span>Pat<span class="pl-pds">"</span></span>)<span class="pl-k">.</span>w(
        a<span class="pl-k">.</span>rental<span class="pl-k">.</span>w(a<span class="pl-k">.</span>movie<span class="pl-k">.</span>w(<span class="pl-c1">NEW_RELEASE</span>)),
        a<span class="pl-k">.</span>rental<span class="pl-k">.</span>w(a<span class="pl-k">.</span>movie<span class="pl-k">.</span>w(<span class="pl-s1"><span class="pl-pds">"</span>Scarface<span class="pl-pds">"</span></span>)<span class="pl-k">.</span>w(
                     <span class="pl-c1">REGULAR</span>)),
        a<span class="pl-k">.</span>rental<span class="pl-k">.</span>w(a<span class="pl-k">.</span>movie<span class="pl-k">.</span>w(<span class="pl-s1"><span class="pl-pds">"</span>Lion King<span class="pl-pds">"</span></span>)<span class="pl-k">.</span>w(
                     <span class="pl-c1">CHILDREN</span>)))
      .build()<span class="pl-k">.</span>statement());
  }</pre></div>

<div class="highlight highlight-java"><pre>  @<span class="pl-stj">Test</span>
  <span class="pl-s">public</span> <span class="pl-st">void</span> allRentalTypesHtmlStatement() {
    assertEquals(
      <span class="pl-s1"><span class="pl-pds">"</span>&lt;h1&gt;Rental record for &lt;em&gt;Pat<span class="pl-pds">"</span></span> <span class="pl-k">+</span>
      <span class="pl-s1"><span class="pl-pds">"</span>&lt;/em&gt;&lt;/h1&gt;<span class="pl-cce">\n</span><span class="pl-pds">"</span></span> <span class="pl-k">+</span>
      <span class="pl-s1"><span class="pl-pds">"</span>&lt;p&gt;Godfather 4 9.0&lt;/p&gt;<span class="pl-cce">\n</span><span class="pl-pds">"</span></span> <span class="pl-k">+</span>
      <span class="pl-s1"><span class="pl-pds">"</span>&lt;p&gt;Scarface 3.5&lt;/p&gt;<span class="pl-cce">\n</span><span class="pl-pds">"</span></span> <span class="pl-k">+</span>
      <span class="pl-s1"><span class="pl-pds">"</span>&lt;p&gt;Lion King 1.5&lt;/p&gt;<span class="pl-cce">\n</span><span class="pl-pds">"</span></span> <span class="pl-k">+</span>
      <span class="pl-s1"><span class="pl-pds">"</span>&lt;p&gt;Amount owed is <span class="pl-pds">"</span></span> <span class="pl-k">+</span>
      <span class="pl-s1"><span class="pl-pds">"</span>&lt;em&gt;14.0&lt;/em&gt;&lt;/p&gt;<span class="pl-cce">\n</span>&lt;p&gt;<span class="pl-pds">"</span></span> <span class="pl-k">+</span>
      <span class="pl-s1"><span class="pl-pds">"</span>You earned &lt;em&gt;4 <span class="pl-pds">"</span></span> <span class="pl-k">+</span>
      <span class="pl-s1"><span class="pl-pds">"</span>frequent renter points&lt;/em&gt;&lt;/p&gt;<span class="pl-pds">"</span></span>,
      a<span class="pl-k">.</span>customer<span class="pl-k">.</span>w(<span class="pl-s1"><span class="pl-pds">"</span>Pat<span class="pl-pds">"</span></span>)<span class="pl-k">.</span>w(
        a<span class="pl-k">.</span>rental<span class="pl-k">.</span>w(a<span class="pl-k">.</span>movie<span class="pl-k">.</span>w(<span class="pl-c1">NEW_RELEASE</span>)),
        a<span class="pl-k">.</span>rental<span class="pl-k">.</span>w(a<span class="pl-k">.</span>movie<span class="pl-k">.</span>w(<span class="pl-s1"><span class="pl-pds">"</span>Scarface<span class="pl-pds">"</span></span>)<span class="pl-k">.</span>w(
                     <span class="pl-c1">REGULAR</span>)),
        a<span class="pl-k">.</span>rental<span class="pl-k">.</span>w(a<span class="pl-k">.</span>movie<span class="pl-k">.</span>w(<span class="pl-s1"><span class="pl-pds">"</span>Lion King<span class="pl-pds">"</span></span>)<span class="pl-k">.</span>w(
                     <span class="pl-c1">CHILDREN</span>)))
      .build()<span class="pl-k">.</span>htmlStatement());
  }
}</pre></div>

<div class="highlight highlight-java"><pre><span class="pl-s">public</span> <span class="pl-s">class</span> <span class="pl-en">Customer</span> {

  <span class="pl-s">private</span> <span class="pl-stj">String</span> name;
  <span class="pl-s">private</span> <span class="pl-st">List&lt;<span class="pl-stj">Rental</span>&gt;</span> rentals
  <span class="pl-k">=</span> <span class="pl-k">new</span> <span class="pl-st">ArrayList&lt;<span class="pl-stj">Rental</span>&gt;</span>();

  <span class="pl-s">public</span> <span class="pl-en">Customer</span>(<span class="pl-stj">String</span> <span class="pl-v">name</span>) {
    <span class="pl-v">this</span><span class="pl-k">.</span>name <span class="pl-k">=</span> name;
  }

  <span class="pl-s">public</span> <span class="pl-stj">String</span> <span class="pl-en">getName</span>() {
    <span class="pl-k">return</span> name;
  }

  <span class="pl-s">public</span> <span class="pl-st">void</span> <span class="pl-en">addRental</span>(<span class="pl-stj">Rental</span> <span class="pl-v">rental</span>) {
    rentals<span class="pl-k">.</span>add(rental);
  }

  <span class="pl-s">public</span> <span class="pl-stj">String</span> <span class="pl-en">statement</span>() {
    <span class="pl-stj">String</span> result <span class="pl-k">=</span>
      <span class="pl-s1"><span class="pl-pds">"</span>Rental record for <span class="pl-pds">"</span></span> <span class="pl-k">+</span>
      getName() <span class="pl-k">+</span> <span class="pl-s1"><span class="pl-pds">"</span><span class="pl-cce">\n</span><span class="pl-pds">"</span></span>;
    <span class="pl-k">for</span> (<span class="pl-stj">Rental</span> rental <span class="pl-k">:</span> rentals)
      result <span class="pl-k">+=</span>
        <span class="pl-s1"><span class="pl-pds">"</span><span class="pl-cce">\t</span><span class="pl-pds">"</span></span> <span class="pl-k">+</span> rental<span class="pl-k">.</span>getLineItem() <span class="pl-k">+</span> <span class="pl-s1"><span class="pl-pds">"</span><span class="pl-cce">\n</span><span class="pl-pds">"</span></span>;
    result <span class="pl-k">+=</span> <span class="pl-s1"><span class="pl-pds">"</span>Amount owed is <span class="pl-pds">"</span></span> <span class="pl-k">+</span>
      getTotalCharge() <span class="pl-k">+</span> <span class="pl-s1"><span class="pl-pds">"</span><span class="pl-cce">\n</span><span class="pl-pds">"</span></span> <span class="pl-k">+</span>
      <span class="pl-s1"><span class="pl-pds">"</span>You earned <span class="pl-pds">"</span></span> <span class="pl-k">+</span> getTotalPoints() <span class="pl-k">+</span>
      <span class="pl-s1"><span class="pl-pds">"</span> frequent renter points<span class="pl-pds">"</span></span>;
    <span class="pl-k">return</span> result;
  }</pre></div>

<div class="highlight highlight-java"><pre>  <span class="pl-s">public</span> <span class="pl-stj">String</span> htmlStatement() {
    <span class="pl-stj">String</span> result <span class="pl-k">=</span>
      <span class="pl-s1"><span class="pl-pds">"</span>&lt;h1&gt;Rental record for &lt;em&gt;<span class="pl-pds">"</span></span> <span class="pl-k">+</span>
      getName() <span class="pl-k">+</span> <span class="pl-s1"><span class="pl-pds">"</span>&lt;/em&gt;&lt;/h1&gt;<span class="pl-cce">\n</span><span class="pl-pds">"</span></span>;
    <span class="pl-k">for</span> (<span class="pl-stj">Rental</span> rental <span class="pl-k">:</span> rentals)
      result <span class="pl-k">+=</span>
        <span class="pl-s1"><span class="pl-pds">"</span>&lt;p&gt;<span class="pl-pds">"</span></span> <span class="pl-k">+</span> rental<span class="pl-k">.</span>getLineItem() <span class="pl-k">+</span>
        <span class="pl-s1"><span class="pl-pds">"</span>&lt;/p&gt;<span class="pl-cce">\n</span><span class="pl-pds">"</span></span>;
    result <span class="pl-k">+=</span>
      <span class="pl-s1"><span class="pl-pds">"</span>&lt;p&gt;Amount owed is &lt;em&gt;<span class="pl-pds">"</span></span> <span class="pl-k">+</span>
      getTotalCharge() <span class="pl-k">+</span> <span class="pl-s1"><span class="pl-pds">"</span>&lt;/em&gt;&lt;/p&gt;<span class="pl-cce">\n</span><span class="pl-pds">"</span></span> <span class="pl-k">+</span>
      <span class="pl-s1"><span class="pl-pds">"</span>&lt;p&gt;You earned &lt;em&gt;<span class="pl-pds">"</span></span> <span class="pl-k">+</span>
      getTotalPoints() <span class="pl-k">+</span>
      <span class="pl-s1"><span class="pl-pds">"</span> frequent renter points&lt;/em&gt;&lt;/p&gt;<span class="pl-pds">"</span></span>;
    <span class="pl-k">return</span> result;

  }

  <span class="pl-s">public</span> <span class="pl-st">double</span> getTotalCharge() {
    <span class="pl-st">double</span> total <span class="pl-k">=</span> <span class="pl-c1">0</span>;
    <span class="pl-k">for</span> (<span class="pl-stj">Rental</span> rental <span class="pl-k">:</span> rentals)
      total <span class="pl-k">+=</span> rental<span class="pl-k">.</span>getCharge();
    <span class="pl-k">return</span> total;
  }

  <span class="pl-s">public</span> <span class="pl-st">int</span> getTotalPoints() {
    <span class="pl-st">int</span> total <span class="pl-k">=</span> <span class="pl-c1">0</span>;
    <span class="pl-k">for</span> (<span class="pl-stj">Rental</span> rental <span class="pl-k">:</span> rentals)
      total <span class="pl-k">+=</span> rental<span class="pl-k">.</span>getPoints();
    <span class="pl-k">return</span> total;
  }
}</pre></div>

<div class="highlight highlight-java"><pre><span class="pl-s">public</span> <span class="pl-s">class</span> <span class="pl-en">MovieTest</span> {
  <span class="pl-st">@Test</span>
  <span class="pl-s">public</span> <span class="pl-st">void</span> <span class="pl-en">getChargeForChildrens</span>() {
    assertEquals(
      <span class="pl-c1">1.5</span>,
      a<span class="pl-k">.</span>movie<span class="pl-k">.</span>w(
        <span class="pl-c1">CHILDREN</span>)<span class="pl-k">.</span>build()<span class="pl-k">.</span>getCharge(<span class="pl-c1">1</span>),
      <span class="pl-c1">0</span>);
    assertEquals(
      <span class="pl-c1">1.5</span>,
      a<span class="pl-k">.</span>movie<span class="pl-k">.</span>w(
        <span class="pl-c1">CHILDREN</span>)<span class="pl-k">.</span>build()<span class="pl-k">.</span>getCharge(<span class="pl-c1">2</span>),
      <span class="pl-c1">0</span>);
    assertEquals(
      <span class="pl-c1">1.5</span>,
      a<span class="pl-k">.</span>movie<span class="pl-k">.</span>w(
        <span class="pl-c1">CHILDREN</span>)<span class="pl-k">.</span>build()<span class="pl-k">.</span>getCharge(<span class="pl-c1">3</span>),
      <span class="pl-c1">0</span>);
    assertEquals(
      <span class="pl-c1">3.0</span>,
      a<span class="pl-k">.</span>movie<span class="pl-k">.</span>w(
        <span class="pl-c1">CHILDREN</span>)<span class="pl-k">.</span>build()<span class="pl-k">.</span>getCharge(<span class="pl-c1">4</span>),
      <span class="pl-c1">0</span>);
    assertEquals(
      <span class="pl-c1">4.5</span>,
      a<span class="pl-k">.</span>movie<span class="pl-k">.</span>w(
        <span class="pl-c1">CHILDREN</span>)<span class="pl-k">.</span>build()<span class="pl-k">.</span>getCharge(<span class="pl-c1">5</span>),
      <span class="pl-c1">0</span>);
  }</pre></div>

<div class="highlight highlight-java"><pre>  @<span class="pl-stj">Test</span>
  <span class="pl-s">public</span> <span class="pl-st">void</span> getChargeForNewRelease() {
    assertEquals(
      <span class="pl-c1">3.0</span>,
      a<span class="pl-k">.</span>movie<span class="pl-k">.</span>w(
        <span class="pl-c1">NEW_RELEASE</span>)<span class="pl-k">.</span>build()<span class="pl-k">.</span>getCharge(<span class="pl-c1">1</span>),
      <span class="pl-c1">0</span>);
    assertEquals(
      <span class="pl-c1">6.0</span>,
      a<span class="pl-k">.</span>movie<span class="pl-k">.</span>w(
        <span class="pl-c1">NEW_RELEASE</span>)<span class="pl-k">.</span>build()<span class="pl-k">.</span>getCharge(<span class="pl-c1">2</span>),
      <span class="pl-c1">0</span>);
    assertEquals(
      <span class="pl-c1">9.0</span>,
      a<span class="pl-k">.</span>movie<span class="pl-k">.</span>w(
        <span class="pl-c1">NEW_RELEASE</span>)<span class="pl-k">.</span>build()<span class="pl-k">.</span>getCharge(<span class="pl-c1">3</span>),
      <span class="pl-c1">0</span>);
  }</pre></div>

<div class="highlight highlight-java"><pre>  @<span class="pl-stj">Test</span>
  <span class="pl-s">public</span> <span class="pl-st">void</span> getChargeForRegular() {
    assertEquals(
      <span class="pl-c1">2.0</span>,
      a<span class="pl-k">.</span>movie<span class="pl-k">.</span>w(
        <span class="pl-c1">REGULAR</span>)<span class="pl-k">.</span>build()<span class="pl-k">.</span>getCharge(<span class="pl-c1">1</span>),
      <span class="pl-c1">0</span>);
    assertEquals(
      <span class="pl-c1">2.0</span>,
      a<span class="pl-k">.</span>movie<span class="pl-k">.</span>w(
        <span class="pl-c1">REGULAR</span>)<span class="pl-k">.</span>build()<span class="pl-k">.</span>getCharge(<span class="pl-c1">2</span>),
      <span class="pl-c1">0</span>);
    assertEquals(
      <span class="pl-c1">3.5</span>,
      a<span class="pl-k">.</span>movie<span class="pl-k">.</span>w(
        <span class="pl-c1">REGULAR</span>)<span class="pl-k">.</span>build()<span class="pl-k">.</span>getCharge(<span class="pl-c1">3</span>),
      <span class="pl-c1">0</span>);
    assertEquals(
      <span class="pl-c1">5.0</span>,
      a<span class="pl-k">.</span>movie<span class="pl-k">.</span>w(
        <span class="pl-c1">REGULAR</span>)<span class="pl-k">.</span>build()<span class="pl-k">.</span>getCharge(<span class="pl-c1">4</span>),
      <span class="pl-c1">0</span>);
  }</pre></div>

<div class="highlight highlight-java"><pre>  @<span class="pl-stj">Test</span>
  <span class="pl-s">public</span> <span class="pl-st">void</span> getPointsForChildrens() {
    assertEquals(
      <span class="pl-c1">1</span>,
      a<span class="pl-k">.</span>movie<span class="pl-k">.</span>w(
        <span class="pl-c1">CHILDREN</span>)<span class="pl-k">.</span>build()<span class="pl-k">.</span>getPoints(<span class="pl-c1">1</span>));
    assertEquals(
      <span class="pl-c1">1</span>,
      a<span class="pl-k">.</span>movie<span class="pl-k">.</span>w(
        <span class="pl-c1">CHILDREN</span>)<span class="pl-k">.</span>build()<span class="pl-k">.</span>getPoints(<span class="pl-c1">2</span>));
  }

  @<span class="pl-stj">Test</span>
  <span class="pl-s">public</span> <span class="pl-st">void</span> getPointsForNewRelease() {
    assertEquals(
      <span class="pl-c1">1</span>,
      a<span class="pl-k">.</span>movie<span class="pl-k">.</span>w(
        <span class="pl-c1">NEW_RELEASE</span>)<span class="pl-k">.</span>build()<span class="pl-k">.</span>getPoints(<span class="pl-c1">1</span>));
    assertEquals(
      <span class="pl-c1">2</span>,
      a<span class="pl-k">.</span>movie<span class="pl-k">.</span>w(
        <span class="pl-c1">NEW_RELEASE</span>)<span class="pl-k">.</span>build()<span class="pl-k">.</span>getPoints(<span class="pl-c1">2</span>));
    assertEquals(
      <span class="pl-c1">2</span>,
      a<span class="pl-k">.</span>movie<span class="pl-k">.</span>w(
        <span class="pl-c1">NEW_RELEASE</span>)<span class="pl-k">.</span>build()<span class="pl-k">.</span>getPoints(<span class="pl-c1">3</span>));
  }</pre></div>

<div class="highlight highlight-java"><pre>  @<span class="pl-stj">Test</span>
  <span class="pl-s">public</span> <span class="pl-st">void</span> getPointsForRegular() {
    assertEquals(
      <span class="pl-c1">1</span>,
      a<span class="pl-k">.</span>movie<span class="pl-k">.</span>w(
        <span class="pl-c1">REGULAR</span>)<span class="pl-k">.</span>build()<span class="pl-k">.</span>getPoints(<span class="pl-c1">1</span>));
    assertEquals(
      <span class="pl-c1">1</span>,
      a<span class="pl-k">.</span>movie<span class="pl-k">.</span>w(
        <span class="pl-c1">REGULAR</span>)<span class="pl-k">.</span>build()<span class="pl-k">.</span>getPoints(<span class="pl-c1">2</span>));
  }

  @<span class="pl-stj">Test</span>
  (expected<span class="pl-k">=</span><span class="pl-stj">IllegalArgumentException</span><span class="pl-k">.</span>class)
  <span class="pl-s">public</span> <span class="pl-st">void</span> invalidTitle() {
    a<span class="pl-k">.</span>movie<span class="pl-k">.</span>w(<span class="pl-c1">UNKNOWN</span>)<span class="pl-k">.</span>build();
  }
}</pre></div>

<div class="highlight highlight-java"><pre><span class="pl-s">public</span> <span class="pl-s">class</span> <span class="pl-en">Movie</span> {

  <span class="pl-s">public</span> <span class="pl-s">enum</span> <span class="pl-en">Type</span> {
    <span class="pl-c1">REGULAR</span>, <span class="pl-c1">NEW_RELEASE</span>, <span class="pl-c1">CHILDREN</span>, <span class="pl-c1">UNKNOWN</span>;
  }

  <span class="pl-s">private</span> <span class="pl-stj">String</span> title;
  <span class="pl-stj">Price</span> price;

  <span class="pl-s">public</span> <span class="pl-en">Movie</span>(
    <span class="pl-stj">String</span> <span class="pl-v">title</span>, <span class="pl-stj">Movie</span>.<span class="pl-stj">Type</span> <span class="pl-v">priceCode</span>) {
    <span class="pl-v">this</span><span class="pl-k">.</span>title <span class="pl-k">=</span> title;
    setPriceCode(priceCode);
  }

  <span class="pl-s">public</span> <span class="pl-stj">String</span> <span class="pl-en">getTitle</span>() {
    <span class="pl-k">return</span> title;
  }</pre></div>

<div class="highlight highlight-java"><pre>  <span class="pl-s">private</span> <span class="pl-st">void</span> setPriceCode(
    <span class="pl-stj">Movie</span><span class="pl-k">.</span><span class="pl-stj">Type</span> priceCode) {
    <span class="pl-k">switch</span> (priceCode) {
    <span class="pl-k">case</span> <span class="pl-c1">CHILDREN</span><span class="pl-k">:</span>
      price <span class="pl-k">=</span> <span class="pl-k">new</span> <span class="pl-stj">ChildrensPrice</span>();
      <span class="pl-k">break</span>;
    <span class="pl-k">case</span> <span class="pl-c1">NEW_RELEASE</span><span class="pl-k">:</span>
      price <span class="pl-k">=</span> <span class="pl-k">new</span> <span class="pl-stj">NewReleasePrice</span>();
      <span class="pl-k">break</span>;
    <span class="pl-k">case</span> <span class="pl-c1">REGULAR</span><span class="pl-k">:</span>
      price <span class="pl-k">=</span> <span class="pl-k">new</span> <span class="pl-stj">RegularPrice</span>();
      <span class="pl-k">break</span>;
    <span class="pl-k">default</span><span class="pl-k">:</span>
      <span class="pl-k">throw</span> <span class="pl-k">new</span> <span class="pl-stj">IllegalArgumentException</span>(
        <span class="pl-s1"><span class="pl-pds">"</span>invalid price code<span class="pl-pds">"</span></span>);
    }
  }

  <span class="pl-s">public</span> <span class="pl-st">double</span> getCharge(<span class="pl-st">int</span> daysRented) {
    <span class="pl-k">return</span> price<span class="pl-k">.</span>getCharge(daysRented);
  }

  <span class="pl-s">public</span> <span class="pl-st">int</span> getPoints(<span class="pl-st">int</span> daysRented) {
    <span class="pl-k">return</span> price<span class="pl-k">.</span>getPoints(daysRented);
  }
}</pre></div>

<div class="highlight highlight-java"><pre><span class="pl-s">public</span> <span class="pl-s">class</span> <span class="pl-en">RentalTest</span> {
  <span class="pl-st">@Test</span>
  <span class="pl-s">public</span> <span class="pl-st">void</span>
  <span class="pl-en">isStartedIfInStoreStateBased</span>() {
    <span class="pl-stj">Movie</span> movie <span class="pl-k">=</span> a<span class="pl-k">.</span>movie<span class="pl-k">.</span>build();
    <span class="pl-stj">Rental</span> rental <span class="pl-k">=</span>
      a<span class="pl-k">.</span>rental<span class="pl-k">.</span>w(movie)<span class="pl-k">.</span>build();
    <span class="pl-stj">Store</span> store <span class="pl-k">=</span> a<span class="pl-k">.</span>store<span class="pl-k">.</span>w(movie)<span class="pl-k">.</span>build();
    rental<span class="pl-k">.</span>start(store);
    assertTrue(rental<span class="pl-k">.</span>isStarted());
    assertEquals(
      <span class="pl-c1">0</span>, store<span class="pl-k">.</span>getAvailability(movie));
  }

  <span class="pl-st">@Test</span>
  <span class="pl-s">public</span> <span class="pl-st">void</span>
  <span class="pl-en">doesNotStartIfNotAvailableStateBased</span>() {
    <span class="pl-stj">Movie</span> movie <span class="pl-k">=</span> a<span class="pl-k">.</span>movie<span class="pl-k">.</span>build();
    <span class="pl-stj">Rental</span> rental <span class="pl-k">=</span> a<span class="pl-k">.</span>rental<span class="pl-k">.</span>build();
    <span class="pl-stj">Store</span> store <span class="pl-k">=</span> a<span class="pl-k">.</span>store<span class="pl-k">.</span>build();
    rental<span class="pl-k">.</span>start(store);
    assertFalse(rental<span class="pl-k">.</span>isStarted());
    assertEquals(
      <span class="pl-c1">0</span>, store<span class="pl-k">.</span>getAvailability(movie));
  }</pre></div>

<div class="highlight highlight-java"><pre>  @<span class="pl-stj">Test</span>
  <span class="pl-s">public</span> <span class="pl-st">void</span>
  isStartedIfInStoreInteractionBased() {
    <span class="pl-stj">Movie</span> movie <span class="pl-k">=</span> a<span class="pl-k">.</span>movie<span class="pl-k">.</span>build();
    <span class="pl-stj">Rental</span> rental <span class="pl-k">=</span>
      a<span class="pl-k">.</span>rental<span class="pl-k">.</span>w(movie)<span class="pl-k">.</span>build();
    <span class="pl-stj">Store</span> store <span class="pl-k">=</span> mock(<span class="pl-stj">Store</span><span class="pl-k">.</span>class);
    when(store<span class="pl-k">.</span>getAvailability(movie))
      .thenReturn(<span class="pl-c1">1</span>);
    rental<span class="pl-k">.</span>start(store);
    assertTrue(rental<span class="pl-k">.</span>isStarted());
    verify(store)<span class="pl-k">.</span>remove(movie);
  }

  @<span class="pl-stj">Test</span>
  <span class="pl-s">public</span> <span class="pl-st">void</span>
  notStartedIfUnavailableInteractionBased() {
    <span class="pl-stj">Rental</span> rental <span class="pl-k">=</span> a<span class="pl-k">.</span>rental<span class="pl-k">.</span>build();
    <span class="pl-stj">Store</span> store <span class="pl-k">=</span> mock(<span class="pl-stj">Store</span><span class="pl-k">.</span>class);
    rental<span class="pl-k">.</span>start(store);
    assertFalse(rental<span class="pl-k">.</span>isStarted());
    verify(
      store, never())<span class="pl-k">.</span>remove(
        any(<span class="pl-stj">Movie</span><span class="pl-k">.</span>class));
  }
}</pre></div>

<div class="highlight highlight-java"><pre><span class="pl-s">public</span> <span class="pl-s">class</span> <span class="pl-en">Rental</span> {

  <span class="pl-stj">Movie</span> movie;
  <span class="pl-s">private</span> <span class="pl-st">int</span> daysRented;
  <span class="pl-s">private</span> <span class="pl-st">boolean</span> started;

  <span class="pl-s">public</span> <span class="pl-en">Rental</span>(
    <span class="pl-stj">Movie</span> <span class="pl-v">movie</span>, <span class="pl-st">int</span> <span class="pl-v">daysRented</span>) {
    <span class="pl-v">this</span><span class="pl-k">.</span>movie <span class="pl-k">=</span> movie;
    <span class="pl-v">this</span><span class="pl-k">.</span>daysRented <span class="pl-k">=</span> daysRented;
  }

  <span class="pl-s">public</span> <span class="pl-stj">Movie</span> <span class="pl-en">getMovie</span>() {
    <span class="pl-k">return</span> movie;
  }

  <span class="pl-s">public</span> <span class="pl-st">int</span> <span class="pl-en">getDaysRented</span>() {
    <span class="pl-k">return</span> daysRented;
  }

  <span class="pl-s">public</span> <span class="pl-st">double</span> <span class="pl-en">getCharge</span>() {
    <span class="pl-k">return</span> movie<span class="pl-k">.</span>getCharge(daysRented);
  }

  <span class="pl-s">public</span> <span class="pl-st">int</span> <span class="pl-en">getPoints</span>() {
    <span class="pl-k">return</span> movie<span class="pl-k">.</span>getPoints(daysRented);
  }

  <span class="pl-s">public</span> <span class="pl-stj">String</span> <span class="pl-en">getLineItem</span>() {
    <span class="pl-k">return</span>
      movie<span class="pl-k">.</span>getTitle() <span class="pl-k">+</span> <span class="pl-s1"><span class="pl-pds">"</span> <span class="pl-pds">"</span></span> <span class="pl-k">+</span> getCharge();
  }</pre></div>

<div class="highlight highlight-java"><pre>  <span class="pl-s">public</span> <span class="pl-st">boolean</span> isStarted() {
    <span class="pl-k">return</span> started;
  }

  <span class="pl-s">public</span> <span class="pl-st">void</span> start(<span class="pl-stj">Store</span> store) {
    <span class="pl-k">if</span> (store<span class="pl-k">.</span>getAvailability(movie) <span class="pl-k">&gt;</span> <span class="pl-c1">0</span>) {
      store<span class="pl-k">.</span>remove(movie);
      <span class="pl-v">this</span><span class="pl-k">.</span>started <span class="pl-k">=</span> <span class="pl-c1">true</span>;
    }
  }
}</pre></div>

<div class="highlight highlight-java"><pre><span class="pl-s">public</span> <span class="pl-s">class</span> <span class="pl-en">Store</span> {
  <span class="pl-s">private</span> <span class="pl-st">Map&lt;<span class="pl-stj">Movie</span>, <span class="pl-stj">Integer</span>&gt;</span> movies;

  <span class="pl-s">public</span> <span class="pl-en">Store</span>(<span class="pl-st">Map&lt;<span class="pl-stj">Movie</span>, <span class="pl-stj">Integer</span>&gt;</span> <span class="pl-v">movies</span>) {
    <span class="pl-v">this</span><span class="pl-k">.</span>movies <span class="pl-k">=</span> movies;
  }

  <span class="pl-s">public</span> <span class="pl-st">int</span> <span class="pl-en">getAvailability</span>(<span class="pl-stj">Movie</span> <span class="pl-v">movie</span>) {
    <span class="pl-k">if</span> (<span class="pl-c1">null</span> <span class="pl-k">==</span> movies<span class="pl-k">.</span>get(movie))
      <span class="pl-k">return</span> <span class="pl-c1">0</span>;
    <span class="pl-k">return</span> movies<span class="pl-k">.</span>get(movie);
  }

  <span class="pl-s">public</span> <span class="pl-st">boolean</span> <span class="pl-en">getAvailability</span>(
    <span class="pl-stj">Movie</span> <span class="pl-v">movie</span>, <span class="pl-st">int</span> <span class="pl-v">quantity</span>) {
    <span class="pl-k">if</span> (<span class="pl-c1">null</span> <span class="pl-k">==</span> movies<span class="pl-k">.</span>get(movie))
      <span class="pl-k">return</span> <span class="pl-c1">false</span>;
    <span class="pl-k">return</span> movies<span class="pl-k">.</span>get(movie) <span class="pl-k">&gt;=</span> quantity;
  }

  <span class="pl-s">public</span> <span class="pl-st">void</span> <span class="pl-en">remove</span>(<span class="pl-stj">Movie</span> <span class="pl-v">movie</span>) {
    <span class="pl-k">if</span> (<span class="pl-c1">null</span> <span class="pl-k">==</span> movies<span class="pl-k">.</span>get(movie))
      <span class="pl-k">return</span>;
    <span class="pl-stj">Integer</span> count <span class="pl-k">=</span> movies<span class="pl-k">.</span>get(movie);
    movies<span class="pl-k">.</span>put(movie, <span class="pl-k">--</span>count);
  }
}</pre></div>

<h1>
<a id="improving-assertions" class="anchor" href="#improving-assertions" aria-hidden="true"><span class="octicon octicon-link"></span></a>Improving Assertions</h1>

<h2>
<a id="one-assertion-per-test" class="anchor" href="#one-assertion-per-test" aria-hidden="true"><span class="octicon octicon-link"></span></a>One Assertion Per Test</h2>

<div class="highlight highlight-java"><pre><span class="pl-s">public</span> <span class="pl-s">class</span> <span class="pl-en">MovieTest</span> {
  <span class="pl-st">@Test</span>
  <span class="pl-s">public</span> <span class="pl-st">void</span> <span class="pl-en">getChargeForChildrens</span>() {
    assertEquals(
      <span class="pl-c1">1.5</span>,
      a<span class="pl-k">.</span>movie<span class="pl-k">.</span>w(
        <span class="pl-c1">CHILDREN</span>)<span class="pl-k">.</span>build()<span class="pl-k">.</span>getCharge(<span class="pl-c1">1</span>),
      <span class="pl-c1">0</span>);
    assertEquals(
      <span class="pl-c1">1.5</span>,
      a<span class="pl-k">.</span>movie<span class="pl-k">.</span>w(
        <span class="pl-c1">CHILDREN</span>)<span class="pl-k">.</span>build()<span class="pl-k">.</span>getCharge(<span class="pl-c1">2</span>),
      <span class="pl-c1">0</span>);
    assertEquals(
      <span class="pl-c1">1.5</span>,
      a<span class="pl-k">.</span>movie<span class="pl-k">.</span>w(
        <span class="pl-c1">CHILDREN</span>)<span class="pl-k">.</span>build()<span class="pl-k">.</span>getCharge(<span class="pl-c1">3</span>),
      <span class="pl-c1">0</span>);
    assertEquals(
      <span class="pl-c1">3.0</span>,
      a<span class="pl-k">.</span>movie<span class="pl-k">.</span>w(
        <span class="pl-c1">CHILDREN</span>)<span class="pl-k">.</span>build()<span class="pl-k">.</span>getCharge(<span class="pl-c1">4</span>),
      <span class="pl-c1">0</span>);
    assertEquals(
      <span class="pl-c1">4.5</span>,
      a<span class="pl-k">.</span>movie<span class="pl-k">.</span>w(
        <span class="pl-c1">CHILDREN</span>)<span class="pl-k">.</span>build()<span class="pl-k">.</span>getCharge(<span class="pl-c1">5</span>),
      <span class="pl-c1">0</span>);
  }
}</pre></div>

<h3>
<a id="failure" class="anchor" href="#failure" aria-hidden="true"><span class="octicon octicon-link"></span></a>Failure</h3>

<div class="highlight highlight-java"><pre><span class="pl-s">public</span> <span class="pl-s">class</span> <span class="pl-en">ChildrensPrice</span> <span class="pl-s">extends</span> <span class="pl-e">Price</span> {

  <span class="pl-st">@Override</span>
  <span class="pl-s">public</span> <span class="pl-st">double</span> <span class="pl-en">getCharge</span>(<span class="pl-st">int</span> <span class="pl-v">daysRented</span>) {
    <span class="pl-st">double</span> amount <span class="pl-k">=</span> <span class="pl-c1">1.5</span>;

    <span class="pl-k">if</span> (daysRented <span class="pl-k">&gt;</span> <span class="pl-c1">2</span>) <span class="pl-c">// *was 3*</span>
      amount <span class="pl-k">+=</span> (daysRented <span class="pl-k">-</span> <span class="pl-c1">2</span>) <span class="pl-k">*</span> <span class="pl-c1">1.5</span>;

    <span class="pl-k">return</span> amount;
  }
}</pre></div>

<h3>
<a id="test-naming" class="anchor" href="#test-naming" aria-hidden="true"><span class="octicon octicon-link"></span></a>Test Naming</h3>

<h3>
<a id="the-solution" class="anchor" href="#the-solution" aria-hidden="true"><span class="octicon octicon-link"></span></a>The Solution</h3>

<div class="highlight highlight-java"><pre><span class="pl-s">public</span> <span class="pl-s">class</span> <span class="pl-en">MovieTest</span> {
  <span class="pl-st">@Test</span>
  <span class="pl-s">public</span> <span class="pl-st">void</span> <span class="pl-en">getChargeForChildrens1Day</span>() {
    assertEquals(
      <span class="pl-c1">1.5</span>,
      a<span class="pl-k">.</span>movie<span class="pl-k">.</span>w(
        <span class="pl-c1">CHILDREN</span>)<span class="pl-k">.</span>build()<span class="pl-k">.</span>getCharge(<span class="pl-c1">1</span>),
      <span class="pl-c1">0</span>);
  }

  <span class="pl-st">@Test</span>
  <span class="pl-s">public</span> <span class="pl-st">void</span> <span class="pl-en">getChargeForChildrens2Day</span>() {
    assertEquals(
      <span class="pl-c1">1.5</span>,
      a<span class="pl-k">.</span>movie<span class="pl-k">.</span>w(
        <span class="pl-c1">CHILDREN</span>)<span class="pl-k">.</span>build()<span class="pl-k">.</span>getCharge(<span class="pl-c1">2</span>),
      <span class="pl-c1">0</span>);
  }

  <span class="pl-st">@Test</span>
  <span class="pl-s">public</span> <span class="pl-st">void</span> <span class="pl-en">getChargeForChildrens3Day</span>() {
    assertEquals(
      <span class="pl-c1">1.5</span>,
      a<span class="pl-k">.</span>movie<span class="pl-k">.</span>w(
        <span class="pl-c1">CHILDREN</span>)<span class="pl-k">.</span>build()<span class="pl-k">.</span>getCharge(<span class="pl-c1">3</span>),
      <span class="pl-c1">0</span>);
  }</pre></div>

<div class="highlight highlight-java"><pre>  @<span class="pl-stj">Test</span>
  <span class="pl-s">public</span> <span class="pl-st">void</span> getChargeForChildrens4Day() {
    assertEquals(
      <span class="pl-c1">3.0</span>,
      a<span class="pl-k">.</span>movie<span class="pl-k">.</span>w(
        <span class="pl-c1">CHILDREN</span>)<span class="pl-k">.</span>build()<span class="pl-k">.</span>getCharge(<span class="pl-c1">4</span>),
      <span class="pl-c1">0</span>);
  }

  @<span class="pl-stj">Test</span>
  <span class="pl-s">public</span> <span class="pl-st">void</span> getChargeForChildrens5Day() {
    assertEquals(
      <span class="pl-c1">4.5</span>,
      a<span class="pl-k">.</span>movie<span class="pl-k">.</span>w(
        <span class="pl-c1">CHILDREN</span>)<span class="pl-k">.</span>build()<span class="pl-k">.</span>getCharge(<span class="pl-c1">5</span>),
      <span class="pl-c1">0</span>);
  }
}</pre></div>

<h3>
<a id="applying-one-assertion-per-test-to-behavior-verification-tests" class="anchor" href="#applying-one-assertion-per-test-to-behavior-verification-tests" aria-hidden="true"><span class="octicon octicon-link"></span></a>Applying One Assertion Per Test To Behavior Verification Tests</h3>

<div class="highlight highlight-java"><pre><span class="pl-s">public</span> <span class="pl-s">class</span> <span class="pl-en">RentalTest</span> {
  <span class="pl-st">@Test</span>
  <span class="pl-s">public</span> <span class="pl-st">void</span> <span class="pl-en">rentalIsStartedIfInStore</span>() {
    <span class="pl-stj">Movie</span> movie <span class="pl-k">=</span> mock(<span class="pl-stj">Movie</span><span class="pl-k">.</span>class);
    <span class="pl-stj">Rental</span> rental <span class="pl-k">=</span>
      a<span class="pl-k">.</span>rental<span class="pl-k">.</span>w(movie)<span class="pl-k">.</span>build();
    <span class="pl-stj">Store</span> store <span class="pl-k">=</span> mock(<span class="pl-stj">Store</span><span class="pl-k">.</span>class);
    when(store<span class="pl-k">.</span>getAvailability(movie))
      .thenReturn(<span class="pl-c1">1</span>);
    rental<span class="pl-k">.</span>start(store);
    assertTrue(rental<span class="pl-k">.</span>isStarted());
    verify(store)<span class="pl-k">.</span>remove(movie);
  }
}</pre></div>

<div class="highlight highlight-java"><pre><span class="pl-s">public</span> <span class="pl-s">class</span> <span class="pl-en">RentalTest</span> {
  <span class="pl-st">@Test</span>
  <span class="pl-s">public</span> <span class="pl-st">void</span> <span class="pl-en">rentalIsStartedIfInStore</span>() {
    <span class="pl-stj">Movie</span> movie <span class="pl-k">=</span> mock(<span class="pl-stj">Movie</span><span class="pl-k">.</span>class);
    <span class="pl-stj">Rental</span> rental <span class="pl-k">=</span>
      a<span class="pl-k">.</span>rental<span class="pl-k">.</span>w(movie)<span class="pl-k">.</span>build();
    <span class="pl-stj">Store</span> store <span class="pl-k">=</span> mock(<span class="pl-stj">Store</span><span class="pl-k">.</span>class);

    when(store<span class="pl-k">.</span>getAvailability(movie, <span class="pl-c1">1</span>))
      .thenReturn(<span class="pl-c1">true</span>);

    rental<span class="pl-k">.</span>start(store);
    assertTrue(rental<span class="pl-k">.</span>isStarted());
    verify(store)<span class="pl-k">.</span>remove(movie);
  }
}</pre></div>

<div class="highlight highlight-java"><pre><span class="pl-s">public</span> <span class="pl-s">class</span> <span class="pl-en">RentalTest</span> {
  <span class="pl-st">@Test</span>
  <span class="pl-s">public</span> <span class="pl-st">void</span> <span class="pl-en">rentalIsStartedIfInStore</span>() {
    <span class="pl-stj">Rental</span> rental <span class="pl-k">=</span> a<span class="pl-k">.</span>rental<span class="pl-k">.</span>build();
    <span class="pl-stj">Store</span> store <span class="pl-k">=</span> mock(<span class="pl-stj">Store</span><span class="pl-k">.</span>class);
    when(store
         .getAvailability(any(<span class="pl-stj">Movie</span><span class="pl-k">.</span>class)))
      .thenReturn(<span class="pl-c1">1</span>);
    rental<span class="pl-k">.</span>start(store);
    assertTrue(rental<span class="pl-k">.</span>isStarted());
  }
}</pre></div>

<div class="highlight highlight-java"><pre><span class="pl-s">public</span> <span class="pl-s">class</span> <span class="pl-en">StoreTest</span> {
  <span class="pl-st">@Test</span>
  <span class="pl-s">public</span> <span class="pl-st">void</span> <span class="pl-en">storeWithNoAvailability</span>() {
    <span class="pl-stj">Store</span> store <span class="pl-k">=</span> a<span class="pl-k">.</span>store<span class="pl-k">.</span>build();
    assertEquals(
      <span class="pl-c1">0</span>,
      store<span class="pl-k">.</span>getAvailability(
        mock(<span class="pl-stj">Movie</span><span class="pl-k">.</span>class)));
  }

  <span class="pl-st">@Test</span>
  <span class="pl-s">public</span> <span class="pl-st">void</span> <span class="pl-en">storeWithAvailability</span>() {
    <span class="pl-stj">Movie</span> movie <span class="pl-k">=</span> mock(<span class="pl-stj">Movie</span><span class="pl-k">.</span>class);
    <span class="pl-stj">Store</span> store <span class="pl-k">=</span>
      a<span class="pl-k">.</span>store<span class="pl-k">.</span>w(movie, movie)<span class="pl-k">.</span>build();
    assertEquals(
      <span class="pl-c1">2</span>, store<span class="pl-k">.</span>getAvailability(movie));
  }

  <span class="pl-st">@Test</span>
  <span class="pl-s">public</span> <span class="pl-st">void</span>
  <span class="pl-en">storeWithRemovedAvailability</span>() {
    <span class="pl-stj">Movie</span> movie <span class="pl-k">=</span> mock(<span class="pl-stj">Movie</span><span class="pl-k">.</span>class);
    <span class="pl-stj">Store</span> store <span class="pl-k">=</span>
      a<span class="pl-k">.</span>store<span class="pl-k">.</span>w(movie, movie)<span class="pl-k">.</span>build();
    store<span class="pl-k">.</span>remove(movie);
    assertEquals(
      <span class="pl-c1">1</span>, store<span class="pl-k">.</span>getAvailability(movie));
  }
}</pre></div>

<div class="highlight highlight-java"><pre><span class="pl-s">public</span> <span class="pl-s">class</span> <span class="pl-en">RentalTest</span> {
  <span class="pl-st">@Test</span>
  <span class="pl-s">public</span> <span class="pl-st">void</span>
  <span class="pl-en">storeAvailabilityIsModifiedOnRental</span>() {
    <span class="pl-stj">Movie</span> movie <span class="pl-k">=</span> a<span class="pl-k">.</span>movie<span class="pl-k">.</span>build();
    <span class="pl-stj">Rental</span> rental <span class="pl-k">=</span>
      a<span class="pl-k">.</span>rental<span class="pl-k">.</span>w(movie)<span class="pl-k">.</span>build();
    <span class="pl-stj">Store</span> store <span class="pl-k">=</span>
      a<span class="pl-k">.</span>store<span class="pl-k">.</span>w(movie, movie)<span class="pl-k">.</span>build();
    rental<span class="pl-k">.</span>start(store);
    a<span class="pl-k">.</span>rental<span class="pl-k">.</span>build()<span class="pl-k">.</span>start(store);
    assertEquals(
      <span class="pl-c1">1</span>, store<span class="pl-k">.</span>getAvailability(movie));
  }
}</pre></div>

<h3>
<a id="thoughts-on-the-result" class="anchor" href="#thoughts-on-the-result" aria-hidden="true"><span class="octicon octicon-link"></span></a>Thoughts On The Result</h3>

<h2>
<a id="implementation-overspecification" class="anchor" href="#implementation-overspecification" aria-hidden="true"><span class="octicon octicon-link"></span></a>Implementation Overspecification</h2>

<div class="highlight highlight-java"><pre><span class="pl-s">public</span> <span class="pl-s">class</span> <span class="pl-en">Customer</span> {

  <span class="pl-s">private</span> <span class="pl-stj">String</span> name;
  <span class="pl-s">private</span> <span class="pl-st">List&lt;<span class="pl-stj">Rental</span>&gt;</span> rentals <span class="pl-k">=</span>
    <span class="pl-k">new</span> <span class="pl-st">ArrayList&lt;<span class="pl-stj">Rental</span>&gt;</span>();

  <span class="pl-s">public</span> <span class="pl-en">Customer</span>(<span class="pl-stj">String</span> <span class="pl-v">name</span>) {
    <span class="pl-v">this</span><span class="pl-k">.</span>name <span class="pl-k">=</span> name;
  }

  <span class="pl-s">public</span> <span class="pl-st">void</span> <span class="pl-en">addRental</span>(<span class="pl-stj">Rental</span> <span class="pl-v">rental</span>) {
    rentals<span class="pl-k">.</span>add(rental);
  }


  <span class="pl-s">public</span> <span class="pl-stj">String</span> <span class="pl-en">recentRentals</span>() {
    <span class="pl-stj">String</span> result <span class="pl-k">=</span> <span class="pl-s1"><span class="pl-pds">"</span>Recent rentals:<span class="pl-pds">"</span></span>;
    <span class="pl-k">for</span> (<span class="pl-st">int</span> i<span class="pl-k">=</span><span class="pl-c1">0</span>;
         i <span class="pl-k">&lt;</span> rentals<span class="pl-k">.</span>size() <span class="pl-k">&amp;&amp;</span> i <span class="pl-k">&lt;</span> <span class="pl-c1">3</span>;
         i<span class="pl-k">++</span>) {
      result <span class="pl-k">+=</span> <span class="pl-s1"><span class="pl-pds">"</span><span class="pl-cce">\n</span><span class="pl-pds">"</span></span> <span class="pl-k">+</span>
        rentals<span class="pl-k">.</span>get(i)<span class="pl-k">.</span>getMovie(
          <span class="pl-c1">true</span>)<span class="pl-k">.</span>getTitle(
            <span class="pl-s1"><span class="pl-pds">"</span>%s starring %s %s<span class="pl-pds">"</span></span>, <span class="pl-c1">2</span>);
    }
    <span class="pl-k">return</span> result;
  }

}</pre></div>

<div class="highlight highlight-java"><pre><span class="pl-s">public</span> <span class="pl-s">class</span> <span class="pl-en">CustomerTest</span> {
  <span class="pl-st">@Test</span>
  <span class="pl-s">public</span> <span class="pl-st">void</span> <span class="pl-en">recentRentalsWith2Rentals</span>() {
    <span class="pl-stj">Movie</span> godfather <span class="pl-k">=</span> mock(<span class="pl-stj">Movie</span><span class="pl-k">.</span>class);
    when(godfather
         .getTitle(<span class="pl-s1"><span class="pl-pds">"</span>%s starring %s %s<span class="pl-pds">"</span></span>, <span class="pl-c1">2</span>))
      .thenReturn(<span class="pl-s1"><span class="pl-pds">"</span>Godfather 4<span class="pl-pds">"</span></span>);
    <span class="pl-stj">Rental</span> godfatherRental <span class="pl-k">=</span>
      mock(<span class="pl-stj">Rental</span><span class="pl-k">.</span>class);
    when(godfatherRental<span class="pl-k">.</span>getMovie(<span class="pl-c1">true</span>))
      .thenReturn(godfather);
    <span class="pl-stj">Movie</span> lionKing <span class="pl-k">=</span> mock(<span class="pl-stj">Movie</span><span class="pl-k">.</span>class);
    when(lionKing
         .getTitle(<span class="pl-s1"><span class="pl-pds">"</span>%s starring %s %s<span class="pl-pds">"</span></span>, <span class="pl-c1">2</span>))
      .thenReturn(<span class="pl-s1"><span class="pl-pds">"</span>Lion King<span class="pl-pds">"</span></span>);
    <span class="pl-stj">Rental</span> lionKingRental <span class="pl-k">=</span>
      mock(<span class="pl-stj">Rental</span><span class="pl-k">.</span>class);
    when(lionKingRental<span class="pl-k">.</span>getMovie(<span class="pl-c1">true</span>))
      .thenReturn(lionKing);

    assertEquals(
      <span class="pl-s1"><span class="pl-pds">"</span>Recent rentals:<span class="pl-cce">\n</span>Godfather 4<span class="pl-cce">\n</span><span class="pl-pds">"</span></span> <span class="pl-k">+</span>
      <span class="pl-s1"><span class="pl-pds">"</span>Lion King<span class="pl-pds">"</span></span>,
      a<span class="pl-k">.</span>customer<span class="pl-k">.</span>w(
        godfatherRental, lionKingRental)
      .build()<span class="pl-k">.</span>recentRentals());
  }</pre></div>

<div class="highlight highlight-java"><pre>  @<span class="pl-stj">Test</span>
  <span class="pl-s">public</span> <span class="pl-st">void</span> recentRentalsWith3Rentals() {
    <span class="pl-c">// same structure as above, with</span>
    <span class="pl-c">// 8 more lines of mocking code,</span>
    <span class="pl-c">// 25% longer expected value, and</span>
    <span class="pl-c">// 2 lines of adding rentals to customer</span>
  }

  @<span class="pl-stj">Test</span>
  <span class="pl-s">public</span> <span class="pl-st">void</span> recentRentalsWith4Rentals() {
    <span class="pl-c">// same structure as above, with</span>
    <span class="pl-c">// 16 more lines of mocking code,</span>
    <span class="pl-c">// 25% longer expected value, and</span>
    <span class="pl-c">// 2 lines of adding rentals to customer</span>
  }
}</pre></div>

<h3>
<a id="flexible-argument-matchers" class="anchor" href="#flexible-argument-matchers" aria-hidden="true"><span class="octicon octicon-link"></span></a>Flexible Argument Matchers</h3>

<div class="highlight highlight-java"><pre><span class="pl-s">public</span> <span class="pl-s">class</span> <span class="pl-en">CustomerTest</span> {
  <span class="pl-st">@Test</span>
  <span class="pl-s">public</span> <span class="pl-st">void</span> <span class="pl-en">recentRentalsWith2Rentals</span>() {
    <span class="pl-stj">Movie</span> godfather <span class="pl-k">=</span> mock(<span class="pl-stj">Movie</span><span class="pl-k">.</span>class);
    when(
      godfather<span class="pl-k">.</span>getTitle(

        anyString(), anyInt()))

      .thenReturn(<span class="pl-s1"><span class="pl-pds">"</span>Godfather 4<span class="pl-pds">"</span></span>);
    <span class="pl-stj">Rental</span> godfatherRental <span class="pl-k">=</span>
      mock(<span class="pl-stj">Rental</span><span class="pl-k">.</span>class);
    when(

      godfatherRental<span class="pl-k">.</span>getMovie(anyBoolean()))

      .thenReturn(godfather);
    <span class="pl-stj">Movie</span> lionKing <span class="pl-k">=</span> mock(<span class="pl-stj">Movie</span><span class="pl-k">.</span>class);
    when(
      lionKing<span class="pl-k">.</span>getTitle(

        anyString(), anyInt()))

      .thenReturn(<span class="pl-s1"><span class="pl-pds">"</span>Lion King<span class="pl-pds">"</span></span>);
    <span class="pl-stj">Rental</span> lionKingRental <span class="pl-k">=</span>
      mock(<span class="pl-stj">Rental</span><span class="pl-k">.</span>class);
    when(

      lionKingRental<span class="pl-k">.</span>getMovie(anyBoolean()))

      .thenReturn(lionKing);

    assertEquals(
      <span class="pl-s1"><span class="pl-pds">"</span>Recent rentals:<span class="pl-cce">\n</span>Godfather 4<span class="pl-cce">\n</span><span class="pl-pds">"</span></span> <span class="pl-k">+</span>
      <span class="pl-s1"><span class="pl-pds">"</span>Lion King<span class="pl-pds">"</span></span>,
      a<span class="pl-k">.</span>customer<span class="pl-k">.</span>w(
        godfatherRental, lionKingRental)
      .build()<span class="pl-k">.</span>recentRentals());
  }
}</pre></div>

<h3>
<a id="default-return-values" class="anchor" href="#default-return-values" aria-hidden="true"><span class="octicon octicon-link"></span></a>Default Return Values</h3>

<div class="highlight highlight-java"><pre><span class="pl-s">public</span> <span class="pl-s">class</span> <span class="pl-en">CustomerTest</span> {
  <span class="pl-st">@Test</span>
  <span class="pl-s">public</span> <span class="pl-st">void</span> <span class="pl-en">recentRentalsWith2Rentals</span>() {
    <span class="pl-stj">Movie</span> godfather <span class="pl-k">=</span> mock(<span class="pl-stj">Movie</span><span class="pl-k">.</span>class);

    <span class="pl-stj">Rental</span> godfatherRental <span class="pl-k">=</span>
      mock(<span class="pl-stj">Rental</span><span class="pl-k">.</span>class);

    when(
      godfatherRental<span class="pl-k">.</span>getMovie(anyBoolean()))
      .thenReturn(godfather);
    <span class="pl-stj">Movie</span> lionKing <span class="pl-k">=</span> mock(<span class="pl-stj">Movie</span><span class="pl-k">.</span>class);

    <span class="pl-stj">Rental</span> lionKingRental <span class="pl-k">=</span>
      mock(<span class="pl-stj">Rental</span><span class="pl-k">.</span>class);

    when(
      lionKingRental<span class="pl-k">.</span>getMovie(anyBoolean()))
      .thenReturn(lionKing);

    assertEquals(
      <span class="pl-s1"><span class="pl-pds">"</span>Recent rentals:<span class="pl-cce">\n</span>null<span class="pl-cce">\n</span>null<span class="pl-pds">"</span></span>,
      a<span class="pl-k">.</span>customer<span class="pl-k">.</span>w(
        godfatherRental, lionKingRental)
      .build()<span class="pl-k">.</span>recentRentals());
  }
}</pre></div>

<div class="highlight highlight-java"><pre><span class="pl-s">public</span> <span class="pl-s">class</span> <span class="pl-en">CustomerTest</span> {
  <span class="pl-st">@Test</span>
  <span class="pl-s">public</span> <span class="pl-st">void</span> <span class="pl-en">recentRentalsWith2Rentals</span>() {
    <span class="pl-stj">Movie</span> movie <span class="pl-k">=</span> mock(<span class="pl-stj">Movie</span><span class="pl-k">.</span>class);
    <span class="pl-stj">Rental</span> rental <span class="pl-k">=</span> mock(<span class="pl-stj">Rental</span><span class="pl-k">.</span>class);
    when(rental<span class="pl-k">.</span>getMovie(anyBoolean()))
      .thenReturn(movie);
    assertEquals(
      <span class="pl-s1"><span class="pl-pds">"</span>Recent rentals:<span class="pl-cce">\n</span>null<span class="pl-cce">\n</span>null<span class="pl-pds">"</span></span>,
      a<span class="pl-k">.</span>customer<span class="pl-k">.</span>w(rental, rental)<span class="pl-k">.</span>build()
      .recentRentals());
  }
}</pre></div>

<h3>
<a id="law-of-demeter" class="anchor" href="#law-of-demeter" aria-hidden="true"><span class="octicon octicon-link"></span></a>Law of Demeter</h3>

<div class="highlight highlight-java"><pre><span class="pl-s">public</span> <span class="pl-s">class</span> <span class="pl-en">CustomerTest</span> {
  <span class="pl-st">@Test</span>
  <span class="pl-s">public</span> <span class="pl-st">void</span> <span class="pl-en">recentRentalsWith2Rentals</span>() {
    <span class="pl-stj">Rental</span> rental <span class="pl-k">=</span> mock(<span class="pl-stj">Rental</span><span class="pl-k">.</span>class);
    assertEquals(
      <span class="pl-s1"><span class="pl-pds">"</span>Recent rentals:<span class="pl-cce">\n</span>null<span class="pl-cce">\n</span>null<span class="pl-pds">"</span></span>,
      a<span class="pl-k">.</span>customer<span class="pl-k">.</span>w(rental, rental)<span class="pl-k">.</span>build()
      .recentRentals());
  }
}</pre></div>

<div class="highlight highlight-java"><pre><span class="pl-s">public</span> <span class="pl-s">class</span> <span class="pl-en">Customer</span> {

  <span class="pl-s">private</span> <span class="pl-stj">String</span> name;
  <span class="pl-s">private</span> <span class="pl-st">List&lt;<span class="pl-stj">Rental</span>&gt;</span> rentals <span class="pl-k">=</span>
    <span class="pl-k">new</span> <span class="pl-st">ArrayList&lt;<span class="pl-stj">Rental</span>&gt;</span>();

  <span class="pl-s">public</span> <span class="pl-en">Customer</span>(<span class="pl-stj">String</span> <span class="pl-v">name</span>) {
    <span class="pl-v">this</span><span class="pl-k">.</span>name <span class="pl-k">=</span> name;
  }

  <span class="pl-s">public</span> <span class="pl-st">void</span> <span class="pl-en">addRental</span>(<span class="pl-stj">Rental</span> <span class="pl-v">rental</span>) {
    rentals<span class="pl-k">.</span>add(rental);
  }

  <span class="pl-s">public</span> <span class="pl-stj">String</span> <span class="pl-en">recentRentals</span>() {
    <span class="pl-stj">String</span> result <span class="pl-k">=</span> <span class="pl-s1"><span class="pl-pds">"</span>Recent rentals:<span class="pl-pds">"</span></span>;
    <span class="pl-k">for</span> (<span class="pl-st">int</span> i<span class="pl-k">=</span><span class="pl-c1">0</span>;
         i <span class="pl-k">&lt;</span> rentals<span class="pl-k">.</span>size() <span class="pl-k">&amp;&amp;</span> i <span class="pl-k">&lt;</span> <span class="pl-c1">3</span>;
         i<span class="pl-k">++</span>) {
      result <span class="pl-k">+=</span>

        <span class="pl-s1"><span class="pl-pds">"</span><span class="pl-cce">\n</span><span class="pl-pds">"</span></span> <span class="pl-k">+</span> rentals<span class="pl-k">.</span>get(i)<span class="pl-k">.</span>getTitle();

    }
    <span class="pl-k">return</span> result;
  }
}</pre></div>

<div class="highlight highlight-java"><pre><span class="pl-s">public</span> <span class="pl-s">class</span> <span class="pl-en">CustomerTest</span> {
  <span class="pl-st">@Test</span>
  <span class="pl-s">public</span> <span class="pl-st">void</span> <span class="pl-en">recentRentals0Rentals</span>() {
    assertEquals(
      <span class="pl-s1"><span class="pl-pds">"</span>Recent rentals:<span class="pl-pds">"</span></span>,
      a<span class="pl-k">.</span>customer<span class="pl-k">.</span>build()<span class="pl-k">.</span>recentRentals());
  }

  <span class="pl-st">@Test</span>
  <span class="pl-s">public</span> <span class="pl-st">void</span> <span class="pl-en">recentRentals1Rental</span>() {
    assertEquals(
      <span class="pl-s1"><span class="pl-pds">"</span>Recent rentals:<span class="pl-cce">\n</span>null<span class="pl-pds">"</span></span>,
      a<span class="pl-k">.</span>customer<span class="pl-k">.</span>w(
        mock(<span class="pl-stj">Rental</span><span class="pl-k">.</span>class))<span class="pl-k">.</span>build()
      .recentRentals());
  }

  <span class="pl-st">@Test</span>
  <span class="pl-s">public</span> <span class="pl-st">void</span> <span class="pl-en">recentRentals2Rental</span>() {
    assertEquals(
      <span class="pl-s1"><span class="pl-pds">"</span>Recent rentals:<span class="pl-cce">\n</span>null<span class="pl-cce">\n</span>null<span class="pl-pds">"</span></span>,
      a<span class="pl-k">.</span>customer<span class="pl-k">.</span>w(
        mock(<span class="pl-stj">Rental</span><span class="pl-k">.</span>class),
        mock(<span class="pl-stj">Rental</span><span class="pl-k">.</span>class))<span class="pl-k">.</span>build()
      .recentRentals());
  }</pre></div>

<div class="highlight highlight-java"><pre>  @<span class="pl-stj">Test</span>
  <span class="pl-s">public</span> <span class="pl-st">void</span> recentRentals3Rental() {
    assertEquals(
      <span class="pl-s1"><span class="pl-pds">"</span>Recent rentals:<span class="pl-cce">\n</span>null<span class="pl-cce">\n</span>null<span class="pl-cce">\n</span>null<span class="pl-pds">"</span></span>,
      a<span class="pl-k">.</span>customer<span class="pl-k">.</span>w(
        mock(<span class="pl-stj">Rental</span><span class="pl-k">.</span>class),
        mock(<span class="pl-stj">Rental</span><span class="pl-k">.</span>class),
        mock(<span class="pl-stj">Rental</span><span class="pl-k">.</span>class))<span class="pl-k">.</span>build()
      .recentRentals());
  }

  @<span class="pl-stj">Test</span>
  <span class="pl-s">public</span> <span class="pl-st">void</span> recentRentals4Rental() {
    assertEquals(
      <span class="pl-s1"><span class="pl-pds">"</span>Recent rentals:<span class="pl-cce">\n</span>null<span class="pl-cce">\n</span>null<span class="pl-cce">\n</span>null<span class="pl-pds">"</span></span>,
      a<span class="pl-k">.</span>customer<span class="pl-k">.</span>w(
        mock(<span class="pl-stj">Rental</span><span class="pl-k">.</span>class),
        mock(<span class="pl-stj">Rental</span><span class="pl-k">.</span>class),
        mock(<span class="pl-stj">Rental</span><span class="pl-k">.</span>class),
        mock(<span class="pl-stj">Rental</span><span class="pl-k">.</span>class))<span class="pl-k">.</span>build()
      .recentRentals());
  }
}</pre></div>

<h3>
<a id="get-sociable" class="anchor" href="#get-sociable" aria-hidden="true"><span class="octicon octicon-link"></span></a>Get Sociable</h3>

<div class="highlight highlight-java"><pre><span class="pl-s">public</span> <span class="pl-s">class</span> <span class="pl-en">CustomerTest</span> {
  <span class="pl-st">@Test</span>
  <span class="pl-s">public</span> <span class="pl-st">void</span>
  <span class="pl-en">recentRentalsWith3OrderedRentals</span>() {
    assertEquals(
      <span class="pl-s1"><span class="pl-pds">"</span>Recent rentals:<span class="pl-pds">"</span></span><span class="pl-k">+</span>
      <span class="pl-s1"><span class="pl-pds">"</span><span class="pl-cce">\n</span>Godfather 4<span class="pl-cce">\n</span>Lion King<span class="pl-cce">\n</span>Scarface<span class="pl-pds">"</span></span>,
      a<span class="pl-k">.</span>customer<span class="pl-k">.</span>w(
        a<span class="pl-k">.</span>rental<span class="pl-k">.</span>w(a<span class="pl-k">.</span>movie<span class="pl-k">.</span>w(<span class="pl-s1"><span class="pl-pds">"</span>Godfather 4<span class="pl-pds">"</span></span>)),
        a<span class="pl-k">.</span>rental<span class="pl-k">.</span>w(a<span class="pl-k">.</span>movie<span class="pl-k">.</span>w(<span class="pl-s1"><span class="pl-pds">"</span>Lion King<span class="pl-pds">"</span></span>)),
        a<span class="pl-k">.</span>rental<span class="pl-k">.</span>w(a<span class="pl-k">.</span>movie<span class="pl-k">.</span>w(<span class="pl-s1"><span class="pl-pds">"</span>Scarface<span class="pl-pds">"</span></span>)),
        a<span class="pl-k">.</span>rental<span class="pl-k">.</span>w(a<span class="pl-k">.</span>movie<span class="pl-k">.</span>w(<span class="pl-s1"><span class="pl-pds">"</span>Notebook<span class="pl-pds">"</span></span>)))
      .build()<span class="pl-k">.</span>recentRentals());
  }
}</pre></div>

<h3>
<a id="comparison" class="anchor" href="#comparison" aria-hidden="true"><span class="octicon octicon-link"></span></a>Comparison</h3>

<h4>
<a id="the-previously-unwritten-original-test-with-four-rentals" class="anchor" href="#the-previously-unwritten-original-test-with-four-rentals" aria-hidden="true"><span class="octicon octicon-link"></span></a>The (Previously Unwritten) Original Test with Four Rentals</h4>

<div class="highlight highlight-java"><pre><span class="pl-s">public</span> <span class="pl-s">class</span> <span class="pl-en">CustomerTest</span> {
  <span class="pl-st">@Test</span>
  <span class="pl-s">public</span> <span class="pl-st">void</span> <span class="pl-en">recentRentalsWith4Rentals</span>() {
    <span class="pl-stj">Movie</span> godfather <span class="pl-k">=</span> mock(<span class="pl-stj">Movie</span><span class="pl-k">.</span>class);
    when(godfather
         .getTitle(<span class="pl-s1"><span class="pl-pds">"</span>%s starring %s %s<span class="pl-pds">"</span></span>, <span class="pl-c1">2</span>))
      .thenReturn(<span class="pl-s1"><span class="pl-pds">"</span>Godfather 4<span class="pl-pds">"</span></span>);
    <span class="pl-stj">Rental</span> godfatherRental <span class="pl-k">=</span>
      mock(<span class="pl-stj">Rental</span><span class="pl-k">.</span>class);
    when(godfatherRental<span class="pl-k">.</span>getMovie(<span class="pl-c1">true</span>))
      .thenReturn(godfather);
    <span class="pl-stj">Movie</span> lionKing <span class="pl-k">=</span> mock(<span class="pl-stj">Movie</span><span class="pl-k">.</span>class);
    when(lionKing
         .getTitle(<span class="pl-s1"><span class="pl-pds">"</span>%s starring %s %s<span class="pl-pds">"</span></span>, <span class="pl-c1">2</span>))
      .thenReturn(<span class="pl-s1"><span class="pl-pds">"</span>Lion King<span class="pl-pds">"</span></span>);
    <span class="pl-stj">Rental</span> lionKingRental <span class="pl-k">=</span>
      mock(<span class="pl-stj">Rental</span><span class="pl-k">.</span>class);
    when(lionKingRental<span class="pl-k">.</span>getMovie(<span class="pl-c1">true</span>))
      .thenReturn(lionKing);
    <span class="pl-stj">Movie</span> scarface <span class="pl-k">=</span> mock(<span class="pl-stj">Movie</span><span class="pl-k">.</span>class);
    when(scarface
         .getTitle(<span class="pl-s1"><span class="pl-pds">"</span>%s starring %s %s<span class="pl-pds">"</span></span>, <span class="pl-c1">2</span>))
      .thenReturn(<span class="pl-s1"><span class="pl-pds">"</span>Scarface<span class="pl-pds">"</span></span>);
    <span class="pl-stj">Rental</span> scarfaceRental <span class="pl-k">=</span>
      mock(<span class="pl-stj">Rental</span><span class="pl-k">.</span>class);
    when(scarfaceRental<span class="pl-k">.</span>getMovie(<span class="pl-c1">true</span>))
      .thenReturn(scarface);
    <span class="pl-stj">Movie</span> notebook <span class="pl-k">=</span> mock(<span class="pl-stj">Movie</span><span class="pl-k">.</span>class);
    when(notebook
         .getTitle(<span class="pl-s1"><span class="pl-pds">"</span>%s starring %s %s<span class="pl-pds">"</span></span>, <span class="pl-c1">2</span>))
      .thenReturn(<span class="pl-s1"><span class="pl-pds">"</span>Notebook<span class="pl-pds">"</span></span>);
    <span class="pl-stj">Rental</span> notebookRental <span class="pl-k">=</span>
      mock(<span class="pl-stj">Rental</span><span class="pl-k">.</span>class);
    when(notebookRental<span class="pl-k">.</span>getMovie(<span class="pl-c1">true</span>))
      .thenReturn(notebook);

    assertEquals(
      <span class="pl-s1"><span class="pl-pds">"</span>Recent rentals:<span class="pl-pds">"</span></span><span class="pl-k">+</span>
      <span class="pl-s1"><span class="pl-pds">"</span><span class="pl-cce">\n</span>Godfather 4<span class="pl-cce">\n</span>Lion King<span class="pl-pds">"</span></span> <span class="pl-k">+</span>
      <span class="pl-s1"><span class="pl-pds">"</span><span class="pl-cce">\n</span>Scarface<span class="pl-pds">"</span></span>,
      a<span class="pl-k">.</span>customer<span class="pl-k">.</span>w(
        godfatherRental, lionKingRental,
        scarfaceRental, notebookRental)
      .build()<span class="pl-k">.</span>recentRentals());
  }
}</pre></div>

<h4>
<a id="the-sociable-unit-test-and-the-sparsely-specified-solitary-unit-tests" class="anchor" href="#the-sociable-unit-test-and-the-sparsely-specified-solitary-unit-tests" aria-hidden="true"><span class="octicon octicon-link"></span></a>The Sociable Unit Test and The Sparsely Specified Solitary Unit Tests</h4>

<div class="highlight highlight-java"><pre><span class="pl-s">public</span> <span class="pl-s">class</span> <span class="pl-en">CustomerTest</span> {
  <span class="pl-st">@Test</span>
  <span class="pl-s">public</span> <span class="pl-st">void</span>
  <span class="pl-en">recentRentalsWith3OrderedRentals</span>() {
    assertEquals(
      <span class="pl-s1"><span class="pl-pds">"</span>Recent rentals:<span class="pl-pds">"</span></span><span class="pl-k">+</span>
      <span class="pl-s1"><span class="pl-pds">"</span><span class="pl-cce">\n</span>Godfather 4<span class="pl-cce">\n</span>Lion King<span class="pl-cce">\n</span>Scarface<span class="pl-pds">"</span></span>,
      a<span class="pl-k">.</span>customer<span class="pl-k">.</span>w(
        a<span class="pl-k">.</span>rental<span class="pl-k">.</span>w(a<span class="pl-k">.</span>movie<span class="pl-k">.</span>w(<span class="pl-s1"><span class="pl-pds">"</span>Godfather 4<span class="pl-pds">"</span></span>)),
        a<span class="pl-k">.</span>rental<span class="pl-k">.</span>w(a<span class="pl-k">.</span>movie<span class="pl-k">.</span>w(<span class="pl-s1"><span class="pl-pds">"</span>Lion King<span class="pl-pds">"</span></span>)),
        a<span class="pl-k">.</span>rental<span class="pl-k">.</span>w(a<span class="pl-k">.</span>movie<span class="pl-k">.</span>w(<span class="pl-s1"><span class="pl-pds">"</span>Scarface<span class="pl-pds">"</span></span>)),
        a<span class="pl-k">.</span>rental<span class="pl-k">.</span>w(a<span class="pl-k">.</span>movie<span class="pl-k">.</span>w(<span class="pl-s1"><span class="pl-pds">"</span>Notebook<span class="pl-pds">"</span></span>)))
      .build()<span class="pl-k">.</span>recentRentals());
  }
}</pre></div>

<div class="highlight highlight-java"><pre><span class="pl-s">public</span> <span class="pl-s">class</span> <span class="pl-en">CustomerTest</span> {
  <span class="pl-st">@Test</span>
  <span class="pl-s">public</span> <span class="pl-st">void</span> <span class="pl-en">recentRentals0Rentals</span>() {
    assertEquals(
      <span class="pl-s1"><span class="pl-pds">"</span>Recent rentals:<span class="pl-pds">"</span></span>,
      a<span class="pl-k">.</span>customer<span class="pl-k">.</span>build()<span class="pl-k">.</span>recentRentals());
  }

  <span class="pl-st">@Test</span>
  <span class="pl-s">public</span> <span class="pl-st">void</span> <span class="pl-en">recentRentals1Rental</span>() {
    assertEquals(
      <span class="pl-s1"><span class="pl-pds">"</span>Recent rentals:<span class="pl-cce">\n</span>null<span class="pl-pds">"</span></span>,
      a<span class="pl-k">.</span>customer<span class="pl-k">.</span>w(
        mock(<span class="pl-stj">Rental</span><span class="pl-k">.</span>class))<span class="pl-k">.</span>build()
      .recentRentals());
  }

  <span class="pl-st">@Test</span>
  <span class="pl-s">public</span> <span class="pl-st">void</span> <span class="pl-en">recentRentals2Rental</span>() {
    assertEquals(
      <span class="pl-s1"><span class="pl-pds">"</span>Recent rentals:<span class="pl-cce">\n</span>null<span class="pl-cce">\n</span>null<span class="pl-pds">"</span></span>,
      a<span class="pl-k">.</span>customer<span class="pl-k">.</span>w(
        mock(<span class="pl-stj">Rental</span><span class="pl-k">.</span>class),
        mock(<span class="pl-stj">Rental</span><span class="pl-k">.</span>class))<span class="pl-k">.</span>build()
      .recentRentals());
  }</pre></div>

<div class="highlight highlight-java"><pre>  @<span class="pl-stj">Test</span>
  <span class="pl-s">public</span> <span class="pl-st">void</span> recentRentals3Rental() {
    assertEquals(
      <span class="pl-s1"><span class="pl-pds">"</span>Recent rentals:<span class="pl-cce">\n</span>null<span class="pl-cce">\n</span>null<span class="pl-cce">\n</span>null<span class="pl-pds">"</span></span>,
      a<span class="pl-k">.</span>customer<span class="pl-k">.</span>w(
        mock(<span class="pl-stj">Rental</span><span class="pl-k">.</span>class),
        mock(<span class="pl-stj">Rental</span><span class="pl-k">.</span>class),
        mock(<span class="pl-stj">Rental</span><span class="pl-k">.</span>class))<span class="pl-k">.</span>build()
      .recentRentals());
  }

  @<span class="pl-stj">Test</span>
  <span class="pl-s">public</span> <span class="pl-st">void</span> recentRentals4Rental() {
    assertEquals(
      <span class="pl-s1"><span class="pl-pds">"</span>Recent rentals:<span class="pl-cce">\n</span>null<span class="pl-cce">\n</span>null<span class="pl-cce">\n</span>null<span class="pl-pds">"</span></span>,
      a<span class="pl-k">.</span>customer<span class="pl-k">.</span>w(
        mock(<span class="pl-stj">Rental</span><span class="pl-k">.</span>class),
        mock(<span class="pl-stj">Rental</span><span class="pl-k">.</span>class),
        mock(<span class="pl-stj">Rental</span><span class="pl-k">.</span>class),
        mock(<span class="pl-stj">Rental</span><span class="pl-k">.</span>class))<span class="pl-k">.</span>build()
      .recentRentals());
  }
}</pre></div>

<h2>
<a id="assert-last" class="anchor" href="#assert-last" aria-hidden="true"><span class="octicon octicon-link"></span></a>Assert Last</h2>

<h3>
<a id="expect-exceptions-via-trycatch" class="anchor" href="#expect-exceptions-via-trycatch" aria-hidden="true"><span class="octicon octicon-link"></span></a>Expect Exceptions via Try/Catch</h3>

<div class="highlight highlight-java"><pre><span class="pl-s">public</span> <span class="pl-s">class</span> <span class="pl-en">MovieTest</span> {
  <span class="pl-st">@Test</span>
  (expected<span class="pl-k">=</span><span class="pl-stj">IllegalArgumentException</span><span class="pl-k">.</span>class)
  <span class="pl-s">public</span> <span class="pl-st">void</span> <span class="pl-en">invalidTitle</span>() {
    a<span class="pl-k">.</span>movie<span class="pl-k">.</span>w(<span class="pl-c1">UNKNOWN</span>)<span class="pl-k">.</span>build();
  }
}</pre></div>

<div class="highlight highlight-java"><pre><span class="pl-s">public</span> <span class="pl-s">class</span> <span class="pl-en">MovieTest</span> {
  <span class="pl-st">@Test</span>
  <span class="pl-s">public</span> <span class="pl-st">void</span> <span class="pl-en">invalidTitle</span>() {
    <span class="pl-k">try</span> {
      a<span class="pl-k">.</span>movie<span class="pl-k">.</span>w(<span class="pl-c1">UNKNOWN</span>)<span class="pl-k">.</span>build();
      fail();
    } <span class="pl-k">catch</span> (<span class="pl-stj">Exception</span> ex) {
      assertEquals(
        <span class="pl-stj">IllegalArgumentException</span><span class="pl-k">.</span>class,
        ex<span class="pl-k">.</span>getClass());
    }
  }
}</pre></div>

<div class="highlight highlight-java"><pre><span class="pl-s">public</span> <span class="pl-s">class</span> <span class="pl-en">MovieTest</span> {
  <span class="pl-st">@Test</span>
  <span class="pl-s">public</span> <span class="pl-st">void</span> <span class="pl-en">invalidTitle</span>() {
    <span class="pl-stj">Exception</span> e <span class="pl-k">=</span> <span class="pl-c1">null</span>;
    <span class="pl-k">try</span> {
      a<span class="pl-k">.</span>movie<span class="pl-k">.</span>w(<span class="pl-c1">UNKNOWN</span>)<span class="pl-k">.</span>build();
    } <span class="pl-k">catch</span> (<span class="pl-stj">Exception</span> ex) {
      e <span class="pl-k">=</span> ex;
    }
    assertEquals(
      <span class="pl-stj">IllegalArgumentException</span><span class="pl-k">.</span>class,
      e<span class="pl-k">.</span>getClass());
  }
}</pre></div>

<h3>
<a id="assert-throws" class="anchor" href="#assert-throws" aria-hidden="true"><span class="octicon octicon-link"></span></a>Assert Throws</h3>

<div class="highlight highlight-java"><pre><span class="pl-s">public</span> <span class="pl-s">class</span> <span class="pl-en">MovieTest</span> {
  <span class="pl-st">@Test</span>
  <span class="pl-s">public</span> <span class="pl-st">void</span> <span class="pl-en">invalidTitle</span>() {
    <span class="pl-stj">Runnable</span> runnable <span class="pl-k">=</span> <span class="pl-k">new</span> <span class="pl-stj">Runnable</span>() {
        <span class="pl-s">public</span> <span class="pl-st">void</span> <span class="pl-en">run</span>() {
          a<span class="pl-k">.</span>movie<span class="pl-k">.</span>w(<span class="pl-c1">UNKNOWN</span>)<span class="pl-k">.</span>build();
        }
      };
    assertThrows(
      <span class="pl-stj">IllegalArgumentException</span><span class="pl-k">.</span>class,
      runnable);
  }

  <span class="pl-s">public</span> <span class="pl-st">void</span> <span class="pl-en">assertThrows</span>(
    <span class="pl-stj">Class</span> <span class="pl-v">ex</span>, <span class="pl-stj">Runnable</span> <span class="pl-v">runnable</span>) {
    <span class="pl-stj">Exception</span> exThrown <span class="pl-k">=</span> <span class="pl-c1">null</span>;
    <span class="pl-k">try</span> {
      runnable<span class="pl-k">.</span>run();
    } <span class="pl-k">catch</span> (<span class="pl-stj">Exception</span> exThrownActual) {
      exThrown <span class="pl-k">=</span> exThrownActual;
    }
    <span class="pl-k">if</span> (<span class="pl-c1">null</span> <span class="pl-k">==</span> exThrown)
      fail(<span class="pl-s1"><span class="pl-pds">"</span>No exception thrown<span class="pl-pds">"</span></span>);
    <span class="pl-k">else</span>
      assertEquals(ex, exThrown<span class="pl-k">.</span>getClass());
  }
}</pre></div>

<h3>
<a id="mock-verification" class="anchor" href="#mock-verification" aria-hidden="true"><span class="octicon octicon-link"></span></a>Mock Verification</h3>

<h3>
<a id="comparison-1" class="anchor" href="#comparison-1" aria-hidden="true"><span class="octicon octicon-link"></span></a>Comparison</h3>

<div class="highlight highlight-java"><pre><span class="pl-s">public</span> <span class="pl-s">class</span> <span class="pl-en">MovieTest</span> {
  <span class="pl-stj">Mockery</span> context <span class="pl-k">=</span> <span class="pl-k">new</span> <span class="pl-stj">Mockery</span>();

  <span class="pl-st">@Test</span>
  <span class="pl-s">public</span> <span class="pl-st">void</span> <span class="pl-en">getPointsForDays</span>() {
    <span class="pl-stj">Movie</span> movie <span class="pl-k">=</span> a<span class="pl-k">.</span>movie<span class="pl-k">.</span>build();
    assertEquals(<span class="pl-c1">1</span>, movie<span class="pl-k">.</span>getPoints(<span class="pl-c1">2</span>));
    assertEquals(<span class="pl-c1">1</span>, movie<span class="pl-k">.</span>getPoints(<span class="pl-c1">3</span>));
  }

  <span class="pl-st">@Test</span>
  (expected<span class="pl-k">=</span><span class="pl-stj">IllegalArgumentException</span><span class="pl-k">.</span>class)
  <span class="pl-s">public</span> <span class="pl-st">void</span> <span class="pl-en">invalidTitle</span>() {
    a<span class="pl-k">.</span>movie<span class="pl-k">.</span>w(<span class="pl-c1">UNKNOWN</span>)<span class="pl-k">.</span>build();
  }

  <span class="pl-st">@Test</span>
  <span class="pl-s">public</span> <span class="pl-st">void</span> <span class="pl-en">getPriceFromPriceInstance</span>() {
    <span class="pl-s">final</span> <span class="pl-stj">Price</span> price <span class="pl-k">=</span>
      context<span class="pl-k">.</span>mock(<span class="pl-stj">Price</span><span class="pl-k">.</span>class);
    <span class="pl-stj">Movie</span> movie <span class="pl-k">=</span> a<span class="pl-k">.</span>movie<span class="pl-k">.</span>build();
    movie<span class="pl-k">.</span>setPrice(price);

    context<span class="pl-k">.</span>checking(<span class="pl-k">new</span> <span class="pl-stj">Expectations</span>() {{
      oneOf(price)<span class="pl-k">.</span>getCharge(<span class="pl-c1">3</span>);
    }});

    movie<span class="pl-k">.</span>getCharge(<span class="pl-c1">3</span>);
    context<span class="pl-k">.</span>assertIsSatisfied();
  }
}</pre></div>

<div class="highlight highlight-java"><pre><span class="pl-s">public</span> <span class="pl-s">class</span> <span class="pl-en">MovieTest</span> {
  <span class="pl-st">@Test</span>
  <span class="pl-s">public</span> <span class="pl-st">void</span> <span class="pl-en">getPoints2Days</span>() {
    assertEquals(
      <span class="pl-c1">2</span>, a<span class="pl-k">.</span>movie<span class="pl-k">.</span>build()<span class="pl-k">.</span>getPoints(<span class="pl-c1">2</span>));
  }

  <span class="pl-st">@Test</span>
  <span class="pl-s">public</span> <span class="pl-st">void</span> <span class="pl-en">getPoints3Days</span>() {
    assertEquals(
      <span class="pl-c1">2</span>, a<span class="pl-k">.</span>movie<span class="pl-k">.</span>build()<span class="pl-k">.</span>getPoints(<span class="pl-c1">3</span>));
  }

  <span class="pl-st">@Test</span>
  <span class="pl-s">public</span> <span class="pl-st">void</span> <span class="pl-en">invalidTitle</span>() {
    <span class="pl-stj">Runnable</span> runnable <span class="pl-k">=</span> <span class="pl-k">new</span> <span class="pl-stj">Runnable</span>() {
        <span class="pl-s">public</span> <span class="pl-st">void</span> <span class="pl-en">run</span>() {
          a<span class="pl-k">.</span>movie<span class="pl-k">.</span>w(<span class="pl-c1">UNKNOWN</span>)<span class="pl-k">.</span>build();
        }
      };
    assertThrows(
      <span class="pl-stj">IllegalArgumentException</span><span class="pl-k">.</span>class,
      runnable);
  }</pre></div>

<div class="highlight highlight-java"><pre>  @<span class="pl-stj">Test</span>
  <span class="pl-s">public</span> <span class="pl-st">void</span> getPriceFromPriceInstance() {
    <span class="pl-stj">Price</span> price <span class="pl-k">=</span> mock(<span class="pl-stj">Price</span><span class="pl-k">.</span>class);
    <span class="pl-stj">Movie</span> movie <span class="pl-k">=</span> a<span class="pl-k">.</span>movie<span class="pl-k">.</span>build();
    movie<span class="pl-k">.</span>setPrice(price);
    movie<span class="pl-k">.</span>getCharge(<span class="pl-c1">3</span>);
    verify(price)<span class="pl-k">.</span>getCharge(<span class="pl-c1">3</span>);
  }
}</pre></div>

<h2>
<a id="expect-literals-1" class="anchor" href="#expect-literals-1" aria-hidden="true"><span class="octicon octicon-link"></span></a>Expect Literals</h2>

<div class="highlight highlight-java"><pre><span class="pl-s">public</span> <span class="pl-s">class</span> <span class="pl-en">RegularPriceTest</span> {
  <span class="pl-st">@Test</span>
  <span class="pl-s">public</span> <span class="pl-st">void</span> <span class="pl-en">chargeWithStaticVal</span>() {
    assertEquals(
      basePrice,
      a<span class="pl-k">.</span>regularPrice<span class="pl-k">.</span>build()<span class="pl-k">.</span>getCharge(<span class="pl-c1">2</span>),
      <span class="pl-c1">0</span>);
  }

  <span class="pl-st">@Test</span>
  <span class="pl-s">public</span> <span class="pl-st">void</span> <span class="pl-en">chargeWithLocalVal</span>() {
    <span class="pl-st">int</span> daysRented <span class="pl-k">=</span> <span class="pl-c1">4</span>;
    <span class="pl-st">double</span> charge <span class="pl-k">=</span>
      basePrice <span class="pl-k">+</span> (
        daysRented <span class="pl-k">-</span> <span class="pl-c1">2</span>) <span class="pl-k">*</span> multiplier;
    assertEquals(
      charge,
      a<span class="pl-k">.</span>regularPrice<span class="pl-k">.</span>build()<span class="pl-k">.</span>getCharge(
        daysRented),
      <span class="pl-c1">0</span>);
  }

  <span class="pl-st">@Test</span>
  <span class="pl-s">public</span> <span class="pl-st">void</span> <span class="pl-en">chargeWithLiteral</span>() {
    assertEquals(
      <span class="pl-c1">5.0</span>,
      a<span class="pl-k">.</span>regularPrice<span class="pl-k">.</span>build()<span class="pl-k">.</span>getCharge(<span class="pl-c1">4</span>),
      <span class="pl-c1">0</span>);
  }
}</pre></div>

<h3>
<a id="value-objects-vs-expect-literals" class="anchor" href="#value-objects-vs-expect-literals" aria-hidden="true"><span class="octicon octicon-link"></span></a>Value Objects vs Expect Literals</h3>

<div class="highlight highlight-java"><pre><span class="pl-s">public</span> <span class="pl-s">class</span> <span class="pl-en">MovieTest</span> {
  <span class="pl-st">@Test</span>
  <span class="pl-s">public</span> <span class="pl-st">void</span> <span class="pl-en">compareDates</span>() {
    <span class="pl-stj">Movie</span> godfather <span class="pl-k">=</span>
      a<span class="pl-k">.</span>movie<span class="pl-k">.</span>w(
        <span class="pl-k">new</span> <span class="pl-stj">Date</span>(<span class="pl-c1">70261200000L</span>))<span class="pl-k">.</span>build();
    assertEquals(
      <span class="pl-s1"><span class="pl-pds">"</span>1972-03-24<span class="pl-pds">"</span></span>,
      <span class="pl-k">new</span> <span class="pl-stj">SimpleDateFormat</span>(
        <span class="pl-s1"><span class="pl-pds">"</span>yyyy-MM-dd<span class="pl-pds">"</span></span>)<span class="pl-k">.</span>format(
          godfather<span class="pl-k">.</span>releaseDate()));
  }
}</pre></div>

<h3>
<a id="comparison-2" class="anchor" href="#comparison-2" aria-hidden="true"><span class="octicon octicon-link"></span></a>Comparison</h3>

<div class="highlight highlight-java"><pre><span class="pl-s">public</span> <span class="pl-s">class</span> <span class="pl-en">CustomerTest</span> {
  <span class="pl-st">@Test</span>
  <span class="pl-s">public</span> <span class="pl-st">void</span> <span class="pl-en">statementFor1Rental</span>() {
    <span class="pl-stj">Rental</span> rental <span class="pl-k">=</span> mock(<span class="pl-stj">Rental</span><span class="pl-k">.</span>class);
    <span class="pl-stj">Customer</span> customer <span class="pl-k">=</span>
      a<span class="pl-k">.</span>customer<span class="pl-k">.</span>w(rental)<span class="pl-k">.</span>build();

    assertEquals(
      expStatement(
        <span class="pl-s1"><span class="pl-pds">"</span>Rental record for %s<span class="pl-cce">\n</span>%sAmount <span class="pl-pds">"</span></span> <span class="pl-k">+</span>
        <span class="pl-s1"><span class="pl-pds">"</span>owed is %s<span class="pl-cce">\n</span><span class="pl-pds">"</span></span> <span class="pl-k">+</span>
        <span class="pl-s1"><span class="pl-pds">"</span>You earned %s frequent <span class="pl-pds">"</span></span> <span class="pl-k">+</span>
        <span class="pl-s1"><span class="pl-pds">"</span>renter points<span class="pl-pds">"</span></span>,
        customer,
        rentalInfo(
          <span class="pl-s1"><span class="pl-pds">"</span><span class="pl-cce">\t</span><span class="pl-pds">"</span></span>, <span class="pl-s1"><span class="pl-pds">"</span><span class="pl-pds">"</span></span>, <span class="pl-k">new</span> <span class="pl-stj">Rental</span>[] {rental})),
      customer<span class="pl-k">.</span>statement());
  }</pre></div>

<div class="highlight highlight-java"><pre>  @<span class="pl-stj">Test</span>
  <span class="pl-s">public</span> <span class="pl-st">void</span> statementFor2Rentals() {
    <span class="pl-stj">Rental</span> godfather <span class="pl-k">=</span> mock(<span class="pl-stj">Rental</span><span class="pl-k">.</span>class);
    <span class="pl-stj">Rental</span> scarface <span class="pl-k">=</span> mock(<span class="pl-stj">Rental</span><span class="pl-k">.</span>class);
    <span class="pl-stj">Customer</span> customer <span class="pl-k">=</span>
      a<span class="pl-k">.</span>customer<span class="pl-k">.</span>w(
        godfather, scarface)<span class="pl-k">.</span>build();

    assertEquals(
      expStatement(
        <span class="pl-s1"><span class="pl-pds">"</span>Rental record for %s<span class="pl-cce">\n</span>%sAmount <span class="pl-pds">"</span></span> <span class="pl-k">+</span>
        <span class="pl-s1"><span class="pl-pds">"</span>owed is %s<span class="pl-cce">\n</span><span class="pl-pds">"</span></span> <span class="pl-k">+</span>
        <span class="pl-s1"><span class="pl-pds">"</span>You earned %s frequent <span class="pl-pds">"</span></span> <span class="pl-k">+</span>
        <span class="pl-s1"><span class="pl-pds">"</span>renter points<span class="pl-pds">"</span></span>,
        customer,
        rentalInfo(
          <span class="pl-s1"><span class="pl-pds">"</span><span class="pl-cce">\t</span><span class="pl-pds">"</span></span>, <span class="pl-s1"><span class="pl-pds">"</span><span class="pl-pds">"</span></span>, <span class="pl-k">new</span> <span class="pl-stj">Rental</span>[] {
            godfather, scarface})),
      customer<span class="pl-k">.</span>statement());
  }</pre></div>

<div class="highlight highlight-java"><pre>  <span class="pl-s">public</span> <span class="pl-s">static</span> <span class="pl-stj">String</span> rentalInfo(
    <span class="pl-stj">String</span> startsWith,
    <span class="pl-stj">String</span> endsWith,
    <span class="pl-st">Rental</span>[] rentals) {
    <span class="pl-stj">String</span> result <span class="pl-k">=</span> <span class="pl-s1"><span class="pl-pds">"</span><span class="pl-pds">"</span></span>;
    <span class="pl-k">for</span> (<span class="pl-stj">Rental</span> rental <span class="pl-k">:</span> rentals)
      result <span class="pl-k">+=</span> <span class="pl-stj">String</span><span class="pl-k">.</span>format(
        <span class="pl-s1"><span class="pl-pds">"</span>%s%s%s<span class="pl-cce">\n</span><span class="pl-pds">"</span></span>,
        startsWith,
        rental<span class="pl-k">.</span>getLineItem(),
        endsWith);
    <span class="pl-k">return</span> result;
  }

  <span class="pl-s">public</span> <span class="pl-s">static</span> <span class="pl-stj">String</span> expStatement(
    <span class="pl-stj">String</span> formatStr,
    <span class="pl-stj">Customer</span> customer,
    <span class="pl-stj">String</span> rentalInfo) {
    <span class="pl-k">return</span> <span class="pl-stj">String</span><span class="pl-k">.</span>format(
      formatStr,
      customer<span class="pl-k">.</span>getName(),
      rentalInfo,
      customer<span class="pl-k">.</span>getTotalCharge(),
      customer<span class="pl-k">.</span>getTotalPoints());
  }
}</pre></div>

<div class="highlight highlight-java"><pre><span class="pl-s">public</span> <span class="pl-s">class</span> <span class="pl-en">CustomerTest</span> {
  <span class="pl-st">@Test</span>
  <span class="pl-s">public</span> <span class="pl-st">void</span> <span class="pl-en">statementFor1Rental</span>() {
    <span class="pl-stj">Customer</span> customer <span class="pl-k">=</span>
      a<span class="pl-k">.</span>customer<span class="pl-k">.</span>w(
        mock(<span class="pl-stj">Rental</span><span class="pl-k">.</span>class))<span class="pl-k">.</span>build();

    assertEquals(
      <span class="pl-s1"><span class="pl-pds">"</span>Rental record for Jim<span class="pl-cce">\n</span><span class="pl-pds">"</span></span> <span class="pl-k">+</span>
      <span class="pl-s1"><span class="pl-pds">"</span><span class="pl-cce">\t</span>null<span class="pl-cce">\n</span><span class="pl-pds">"</span></span> <span class="pl-k">+</span>
      <span class="pl-s1"><span class="pl-pds">"</span>Amount owed is 0.0<span class="pl-cce">\n</span><span class="pl-pds">"</span></span> <span class="pl-k">+</span>
      <span class="pl-s1"><span class="pl-pds">"</span>You earned 0 frequent renter points<span class="pl-pds">"</span></span>,
      customer<span class="pl-k">.</span>statement());
  }

  <span class="pl-st">@Test</span>
  <span class="pl-s">public</span> <span class="pl-st">void</span> <span class="pl-en">statementFor2Rentals</span>() {
    <span class="pl-stj">Customer</span> customer <span class="pl-k">=</span>
      a<span class="pl-k">.</span>customer<span class="pl-k">.</span>w(
        mock(<span class="pl-stj">Rental</span><span class="pl-k">.</span>class),
        mock(<span class="pl-stj">Rental</span><span class="pl-k">.</span>class))<span class="pl-k">.</span>build();

    assertEquals(
      <span class="pl-s1"><span class="pl-pds">"</span>Rental record for Jim<span class="pl-cce">\n</span><span class="pl-pds">"</span></span><span class="pl-k">+</span>
      <span class="pl-s1"><span class="pl-pds">"</span><span class="pl-cce">\t</span>null<span class="pl-cce">\n</span><span class="pl-pds">"</span></span> <span class="pl-k">+</span>
      <span class="pl-s1"><span class="pl-pds">"</span><span class="pl-cce">\t</span>null<span class="pl-cce">\n</span><span class="pl-pds">"</span></span> <span class="pl-k">+</span>
      <span class="pl-s1"><span class="pl-pds">"</span>Amount owed is 0.0<span class="pl-cce">\n</span><span class="pl-pds">"</span></span> <span class="pl-k">+</span>
      <span class="pl-s1"><span class="pl-pds">"</span>You earned 0 frequent renter points<span class="pl-pds">"</span></span>,
      customer<span class="pl-k">.</span>statement());
  }
}</pre></div>

<h2>
<a id="negative-testing" class="anchor" href="#negative-testing" aria-hidden="true"><span class="octicon octicon-link"></span></a>Negative Testing</h2>

<div class="highlight highlight-java"><pre><span class="pl-s">public</span> <span class="pl-s">class</span> <span class="pl-en">RentalTest</span> {
  <span class="pl-st">@Test</span>
  <span class="pl-s">public</span> <span class="pl-st">void</span>
  <span class="pl-en">storeMockNeverReceivesRemove</span>() {
    <span class="pl-stj">Movie</span> movie <span class="pl-k">=</span> mock(<span class="pl-stj">Movie</span><span class="pl-k">.</span>class);
    <span class="pl-stj">Rental</span> rental <span class="pl-k">=</span>
      a<span class="pl-k">.</span>rental<span class="pl-k">.</span>w(movie)<span class="pl-k">.</span>build();
    <span class="pl-stj">Store</span> store <span class="pl-k">=</span> mock(<span class="pl-stj">Store</span><span class="pl-k">.</span>class);
    when(
      store<span class="pl-k">.</span>getAvailability(
        any(<span class="pl-stj">Movie</span><span class="pl-k">.</span>class)))
      .thenReturn(<span class="pl-c1">0</span>);
    rental<span class="pl-k">.</span>start(store);
    verify(store, never())<span class="pl-k">.</span>remove(movie);
  }

  <span class="pl-st">@Test</span>
  <span class="pl-s">public</span> <span class="pl-st">void</span> <span class="pl-en">failOnStoreRemove</span>() {
    <span class="pl-stj">Movie</span> movie <span class="pl-k">=</span> mock(<span class="pl-stj">Movie</span><span class="pl-k">.</span>class);
    <span class="pl-stj">Rental</span> rental <span class="pl-k">=</span>
      a<span class="pl-k">.</span>rental<span class="pl-k">.</span>w(movie)<span class="pl-k">.</span>build();
    <span class="pl-stj">Store</span> store <span class="pl-k">=</span> <span class="pl-k">new</span> <span class="pl-stj">Store</span>(
      <span class="pl-k">new</span> <span class="pl-st">HashMap&lt;<span class="pl-stj">Movie</span>,<span class="pl-stj">Integer</span>&gt;</span>()) {
        <span class="pl-s">public</span> <span class="pl-st">void</span> <span class="pl-en">remove</span>(<span class="pl-stj">Movie</span> <span class="pl-v">movie</span>) {
          fail();
        }
      };
    rental<span class="pl-k">.</span>start(store);
  }</pre></div>

<div class="highlight highlight-java"><pre>  @<span class="pl-stj">Test</span>
  <span class="pl-s">public</span> <span class="pl-st">void</span> storeShouldNeverRemove() {
    <span class="pl-s">final</span> <span class="pl-st">boolean</span>[] removeCalled <span class="pl-k">=</span> { <span class="pl-c1">false</span> };
    <span class="pl-stj">Movie</span> movie <span class="pl-k">=</span> mock(<span class="pl-stj">Movie</span><span class="pl-k">.</span>class);
    <span class="pl-stj">Rental</span> rental <span class="pl-k">=</span>
      a<span class="pl-k">.</span>rental<span class="pl-k">.</span>w(movie)<span class="pl-k">.</span>build();
    <span class="pl-stj">Store</span> store <span class="pl-k">=</span> <span class="pl-k">new</span> <span class="pl-stj">Store</span>(
      <span class="pl-k">new</span> <span class="pl-st">HashMap&lt;<span class="pl-stj">Movie</span>,<span class="pl-stj">Integer</span>&gt;</span>()) {
        <span class="pl-s">public</span> <span class="pl-st">void</span> <span class="pl-en">remove</span>(<span class="pl-stj">Movie</span> <span class="pl-v">movie</span>) {
          removeCalled[<span class="pl-c1">0</span>] <span class="pl-k">=</span> <span class="pl-c1">true</span>;
        }
      };
    rental<span class="pl-k">.</span>start(store);
    assertFalse(removeCalled[<span class="pl-c1">0</span>]);
  }
}</pre></div>

<h3>
<a id="strict-mocking" class="anchor" href="#strict-mocking" aria-hidden="true"><span class="octicon octicon-link"></span></a>Strict Mocking</h3>

<div class="highlight highlight-java"><pre><span class="pl-s">public</span> <span class="pl-s">class</span> <span class="pl-en">RentalTest</span> {
  <span class="pl-st">@Test</span>
  <span class="pl-s">public</span> <span class="pl-st">void</span> <span class="pl-en">verifyStoreInteractions</span>() {
    <span class="pl-stj">Movie</span> movie <span class="pl-k">=</span> mock(<span class="pl-stj">Movie</span><span class="pl-k">.</span>class);
    <span class="pl-stj">Rental</span> rental <span class="pl-k">=</span>
      a<span class="pl-k">.</span>rental<span class="pl-k">.</span>w(movie)<span class="pl-k">.</span>build();
    <span class="pl-stj">Store</span> store <span class="pl-k">=</span> mock(<span class="pl-stj">Store</span><span class="pl-k">.</span>class);
    rental<span class="pl-k">.</span>start(store);
    verify(store)<span class="pl-k">.</span>getAvailability(movie);
    verifyNoMoreInteractions(store);
  }
}</pre></div>

<h3>
<a id="just-be-sociable" class="anchor" href="#just-be-sociable" aria-hidden="true"><span class="octicon octicon-link"></span></a>Just Be Sociable</h3>

<div class="highlight highlight-java"><pre><span class="pl-s">public</span> <span class="pl-s">class</span> <span class="pl-en">RentalTest</span> {
  <span class="pl-st">@Test</span>
  <span class="pl-s">public</span> <span class="pl-st">void</span>
  <span class="pl-en">storeAvailabilityIsModifiedOnRental</span>() {
    <span class="pl-stj">Movie</span> movie <span class="pl-k">=</span> a<span class="pl-k">.</span>movie<span class="pl-k">.</span>build();
    <span class="pl-stj">Rental</span> rental <span class="pl-k">=</span>
      a<span class="pl-k">.</span>rental<span class="pl-k">.</span>w(movie)<span class="pl-k">.</span>build();
    <span class="pl-stj">Store</span> store <span class="pl-k">=</span>
      a<span class="pl-k">.</span>store<span class="pl-k">.</span>w(movie, movie)<span class="pl-k">.</span>build();
    rental<span class="pl-k">.</span>start(store);
    a<span class="pl-k">.</span>rental<span class="pl-k">.</span>build()<span class="pl-k">.</span>start(store);
    assertEquals(
      <span class="pl-c1">1</span>, store<span class="pl-k">.</span>getAvailability(movie));
  }


  <span class="pl-st">@Test</span>
  <span class="pl-s">public</span> <span class="pl-st">void</span>
  <span class="pl-en">storeAvailabilityIsUnmodified</span>() {
    <span class="pl-stj">Movie</span> movie <span class="pl-k">=</span> a<span class="pl-k">.</span>movie<span class="pl-k">.</span>build();
    <span class="pl-stj">Rental</span> rental <span class="pl-k">=</span>
      a<span class="pl-k">.</span>rental<span class="pl-k">.</span>w(movie)<span class="pl-k">.</span>build();
    <span class="pl-stj">Store</span> store <span class="pl-k">=</span> a<span class="pl-k">.</span>store<span class="pl-k">.</span>build();
    rental<span class="pl-k">.</span>start(store);
    assertEquals(
      <span class="pl-c1">0</span>, store<span class="pl-k">.</span>getAvailability(movie));
  }

}</pre></div>

<h2>
<a id="hamcrest" class="anchor" href="#hamcrest" aria-hidden="true"><span class="octicon octicon-link"></span></a>Hamcrest</h2>

<h1>
<a id="improving-test-cases" class="anchor" href="#improving-test-cases" aria-hidden="true"><span class="octicon octicon-link"></span></a>Improving Test Cases</h1>

<h2>
<a id="too-much-magic" class="anchor" href="#too-much-magic" aria-hidden="true"><span class="octicon octicon-link"></span></a>Too Much Magic</h2>

<h3>
<a id="self-shunt" class="anchor" href="#self-shunt" aria-hidden="true"><span class="octicon octicon-link"></span></a>Self-shunt</h3>

<div class="highlight highlight-java"><pre><span class="pl-s">public</span> <span class="pl-s">class</span> <span class="pl-en">RentalTest</span> <span class="pl-s">extends</span> <span class="pl-e">Store</span> {
  <span class="pl-s">public</span> <span class="pl-s">static</span> <span class="pl-stj">Movie</span> movie <span class="pl-k">=</span>
    mock(<span class="pl-stj">Movie</span><span class="pl-k">.</span>class);
  <span class="pl-s">private</span> <span class="pl-st">boolean</span> removeCalled;

  <span class="pl-s">public</span> <span class="pl-en">RentalTest</span>() {
    <span class="pl-v">super</span>(<span class="pl-k">new</span> <span class="pl-st">HashMap&lt;<span class="pl-stj">Movie</span>, <span class="pl-stj">Integer</span>&gt;</span>() {{
          <span class="pl-v">this</span><span class="pl-k">.</span>put(movie, <span class="pl-c1">2</span>);
        }});
  }

  <span class="pl-st">@Test</span>
  <span class="pl-s">public</span> <span class="pl-st">void</span> <span class="pl-en">removeIsCalled</span>() {
    <span class="pl-stj">Rental</span> rental <span class="pl-k">=</span>
      a<span class="pl-k">.</span>rental<span class="pl-k">.</span>w(movie)<span class="pl-k">.</span>build();
    rental<span class="pl-k">.</span>start(<span class="pl-v">this</span>);
    assertEquals(<span class="pl-c1">true</span>, removeCalled);
  }

  <span class="pl-s">public</span> <span class="pl-st">void</span> <span class="pl-en">remove</span>(<span class="pl-stj">Movie</span> <span class="pl-v">movie</span>) {
    <span class="pl-v">super</span><span class="pl-k">.</span>remove(movie);
    removeCalled <span class="pl-k">=</span> <span class="pl-c1">true</span>;
  }
}</pre></div>

<h3>
<a id="exceptional-success" class="anchor" href="#exceptional-success" aria-hidden="true"><span class="octicon octicon-link"></span></a>Exceptional Success</h3>

<div class="highlight highlight-java"><pre><span class="pl-s">public</span> <span class="pl-s">class</span> <span class="pl-en">RentalTest</span> {
  <span class="pl-st">@Test</span>(<span class="pl-c1">expected</span><span class="pl-k">=</span><span class="pl-stj">RuntimeException</span><span class="pl-k">.</span>class)
  <span class="pl-s">public</span> <span class="pl-st">void</span> <span class="pl-en">removeIsCalled</span>() {
    <span class="pl-s">final</span> <span class="pl-stj">Movie</span> movie <span class="pl-k">=</span> mock(<span class="pl-stj">Movie</span><span class="pl-k">.</span>class);
    <span class="pl-stj">Rental</span> rental <span class="pl-k">=</span>
      a<span class="pl-k">.</span>rental<span class="pl-k">.</span>w(movie)<span class="pl-k">.</span>build();
    <span class="pl-st">HashMap&lt;<span class="pl-stj">Movie</span>, <span class="pl-stj">Integer</span>&gt;</span> movieMap <span class="pl-k">=</span>
      <span class="pl-k">new</span> <span class="pl-st">HashMap&lt;<span class="pl-stj">Movie</span>, <span class="pl-stj">Integer</span>&gt;</span>() {{
        <span class="pl-v">this</span><span class="pl-k">.</span>put(movie, <span class="pl-c1">2</span>);
      }};
    <span class="pl-stj">Store</span> store <span class="pl-k">=</span>
      <span class="pl-k">new</span> <span class="pl-stj">Store</span>(movieMap) {
        <span class="pl-s">public</span> <span class="pl-st">void</span> <span class="pl-en">remove</span>(<span class="pl-stj">Movie</span> <span class="pl-v">movie</span>) {
          <span class="pl-k">throw</span> <span class="pl-k">new</span>
            <span class="pl-stj">RuntimeException</span>(<span class="pl-s1"><span class="pl-pds">"</span>success<span class="pl-pds">"</span></span>);
        }
      };
    rental<span class="pl-k">.</span>start(store);
  }
}</pre></div>

<h2>
<a id="inline-setup-1" class="anchor" href="#inline-setup-1" aria-hidden="true"><span class="octicon octicon-link"></span></a>Inline Setup</h2>

<div class="highlight highlight-java"><pre><span class="pl-s">public</span> <span class="pl-s">class</span> <span class="pl-en">CustomerTest</span> {
  <span class="pl-stj">Rental</span> godfatherRental;
  <span class="pl-stj">Rental</span> lionKingRental;
  <span class="pl-stj">Rental</span> scarfaceRental;
  <span class="pl-stj">Rental</span> notebookRental;
  <span class="pl-stj">Customer</span> twoRentals;
  <span class="pl-stj">Customer</span> fourRentals;


  <span class="pl-st">@Before</span>
  <span class="pl-s">public</span> <span class="pl-st">void</span> <span class="pl-en">init</span>() {
    godfatherRental <span class="pl-k">=</span> mock(<span class="pl-stj">Rental</span><span class="pl-k">.</span>class);
    when(godfatherRental<span class="pl-k">.</span>getTitle())
      .thenReturn(<span class="pl-s1"><span class="pl-pds">"</span>Godfather 4<span class="pl-pds">"</span></span>);
    when(godfatherRental<span class="pl-k">.</span>getCharge())
      .thenReturn(<span class="pl-c1">3.0</span>);
    when(godfatherRental<span class="pl-k">.</span>getPoints())
      .thenReturn(<span class="pl-c1">2</span>);
    lionKingRental <span class="pl-k">=</span> mock(<span class="pl-stj">Rental</span><span class="pl-k">.</span>class);
    when(lionKingRental<span class="pl-k">.</span>getTitle())
      .thenReturn(<span class="pl-s1"><span class="pl-pds">"</span>Lion King<span class="pl-pds">"</span></span>);
    when(lionKingRental<span class="pl-k">.</span>getCharge())
      .thenReturn(<span class="pl-c1">2.0</span>);
    when(lionKingRental<span class="pl-k">.</span>getPoints())
      .thenReturn(<span class="pl-c1">1</span>);
    scarfaceRental <span class="pl-k">=</span> mock(<span class="pl-stj">Rental</span><span class="pl-k">.</span>class);
    when(scarfaceRental<span class="pl-k">.</span>getTitle())
      .thenReturn(<span class="pl-s1"><span class="pl-pds">"</span>Scarface<span class="pl-pds">"</span></span>);
    when(scarfaceRental<span class="pl-k">.</span>getCharge())
      .thenReturn(<span class="pl-c1">1.0</span>);
    when(scarfaceRental<span class="pl-k">.</span>getPoints())
      .thenReturn(<span class="pl-c1">1</span>);
    notebookRental <span class="pl-k">=</span> mock(<span class="pl-stj">Rental</span><span class="pl-k">.</span>class);
    when(notebookRental<span class="pl-k">.</span>getTitle())
      .thenReturn(<span class="pl-s1"><span class="pl-pds">"</span>Notebook<span class="pl-pds">"</span></span>);
    when(notebookRental<span class="pl-k">.</span>getCharge())
      .thenReturn(<span class="pl-c1">6.0</span>);
    when(notebookRental<span class="pl-k">.</span>getPoints())
      .thenReturn(<span class="pl-c1">1</span>);

    twoRentals <span class="pl-k">=</span>
      a<span class="pl-k">.</span>customer<span class="pl-k">.</span>w(
        godfatherRental, lionKingRental)
      .build();

    fourRentals <span class="pl-k">=</span>
      a<span class="pl-k">.</span>customer<span class="pl-k">.</span>w(
        godfatherRental, lionKingRental,
        scarfaceRental, notebookRental)
      .build();
  }</pre></div>

<div class="highlight highlight-java"><pre>

  @<span class="pl-stj">Test</span>
  <span class="pl-s">public</span> <span class="pl-st">void</span> recentRentalsWith2Rentals() {
    assertEquals(
      <span class="pl-s1"><span class="pl-pds">"</span>Recent rentals:<span class="pl-pds">"</span></span><span class="pl-k">+</span>
      <span class="pl-s1"><span class="pl-pds">"</span><span class="pl-cce">\n</span>Godfather 4<span class="pl-cce">\n</span>Lion King<span class="pl-pds">"</span></span>,
      twoRentals<span class="pl-k">.</span>recentRentals());
  }

  @<span class="pl-stj">Test</span>
  <span class="pl-s">public</span> <span class="pl-st">void</span> recentRentalsWith4Rentals() {
    assertEquals(
      <span class="pl-s1"><span class="pl-pds">"</span>Recent rentals:<span class="pl-pds">"</span></span><span class="pl-k">+</span>
      <span class="pl-s1"><span class="pl-pds">"</span><span class="pl-cce">\n</span>Godfather 4<span class="pl-cce">\n</span>Lion King<span class="pl-cce">\n</span>Scarface<span class="pl-pds">"</span></span>,
      fourRentals<span class="pl-k">.</span>recentRentals());
  }


  @<span class="pl-stj">Test</span>
  <span class="pl-s">public</span> <span class="pl-st">void</span> totalChargeWith2Rentals() {
    assertEquals(
      <span class="pl-c1">5.0</span>,
      twoRentals<span class="pl-k">.</span>getTotalCharge(),
      <span class="pl-c1">0</span>);
  }


  @<span class="pl-stj">Test</span>
  <span class="pl-s">public</span> <span class="pl-st">void</span> totalChargeWith4Rentals() {
    assertEquals(
      <span class="pl-c1">12.0</span>,
      fourRentals<span class="pl-k">.</span>getTotalCharge(),
      <span class="pl-c1">0</span>);
  }</pre></div>

<div class="highlight highlight-java"><pre>  @<span class="pl-stj">Test</span>
  <span class="pl-s">public</span> <span class="pl-st">void</span> totalPointsWith2Rentals() {
    assertEquals(
      <span class="pl-c1">3</span>,
      twoRentals<span class="pl-k">.</span>getTotalPoints());
  }

  @<span class="pl-stj">Test</span>
  <span class="pl-s">public</span> <span class="pl-st">void</span> totalPointsWith4Rentals() {
    assertEquals(
      <span class="pl-c1">5</span>,
      fourRentals<span class="pl-k">.</span>getTotalPoints());
  }


  @<span class="pl-stj">Test</span>
  <span class="pl-s">public</span> <span class="pl-st">void</span> getName() {
    assertEquals(
      <span class="pl-s1"><span class="pl-pds">"</span>Jim<span class="pl-pds">"</span></span>, twoRentals<span class="pl-k">.</span>getName());
  }

}</pre></div>

<h3>
<a id="similar-creation-and-action" class="anchor" href="#similar-creation-and-action" aria-hidden="true"><span class="octicon octicon-link"></span></a>Similar Creation and Action</h3>

<h3>
<a id="obviousness" class="anchor" href="#obviousness" aria-hidden="true"><span class="octicon octicon-link"></span></a>Obviousness</h3>

<h3>
<a id="setup-as-an-optimization" class="anchor" href="#setup-as-an-optimization" aria-hidden="true"><span class="octicon octicon-link"></span></a>Setup As An Optimization</h3>

<h3>
<a id="comparison-3" class="anchor" href="#comparison-3" aria-hidden="true"><span class="octicon octicon-link"></span></a>Comparison</h3>

<div class="highlight highlight-java"><pre><span class="pl-s">public</span> <span class="pl-s">class</span> <span class="pl-en">CustomerTest</span> {
  <span class="pl-stj">Rental</span> godfatherRental;
  <span class="pl-stj">Rental</span> lionKingRental;
  <span class="pl-stj">Rental</span> scarfaceRental;
  <span class="pl-stj">Rental</span> notebookRental;
  <span class="pl-stj">Customer</span> twoRentals;
  <span class="pl-stj">Customer</span> fourRentals;


  <span class="pl-st">@Before</span>
  <span class="pl-s">public</span> <span class="pl-st">void</span> <span class="pl-en">init</span>() {
    godfatherRental <span class="pl-k">=</span> mock(<span class="pl-stj">Rental</span><span class="pl-k">.</span>class);
    when(godfatherRental<span class="pl-k">.</span>getTitle())
      .thenReturn(<span class="pl-s1"><span class="pl-pds">"</span>Godfather 4<span class="pl-pds">"</span></span>);
    when(godfatherRental<span class="pl-k">.</span>getCharge())
      .thenReturn(<span class="pl-c1">3.0</span>);
    when(godfatherRental<span class="pl-k">.</span>getPoints())
      .thenReturn(<span class="pl-c1">2</span>);
    lionKingRental <span class="pl-k">=</span> mock(<span class="pl-stj">Rental</span><span class="pl-k">.</span>class);
    when(lionKingRental<span class="pl-k">.</span>getTitle())
      .thenReturn(<span class="pl-s1"><span class="pl-pds">"</span>Lion King<span class="pl-pds">"</span></span>);
    when(lionKingRental<span class="pl-k">.</span>getCharge())
      .thenReturn(<span class="pl-c1">2.0</span>);
    when(lionKingRental<span class="pl-k">.</span>getPoints())
      .thenReturn(<span class="pl-c1">1</span>);
    scarfaceRental <span class="pl-k">=</span> mock(<span class="pl-stj">Rental</span><span class="pl-k">.</span>class);
    when(scarfaceRental<span class="pl-k">.</span>getTitle())
      .thenReturn(<span class="pl-s1"><span class="pl-pds">"</span>Scarface<span class="pl-pds">"</span></span>);
    when(scarfaceRental<span class="pl-k">.</span>getCharge())
      .thenReturn(<span class="pl-c1">1.0</span>);
    when(scarfaceRental<span class="pl-k">.</span>getPoints())
      .thenReturn(<span class="pl-c1">1</span>);
    notebookRental <span class="pl-k">=</span> mock(<span class="pl-stj">Rental</span><span class="pl-k">.</span>class);
    when(notebookRental<span class="pl-k">.</span>getTitle())
      .thenReturn(<span class="pl-s1"><span class="pl-pds">"</span>Notebook<span class="pl-pds">"</span></span>);
    when(notebookRental<span class="pl-k">.</span>getCharge())
      .thenReturn(<span class="pl-c1">6.0</span>);
    when(notebookRental<span class="pl-k">.</span>getPoints())
      .thenReturn(<span class="pl-c1">1</span>);

    twoRentals <span class="pl-k">=</span>
      a<span class="pl-k">.</span>customer<span class="pl-k">.</span>w(
        godfatherRental, lionKingRental)
      .build();

    fourRentals <span class="pl-k">=</span>
      a<span class="pl-k">.</span>customer<span class="pl-k">.</span>w(
        godfatherRental, lionKingRental,
        scarfaceRental, notebookRental)
      .build();
  }</pre></div>

<div class="highlight highlight-java"><pre>

  @<span class="pl-stj">Test</span>
  <span class="pl-s">public</span> <span class="pl-st">void</span> recentRentalsWith2Rentals() {
    assertEquals(
      <span class="pl-s1"><span class="pl-pds">"</span>Recent rentals:<span class="pl-pds">"</span></span><span class="pl-k">+</span>
      <span class="pl-s1"><span class="pl-pds">"</span><span class="pl-cce">\n</span>Godfather 4<span class="pl-cce">\n</span>Lion King<span class="pl-pds">"</span></span>,
      twoRentals<span class="pl-k">.</span>recentRentals());
  }

  @<span class="pl-stj">Test</span>
  <span class="pl-s">public</span> <span class="pl-st">void</span> recentRentalsWith4Rentals() {
    assertEquals(
      <span class="pl-s1"><span class="pl-pds">"</span>Recent rentals:<span class="pl-pds">"</span></span><span class="pl-k">+</span>
      <span class="pl-s1"><span class="pl-pds">"</span><span class="pl-cce">\n</span>Godfather 4<span class="pl-cce">\n</span>Lion King<span class="pl-cce">\n</span>Scarface<span class="pl-pds">"</span></span>,
      fourRentals<span class="pl-k">.</span>recentRentals());
  }


  @<span class="pl-stj">Test</span>
  <span class="pl-s">public</span> <span class="pl-st">void</span> totalChargeWith2Rentals() {
    assertEquals(
      <span class="pl-c1">5.0</span>,
      twoRentals<span class="pl-k">.</span>getTotalCharge(),
      <span class="pl-c1">0</span>);
  }


  @<span class="pl-stj">Test</span>
  <span class="pl-s">public</span> <span class="pl-st">void</span> totalChargeWith4Rentals() {
    assertEquals(
      <span class="pl-c1">12.0</span>,
      fourRentals<span class="pl-k">.</span>getTotalCharge(),
      <span class="pl-c1">0</span>);
  }</pre></div>

<div class="highlight highlight-java"><pre>  @<span class="pl-stj">Test</span>
  <span class="pl-s">public</span> <span class="pl-st">void</span> totalPointsWith2Rentals() {
    assertEquals(
      <span class="pl-c1">3</span>,
      twoRentals<span class="pl-k">.</span>getTotalPoints());
  }

  @<span class="pl-stj">Test</span>
  <span class="pl-s">public</span> <span class="pl-st">void</span> totalPointsWith4Rentals() {
    assertEquals(
      <span class="pl-c1">5</span>,
      fourRentals<span class="pl-k">.</span>getTotalPoints());
  }


  @<span class="pl-stj">Test</span>
  <span class="pl-s">public</span> <span class="pl-st">void</span> getName() {
    assertEquals(
      <span class="pl-s1"><span class="pl-pds">"</span>Jim<span class="pl-pds">"</span></span>, twoRentals<span class="pl-k">.</span>getName());
  }

}</pre></div>

<div class="highlight highlight-java"><pre><span class="pl-s">public</span> <span class="pl-s">class</span> <span class="pl-en">CustomerTest</span> {
  <span class="pl-st">@Test</span>
  <span class="pl-s">public</span> <span class="pl-st">void</span> <span class="pl-en">recentRentalsWith2Rentals</span>() {
    <span class="pl-stj">Rental</span> godfatherRental <span class="pl-k">=</span>
      mock(<span class="pl-stj">Rental</span><span class="pl-k">.</span>class);
    when(godfatherRental<span class="pl-k">.</span>getTitle())
      .thenReturn(<span class="pl-s1"><span class="pl-pds">"</span>Godfather 4<span class="pl-pds">"</span></span>);
    <span class="pl-stj">Rental</span> lionKingRental <span class="pl-k">=</span>
      mock(<span class="pl-stj">Rental</span><span class="pl-k">.</span>class);
    when(lionKingRental<span class="pl-k">.</span>getTitle())
      .thenReturn(<span class="pl-s1"><span class="pl-pds">"</span>Lion King<span class="pl-pds">"</span></span>);
    assertEquals(
      <span class="pl-s1"><span class="pl-pds">"</span>Recent rentals:<span class="pl-pds">"</span></span><span class="pl-k">+</span>
      <span class="pl-s1"><span class="pl-pds">"</span><span class="pl-cce">\n</span>Godfather 4<span class="pl-cce">\n</span>Lion King<span class="pl-pds">"</span></span>,
      a<span class="pl-k">.</span>customer<span class="pl-k">.</span>w(
        godfatherRental, lionKingRental)
      .build()<span class="pl-k">.</span>recentRentals());
  }</pre></div>

<div class="highlight highlight-java"><pre>  @<span class="pl-stj">Test</span>
  <span class="pl-s">public</span> <span class="pl-st">void</span> recentRentalsWith4Rentals() {
    <span class="pl-stj">Rental</span> godfatherRental <span class="pl-k">=</span>
      mock(<span class="pl-stj">Rental</span><span class="pl-k">.</span>class);
    when(godfatherRental<span class="pl-k">.</span>getTitle())
      .thenReturn(<span class="pl-s1"><span class="pl-pds">"</span>Godfather 4<span class="pl-pds">"</span></span>);
    <span class="pl-stj">Rental</span> lionKingRental <span class="pl-k">=</span>
      mock(<span class="pl-stj">Rental</span><span class="pl-k">.</span>class);
    when(lionKingRental<span class="pl-k">.</span>getTitle())
      .thenReturn(<span class="pl-s1"><span class="pl-pds">"</span>Lion King<span class="pl-pds">"</span></span>);
    <span class="pl-stj">Rental</span> scarfaceRental <span class="pl-k">=</span>
      mock(<span class="pl-stj">Rental</span><span class="pl-k">.</span>class);
    when(scarfaceRental<span class="pl-k">.</span>getTitle())
      .thenReturn(<span class="pl-s1"><span class="pl-pds">"</span>Scarface<span class="pl-pds">"</span></span>);
    <span class="pl-stj">Rental</span> notebookRental <span class="pl-k">=</span>
      mock(<span class="pl-stj">Rental</span><span class="pl-k">.</span>class);
    when(notebookRental<span class="pl-k">.</span>getTitle())
      .thenReturn(<span class="pl-s1"><span class="pl-pds">"</span>Notebook<span class="pl-pds">"</span></span>);
    assertEquals(
      <span class="pl-s1"><span class="pl-pds">"</span>Recent rentals:<span class="pl-pds">"</span></span><span class="pl-k">+</span>
      <span class="pl-s1"><span class="pl-pds">"</span><span class="pl-cce">\n</span>Godfather 4<span class="pl-cce">\n</span>Lion King<span class="pl-cce">\n</span>Scarface<span class="pl-pds">"</span></span>,
      a<span class="pl-k">.</span>customer<span class="pl-k">.</span>w(
        godfatherRental, lionKingRental,
        scarfaceRental, notebookRental)
      .build()<span class="pl-k">.</span>recentRentals());
  }</pre></div>

<div class="highlight highlight-java"><pre>
  @<span class="pl-stj">Test</span>
  <span class="pl-s">public</span> <span class="pl-st">void</span> totalChargeWith2Rentals() {
    <span class="pl-stj">Rental</span> godfatherRental <span class="pl-k">=</span>
      mock(<span class="pl-stj">Rental</span><span class="pl-k">.</span>class);
    when(godfatherRental<span class="pl-k">.</span>getCharge())
      .thenReturn(<span class="pl-c1">3.0</span>);
    <span class="pl-stj">Rental</span> lionKingRental <span class="pl-k">=</span>
      mock(<span class="pl-stj">Rental</span><span class="pl-k">.</span>class);
    when(lionKingRental<span class="pl-k">.</span>getCharge())
      .thenReturn(<span class="pl-c1">2.0</span>);
    assertEquals(
      <span class="pl-c1">5.0</span>,
      a<span class="pl-k">.</span>customer<span class="pl-k">.</span>w(
        godfatherRental, lionKingRental)
      .build()<span class="pl-k">.</span>getTotalCharge(),
      <span class="pl-c1">0</span>);
  }</pre></div>

<div class="highlight highlight-java"><pre>

  @<span class="pl-stj">Test</span>
  <span class="pl-s">public</span> <span class="pl-st">void</span> totalChargeWith4Rentals() {
    <span class="pl-stj">Rental</span> godfatherRental <span class="pl-k">=</span>
      mock(<span class="pl-stj">Rental</span><span class="pl-k">.</span>class);
    when(godfatherRental<span class="pl-k">.</span>getCharge())
      .thenReturn(<span class="pl-c1">3.0</span>);
    <span class="pl-stj">Rental</span> lionKingRental <span class="pl-k">=</span>
      mock(<span class="pl-stj">Rental</span><span class="pl-k">.</span>class);
    when(lionKingRental<span class="pl-k">.</span>getCharge())
      .thenReturn(<span class="pl-c1">2.0</span>);
    <span class="pl-stj">Rental</span> scarfaceRental <span class="pl-k">=</span>
      mock(<span class="pl-stj">Rental</span><span class="pl-k">.</span>class);
    when(scarfaceRental<span class="pl-k">.</span>getCharge())
      .thenReturn(<span class="pl-c1">1.0</span>);
    <span class="pl-stj">Rental</span> notebookRental <span class="pl-k">=</span>
      mock(<span class="pl-stj">Rental</span><span class="pl-k">.</span>class);
    when(notebookRental<span class="pl-k">.</span>getCharge())
      .thenReturn(<span class="pl-c1">6.0</span>);
    assertEquals(
      <span class="pl-c1">12.0</span>,
      a<span class="pl-k">.</span>customer<span class="pl-k">.</span>w(
        godfatherRental, lionKingRental,
        scarfaceRental, notebookRental)
      .build()<span class="pl-k">.</span>getTotalCharge(),
      <span class="pl-c1">0</span>);
  }</pre></div>

<div class="highlight highlight-java"><pre>  @<span class="pl-stj">Test</span>
  <span class="pl-s">public</span> <span class="pl-st">void</span> totalPointsWith2Rentals() {
    <span class="pl-stj">Rental</span> godfatherRental <span class="pl-k">=</span>
      mock(<span class="pl-stj">Rental</span><span class="pl-k">.</span>class);
    when(godfatherRental<span class="pl-k">.</span>getPoints())
      .thenReturn(<span class="pl-c1">2</span>);
    <span class="pl-stj">Rental</span> lionKingRental <span class="pl-k">=</span>
      mock(<span class="pl-stj">Rental</span><span class="pl-k">.</span>class);
    when(lionKingRental<span class="pl-k">.</span>getPoints())
      .thenReturn(<span class="pl-c1">1</span>);
    assertEquals(
      <span class="pl-c1">3</span>,
      a<span class="pl-k">.</span>customer<span class="pl-k">.</span>w(
        godfatherRental, lionKingRental)
      .build()<span class="pl-k">.</span>getTotalPoints());
  }</pre></div>

<div class="highlight highlight-java"><pre>  @<span class="pl-stj">Test</span>
  <span class="pl-s">public</span> <span class="pl-st">void</span> totalPointsWith4Rentals() {
    <span class="pl-stj">Rental</span> godfatherRental <span class="pl-k">=</span>
      mock(<span class="pl-stj">Rental</span><span class="pl-k">.</span>class);
    when(godfatherRental<span class="pl-k">.</span>getPoints())
      .thenReturn(<span class="pl-c1">2</span>);
    <span class="pl-stj">Rental</span> lionKingRental <span class="pl-k">=</span>
      mock(<span class="pl-stj">Rental</span><span class="pl-k">.</span>class);
    when(lionKingRental<span class="pl-k">.</span>getPoints())
      .thenReturn(<span class="pl-c1">1</span>);
    <span class="pl-stj">Rental</span> scarfaceRental <span class="pl-k">=</span>
      mock(<span class="pl-stj">Rental</span><span class="pl-k">.</span>class);
    when(scarfaceRental<span class="pl-k">.</span>getPoints())
      .thenReturn(<span class="pl-c1">1</span>);
    <span class="pl-stj">Rental</span> notebookRental <span class="pl-k">=</span>
      mock(<span class="pl-stj">Rental</span><span class="pl-k">.</span>class);
    when(notebookRental<span class="pl-k">.</span>getPoints())
      .thenReturn(<span class="pl-c1">1</span>);
    assertEquals(
      <span class="pl-c1">5</span>,
      a<span class="pl-k">.</span>customer<span class="pl-k">.</span>w(
        godfatherRental, lionKingRental,
        scarfaceRental, notebookRental)
      .build()<span class="pl-k">.</span>getTotalPoints());
  }</pre></div>

<div class="highlight highlight-java"><pre>
  @<span class="pl-stj">Test</span>
  <span class="pl-s">public</span> <span class="pl-st">void</span> getName() {
    assertEquals(
      <span class="pl-s1"><span class="pl-pds">"</span>Jim<span class="pl-pds">"</span></span>,
      a<span class="pl-k">.</span>customer<span class="pl-k">.</span>build()<span class="pl-k">.</span>getName());
  }

}</pre></div>

<h2>
<a id="test-names" class="anchor" href="#test-names" aria-hidden="true"><span class="octicon octicon-link"></span></a>Test Names</h2>

<h1>
<a id="improving-test-suites" class="anchor" href="#improving-test-suites" aria-hidden="true"><span class="octicon octicon-link"></span></a>Improving Test Suites</h1>

<h2>
<a id="separating-the-solitary-from-the-sociable" class="anchor" href="#separating-the-solitary-from-the-sociable" aria-hidden="true"><span class="octicon octicon-link"></span></a>Separating The Solitary From The Sociable</h2>

<h3>
<a id="increasing-consistency-and-speed-with-solitary-unit-tests" class="anchor" href="#increasing-consistency-and-speed-with-solitary-unit-tests" aria-hidden="true"><span class="octicon octicon-link"></span></a>Increasing Consistency And Speed With Solitary Unit Tests</h3>

<h4>
<a id="database-and-filesystem-interaction" class="anchor" href="#database-and-filesystem-interaction" aria-hidden="true"><span class="octicon octicon-link"></span></a>Database and Filesystem Interaction</h4>

<div class="highlight highlight-java"><pre><span class="pl-s">public</span> <span class="pl-s">class</span> <span class="pl-en">PidWriter</span> {
  <span class="pl-s">public</span> <span class="pl-s">static</span> <span class="pl-st">void</span> <span class="pl-en">writePid</span>(
    <span class="pl-stj">String</span> <span class="pl-v">filename</span>,
    <span class="pl-stj">RuntimeMXBean</span> <span class="pl-v">bean</span>) {
    <span class="pl-k">try</span> {
      writePidtoFile(filename, bean);
    } <span class="pl-k">catch</span> (<span class="pl-stj">IOException</span> e) {
      <span class="pl-k">throw</span> <span class="pl-k">new</span> <span class="pl-stj">RuntimeException</span>(e);
    }
  }

  <span class="pl-s">private</span> <span class="pl-s">static</span> <span class="pl-st">void</span> <span class="pl-en">writePidtoFile</span>(
    <span class="pl-stj">String</span> <span class="pl-v">filename</span>,
    <span class="pl-stj">RuntimeMXBean</span> <span class="pl-v">bean</span>) <span class="pl-s">throws</span> <span class="pl-stj">IOException</span> {
    <span class="pl-stj">FileWriter</span> writer <span class="pl-k">=</span>
      <span class="pl-k">new</span> <span class="pl-stj">FileWriter</span>(filename);
    <span class="pl-k">try</span> {
      <span class="pl-stj">String</span> runtimeName <span class="pl-k">=</span> bean<span class="pl-k">.</span>getName();
      writer<span class="pl-k">.</span>write(
        runtimeName<span class="pl-k">.</span>substring(
          <span class="pl-c1">0</span>, runtimeName<span class="pl-k">.</span>indexOf(<span class="pl-s1"><span class="pl-pds">'</span>@<span class="pl-pds">'</span></span>)));
    }
    <span class="pl-k">finally</span> {
      writer<span class="pl-k">.</span>close();
    }
  }
}</pre></div>

<div class="highlight highlight-java"><pre><span class="pl-s">public</span> <span class="pl-s">class</span> <span class="pl-en">PidWriterTest</span> {
  <span class="pl-st">@Test</span>
  <span class="pl-s">public</span> <span class="pl-st">void</span> <span class="pl-en">writePid</span>() <span class="pl-s">throws</span> <span class="pl-stj">Exception</span> {
    <span class="pl-stj">RuntimeMXBean</span> bean <span class="pl-k">=</span>
      mock(<span class="pl-stj">RuntimeMXBean</span><span class="pl-k">.</span>class);
    when(bean<span class="pl-k">.</span>getName())<span class="pl-k">.</span>thenReturn(<span class="pl-s1"><span class="pl-pds">"</span>12@X<span class="pl-pds">"</span></span>);
    <span class="pl-stj">PidWriter</span><span class="pl-k">.</span>writePid(
      <span class="pl-s1"><span class="pl-pds">"</span>/tmp/sample.pid<span class="pl-pds">"</span></span>, bean);
    assertEquals(
      <span class="pl-s1"><span class="pl-pds">"</span>12<span class="pl-pds">"</span></span>,
      <span class="pl-stj">Files</span><span class="pl-k">.</span>readAllLines(
        <span class="pl-stj">Paths</span><span class="pl-k">.</span>get(<span class="pl-s1"><span class="pl-pds">"</span>/tmp/sample.pid<span class="pl-pds">"</span></span>),
        <span class="pl-stj">Charset</span><span class="pl-k">.</span>defaultCharset())<span class="pl-k">.</span>get(<span class="pl-c1">0</span>));
  }
}</pre></div>

<h4>
<a id="the-solitary-unit-test" class="anchor" href="#the-solitary-unit-test" aria-hidden="true"><span class="octicon octicon-link"></span></a>The Solitary Unit Test</h4>

<div class="highlight highlight-java"><pre><span class="pl-s">public</span> <span class="pl-s">class</span> <span class="pl-en">FileWriterGateway</span>
  <span class="pl-s">extends</span> <span class="pl-e">FileWriter</span> {

  <span class="pl-s">public</span> <span class="pl-s">static</span> <span class="pl-st">boolean</span> disallowAccess <span class="pl-k">=</span>
    <span class="pl-c1">false</span>;

  <span class="pl-s">public</span> <span class="pl-en">FileWriterGateway</span>(
    <span class="pl-stj">String</span> <span class="pl-v">filename</span>) <span class="pl-s">throws</span> <span class="pl-stj">IOException</span> {
    <span class="pl-v">super</span>(filename);
    <span class="pl-k">if</span> (disallowAccess) {
      <span class="pl-k">throw</span> <span class="pl-k">new</span> <span class="pl-stj">RuntimeException</span>(
        <span class="pl-s1"><span class="pl-pds">"</span>access disallowed<span class="pl-pds">"</span></span>);
    }
  }
}</pre></div>

<div class="highlight highlight-java"><pre><span class="pl-s">public</span> <span class="pl-s">class</span> <span class="pl-en">PidWriter</span> {
  <span class="pl-s">public</span> <span class="pl-s">static</span> <span class="pl-st">void</span> <span class="pl-en">writePid</span>(
    <span class="pl-stj">String</span> <span class="pl-v">filename</span>,
    <span class="pl-stj">RuntimeMXBean</span> <span class="pl-v">bean</span>) {
    <span class="pl-k">try</span> {
      writePidtoFile(filename, bean);
    } <span class="pl-k">catch</span> (<span class="pl-stj">IOException</span> e) {
      <span class="pl-k">throw</span> <span class="pl-k">new</span> <span class="pl-stj">RuntimeException</span>(e);
    }
  }

  <span class="pl-s">private</span> <span class="pl-s">static</span> <span class="pl-st">void</span> <span class="pl-en">writePidtoFile</span>(
    <span class="pl-stj">String</span> <span class="pl-v">filename</span>,
    <span class="pl-stj">RuntimeMXBean</span> <span class="pl-v">bean</span>) <span class="pl-s">throws</span> <span class="pl-stj">IOException</span> {

    <span class="pl-stj">FileWriterGateway</span> writer <span class="pl-k">=</span>
      <span class="pl-k">new</span> <span class="pl-stj">FileWriterGateway</span>(filename);

    <span class="pl-k">try</span> {
      <span class="pl-stj">String</span> runtimeName <span class="pl-k">=</span> bean<span class="pl-k">.</span>getName();
      writer<span class="pl-k">.</span>write(
        runtimeName<span class="pl-k">.</span>substring(
          <span class="pl-c1">0</span>, runtimeName<span class="pl-k">.</span>indexOf(<span class="pl-s1"><span class="pl-pds">'</span>@<span class="pl-pds">'</span></span>)));
    }
    <span class="pl-k">finally</span> {
      writer<span class="pl-k">.</span>close();
    }
  }
}</pre></div>

<div class="highlight highlight-java"><pre><span class="pl-s">public</span> <span class="pl-s">class</span> <span class="pl-en">PidWriterTest</span> <span class="pl-s">extends</span> <span class="pl-e">Solitary</span> {

  <span class="pl-st">@Test</span>
  <span class="pl-s">public</span> <span class="pl-st">void</span> <span class="pl-en">writePid</span>() <span class="pl-s">throws</span> <span class="pl-stj">Exception</span> {
    <span class="pl-stj">RuntimeMXBean</span> bean <span class="pl-k">=</span>
      mock(<span class="pl-stj">RuntimeMXBean</span><span class="pl-k">.</span>class);
    when(bean<span class="pl-k">.</span>getName())<span class="pl-k">.</span>thenReturn(<span class="pl-s1"><span class="pl-pds">"</span>12@X<span class="pl-pds">"</span></span>);
    <span class="pl-stj">PidWriter</span><span class="pl-k">.</span>writePid(
      <span class="pl-s1"><span class="pl-pds">"</span>/tmp/sample.pid<span class="pl-pds">"</span></span>, bean);
    assertEquals(
      <span class="pl-s1"><span class="pl-pds">"</span>12<span class="pl-pds">"</span></span>,
      <span class="pl-stj">Files</span><span class="pl-k">.</span>readAllLines(
        <span class="pl-stj">Paths</span><span class="pl-k">.</span>get(<span class="pl-s1"><span class="pl-pds">"</span>/tmp/sample.pid<span class="pl-pds">"</span></span>),
        <span class="pl-stj">Charset</span><span class="pl-k">.</span>defaultCharset())<span class="pl-k">.</span>get(<span class="pl-c1">0</span>));
  }
}</pre></div>

<div class="highlight highlight-java"><pre><span class="pl-s">public</span> <span class="pl-s">class</span> <span class="pl-en">Solitary</span> {
  <span class="pl-st">@Before</span>
  <span class="pl-s">public</span> <span class="pl-st">void</span> <span class="pl-en">setup</span>() {
    <span class="pl-stj">FileWriterGateway</span><span class="pl-k">.</span>disallowAccess <span class="pl-k">=</span> <span class="pl-c1">true</span>;
  }
}</pre></div>

<div class="highlight highlight-java"><pre><span class="pl-s">public</span> <span class="pl-s">class</span> <span class="pl-en">PidWriterTest</span> <span class="pl-s">extends</span> <span class="pl-e">Solitary</span> {
  <span class="pl-st">@Test</span>
  <span class="pl-s">public</span> <span class="pl-st">void</span> <span class="pl-en">writePid</span>() <span class="pl-s">throws</span> <span class="pl-stj">Exception</span> {
    <span class="pl-stj">RuntimeMXBean</span> bean <span class="pl-k">=</span>
      mock(<span class="pl-stj">RuntimeMXBean</span><span class="pl-k">.</span>class);
    when(bean<span class="pl-k">.</span>getName())<span class="pl-k">.</span>thenReturn(<span class="pl-s1"><span class="pl-pds">"</span>12@X<span class="pl-pds">"</span></span>);
    <span class="pl-stj">FileWriterGateway</span> facade <span class="pl-k">=</span>
      mock(<span class="pl-stj">FileWriterGateway</span><span class="pl-k">.</span>class);
    <span class="pl-stj">PidWriter</span><span class="pl-k">.</span>writePid(facade, bean);
    verify(facade)<span class="pl-k">.</span>write(<span class="pl-s1"><span class="pl-pds">"</span>12<span class="pl-pds">"</span></span>);
  }
}</pre></div>

<div class="highlight highlight-java"><pre><span class="pl-s">public</span> <span class="pl-s">class</span> <span class="pl-en">PidWriter</span> {
  <span class="pl-s">public</span> <span class="pl-s">static</span> <span class="pl-st">void</span> <span class="pl-en">writePid</span>(
    <span class="pl-stj">String</span> <span class="pl-v">filename</span>,
    <span class="pl-stj">RuntimeMXBean</span> <span class="pl-v">bean</span>) {
    <span class="pl-k">try</span> {
      <span class="pl-stj">FileWriterGateway</span> writer <span class="pl-k">=</span>
        <span class="pl-k">new</span> <span class="pl-stj">FileWriterGateway</span>(filename);
      writePid(writer, bean);
    } <span class="pl-k">catch</span> (<span class="pl-stj">IOException</span> e) {
      <span class="pl-k">throw</span> <span class="pl-k">new</span> <span class="pl-stj">RuntimeException</span>(e);
    }
  }


  <span class="pl-s">public</span> <span class="pl-s">static</span> <span class="pl-st">void</span> <span class="pl-en">writePid</span>(
    <span class="pl-stj">FileWriterGateway</span> <span class="pl-v">facade</span>,
    <span class="pl-stj">RuntimeMXBean</span> <span class="pl-v">bean</span>) {
    <span class="pl-k">try</span> {
      writePidtoFile(facade, bean);
    } <span class="pl-k">catch</span> (<span class="pl-stj">IOException</span> e) {
      <span class="pl-k">throw</span> <span class="pl-k">new</span> <span class="pl-stj">RuntimeException</span>(e);
    }
  }</pre></div>

<div class="highlight highlight-java"><pre>

  <span class="pl-s">private</span> <span class="pl-s">static</span> <span class="pl-st">void</span> writePidtoFile(
    <span class="pl-stj">FileWriterGateway</span> facade,
    <span class="pl-stj">RuntimeMXBean</span> bean) throws <span class="pl-stj">IOException</span> {
    <span class="pl-k">try</span> {
      <span class="pl-stj">String</span> runtimeName <span class="pl-k">=</span> bean<span class="pl-k">.</span>getName();
      facade<span class="pl-k">.</span>write(
        runtimeName<span class="pl-k">.</span>substring(
          <span class="pl-c1">0</span>, runtimeName<span class="pl-k">.</span>indexOf(<span class="pl-s1"><span class="pl-pds">'</span>@<span class="pl-pds">'</span></span>)));
    } <span class="pl-k">catch</span> (<span class="pl-stj">IOException</span> e) {
      <span class="pl-k">throw</span> <span class="pl-k">new</span> <span class="pl-stj">RuntimeException</span>(e);
    }
    <span class="pl-k">finally</span> {
      facade<span class="pl-k">.</span>close();
    }
  }
}</pre></div>

<h4>
<a id="the-sociable-unit-test" class="anchor" href="#the-sociable-unit-test" aria-hidden="true"><span class="octicon octicon-link"></span></a>The Sociable Unit Test</h4>

<div class="highlight highlight-java"><pre><span class="pl-s">public</span> <span class="pl-s">class</span> <span class="pl-en">PidWriterTest</span> <span class="pl-s">extends</span> <span class="pl-e">Sociable</span> {

  <span class="pl-st">@Test</span>
  <span class="pl-s">public</span> <span class="pl-st">void</span> <span class="pl-en">writePid</span>() <span class="pl-s">throws</span> <span class="pl-stj">Exception</span> {
    <span class="pl-stj">RuntimeMXBean</span> bean <span class="pl-k">=</span>
      mock(<span class="pl-stj">RuntimeMXBean</span><span class="pl-k">.</span>class);
    when(bean<span class="pl-k">.</span>getName())<span class="pl-k">.</span>thenReturn(<span class="pl-s1"><span class="pl-pds">"</span>12@X<span class="pl-pds">"</span></span>);
    <span class="pl-stj">PidWriter</span><span class="pl-k">.</span>writePid(
      <span class="pl-s1"><span class="pl-pds">"</span>/tmp/wewut/sample.pid<span class="pl-pds">"</span></span>, bean);
    assertEquals(
      <span class="pl-s1"><span class="pl-pds">"</span>12<span class="pl-pds">"</span></span>,
      <span class="pl-stj">Files</span><span class="pl-k">.</span>readAllLines(
        <span class="pl-stj">Paths</span><span class="pl-k">.</span>get(<span class="pl-s1"><span class="pl-pds">"</span>/tmp/wewut/sample.pid<span class="pl-pds">"</span></span>),
        <span class="pl-stj">Charset</span><span class="pl-k">.</span>defaultCharset())<span class="pl-k">.</span>get(<span class="pl-c1">0</span>));
  }
}</pre></div>

<div class="highlight highlight-java"><pre><span class="pl-s">public</span> <span class="pl-s">class</span> <span class="pl-en">Sociable</span> {
  <span class="pl-st">@Before</span>
  <span class="pl-s">public</span> <span class="pl-st">void</span> <span class="pl-en">setup</span>()
    <span class="pl-s">throws</span> <span class="pl-stj">Exception</span> {
    <span class="pl-stj">Process</span> p;
    p <span class="pl-k">=</span> <span class="pl-stj">Runtime</span><span class="pl-k">.</span>getRuntime()<span class="pl-k">.</span>exec(
      <span class="pl-s1"><span class="pl-pds">"</span>rm -rf /tmp/wewut<span class="pl-pds">"</span></span>);
    p<span class="pl-k">.</span>waitFor();
    p <span class="pl-k">=</span> <span class="pl-stj">Runtime</span><span class="pl-k">.</span>getRuntime()<span class="pl-k">.</span>exec(
      <span class="pl-s1"><span class="pl-pds">"</span>mkdir -p /tmp/wewut<span class="pl-pds">"</span></span>);
    p<span class="pl-k">.</span>waitFor();
  }
}</pre></div>

<h4>
<a id="revisiting-concerns" class="anchor" href="#revisiting-concerns" aria-hidden="true"><span class="octicon octicon-link"></span></a>Revisiting Concerns</h4>

<h4>
<a id="time-interaction" class="anchor" href="#time-interaction" aria-hidden="true"><span class="octicon octicon-link"></span></a>Time Interaction</h4>

<div class="highlight highlight-java"><pre><span class="pl-s">public</span> <span class="pl-s">class</span> <span class="pl-en">Rental</span> {

  <span class="pl-stj">Movie</span> movie;
  <span class="pl-s">private</span> <span class="pl-st">int</span> daysRented;
  <span class="pl-s">private</span> <span class="pl-st">boolean</span> started;

  <span class="pl-s">private</span> <span class="pl-stj">DateTime</span> creationDateTime;


  <span class="pl-s">public</span> <span class="pl-en">Rental</span>(
    <span class="pl-stj">Movie</span> <span class="pl-v">movie</span>,
    <span class="pl-st">int</span> <span class="pl-v">daysRented</span>,

    <span class="pl-stj">DateTime</span> <span class="pl-v">creationDateTime</span>) {

    <span class="pl-v">this</span><span class="pl-k">.</span>movie <span class="pl-k">=</span> movie;
    <span class="pl-v">this</span><span class="pl-k">.</span>daysRented <span class="pl-k">=</span> daysRented;

    <span class="pl-v">this</span><span class="pl-k">.</span>creationDateTime <span class="pl-k">=</span> creationDateTime;

  }

  <span class="pl-s">public</span> <span class="pl-en">Rental</span>(<span class="pl-stj">Movie</span> <span class="pl-v">movie</span>, <span class="pl-st">int</span> <span class="pl-v">daysRented</span>) {

    <span class="pl-v">this</span>(movie, daysRented, <span class="pl-k">new</span> <span class="pl-stj">DateTime</span>());

  }


  <span class="pl-s">public</span> <span class="pl-stj">DateTime</span> <span class="pl-en">getCreationDateTime</span>() {
    <span class="pl-k">return</span> creationDateTime;
  }

}</pre></div>

<div class="highlight highlight-java"><pre><span class="pl-s">public</span> <span class="pl-s">class</span> <span class="pl-en">RentalTest</span> {
  <span class="pl-st">@Test</span>
  <span class="pl-s">public</span> <span class="pl-st">void</span> <span class="pl-en">creationDateTimeNow</span>() {
    <span class="pl-stj">DateTimeUtils</span><span class="pl-k">.</span>setCurrentMillisFixed(<span class="pl-c1">1000</span>);
    <span class="pl-stj">Rental</span> rental <span class="pl-k">=</span> a<span class="pl-k">.</span>rental<span class="pl-k">.</span>build();
    assertEquals(
      <span class="pl-c1">1000</span>,
      rental<span class="pl-k">.</span>getCreationDateTime()
      .getMillis());
  }

  <span class="pl-st">@Test</span>
  <span class="pl-s">public</span> <span class="pl-st">void</span> <span class="pl-en">creationDateTimeSet</span>() {
    <span class="pl-stj">Rental</span> rental <span class="pl-k">=</span>
      a<span class="pl-k">.</span>rental<span class="pl-k">.</span>w(
        <span class="pl-k">new</span> <span class="pl-stj">DateTime</span>(<span class="pl-c1">199</span>))<span class="pl-k">.</span>build();
    assertEquals(
      <span class="pl-c1">199</span>,
      rental<span class="pl-k">.</span>getCreationDateTime()
      .getMillis());
  }
}</pre></div>

<div class="highlight highlight-java"><pre><span class="pl-s">public</span> <span class="pl-s">class</span> <span class="pl-en">RentalTest</span> {
  <span class="pl-st">@Test</span>
  <span class="pl-s">public</span> <span class="pl-st">void</span> <span class="pl-en">creationDateTimeNow</span>() {
    <span class="pl-stj">DateTimeUtils</span><span class="pl-k">.</span>setCurrentMillisFixed(<span class="pl-c1">1000</span>);
    <span class="pl-stj">Rental</span> rental <span class="pl-k">=</span> a<span class="pl-k">.</span>rental<span class="pl-k">.</span>build();
    assertEquals(
      <span class="pl-c1">1000</span>,
      rental<span class="pl-k">.</span>getCreationDateTime()
      .getMillis());

    <span class="pl-stj">DateTimeUtils</span><span class="pl-k">.</span>setCurrentMillisSystem();

  }

  <span class="pl-st">@Test</span>
  <span class="pl-s">public</span> <span class="pl-st">void</span> <span class="pl-en">creationDateTimeSet</span>() {
    <span class="pl-stj">Rental</span> rental <span class="pl-k">=</span>
      a<span class="pl-k">.</span>rental<span class="pl-k">.</span>w(
        <span class="pl-k">new</span> <span class="pl-stj">DateTime</span>(<span class="pl-c1">199</span>))<span class="pl-k">.</span>build();
    assertEquals(
      <span class="pl-c1">199</span>,
      rental<span class="pl-k">.</span>getCreationDateTime()
      .getMillis());
  }
}</pre></div>

<div class="highlight highlight-java"><pre><span class="pl-s">public</span> <span class="pl-s">class</span> <span class="pl-en">Solitary</span> {
  <span class="pl-st">@Before</span>
  <span class="pl-s">public</span> <span class="pl-st">void</span> <span class="pl-en">setup</span>() {
    <span class="pl-stj">FileWriterGateway</span><span class="pl-k">.</span>disallowAccess <span class="pl-k">=</span> <span class="pl-c1">true</span>;
    <span class="pl-stj">DateTimeUtils</span><span class="pl-k">.</span>setCurrentMillisFixed(<span class="pl-c1">1000</span>);
  }
}</pre></div>

<div class="highlight highlight-java"><pre><span class="pl-s">public</span> <span class="pl-s">class</span> <span class="pl-en">RentalTest</span> <span class="pl-s">extends</span> <span class="pl-e">Solitary</span> {
  <span class="pl-st">@Test</span>
  <span class="pl-s">public</span> <span class="pl-st">void</span> <span class="pl-en">creationDateTimeNow</span>() {
    <span class="pl-stj">Rental</span> rental <span class="pl-k">=</span> a<span class="pl-k">.</span>rental<span class="pl-k">.</span>build();
    assertEquals(
      <span class="pl-c1">1000</span>,
      rental<span class="pl-k">.</span>getCreationDateTime()
      .getMillis());
  }

  <span class="pl-st">@Test</span>
  <span class="pl-s">public</span> <span class="pl-st">void</span> <span class="pl-en">creationDateTimeSet</span>() {
    <span class="pl-stj">Rental</span> rental <span class="pl-k">=</span>
      a<span class="pl-k">.</span>rental<span class="pl-k">.</span>w(
        <span class="pl-k">new</span> <span class="pl-stj">DateTime</span>(<span class="pl-c1">199</span>))<span class="pl-k">.</span>build();
    assertEquals(
      <span class="pl-c1">199</span>,
      rental<span class="pl-k">.</span>getCreationDateTime()
      .getMillis());
  }
}</pre></div>

<h4>
<a id="using-speed-to-your-advantage" class="anchor" href="#using-speed-to-your-advantage" aria-hidden="true"><span class="octicon octicon-link"></span></a>Using Speed To Your Advantage</h4>

<h3>
<a id="avoiding-cascading-failures-with-solitary-unit-tests" class="anchor" href="#avoiding-cascading-failures-with-solitary-unit-tests" aria-hidden="true"><span class="octicon octicon-link"></span></a>Avoiding Cascading Failures With Solitary Unit Tests</h3>

<div class="highlight highlight-java"><pre><span class="pl-s">public</span> <span class="pl-s">class</span> <span class="pl-en">CustomerTest</span> {
  <span class="pl-st">@Test</span>
  <span class="pl-s">public</span> <span class="pl-st">void</span> <span class="pl-en">noRentalsStatement</span>() {
    assertEquals(
      <span class="pl-s1"><span class="pl-pds">"</span>Rental record for Jim<span class="pl-cce">\n</span>Amount owed <span class="pl-pds">"</span></span> <span class="pl-k">+</span>
      <span class="pl-s1"><span class="pl-pds">"</span>is 0.0<span class="pl-cce">\n</span><span class="pl-pds">"</span></span> <span class="pl-k">+</span>
      <span class="pl-s1"><span class="pl-pds">"</span>You earned 0 frequent renter points<span class="pl-pds">"</span></span>,
      a<span class="pl-k">.</span>customer<span class="pl-k">.</span>build()<span class="pl-k">.</span>statement());
  }

  <span class="pl-st">@Test</span>
  <span class="pl-s">public</span> <span class="pl-st">void</span> <span class="pl-en">oneRentalStatement</span>() {
    assertEquals(
      <span class="pl-s1"><span class="pl-pds">"</span>Rental record for Jim<span class="pl-cce">\n</span><span class="pl-pds">"</span></span> <span class="pl-k">+</span>
      <span class="pl-s1"><span class="pl-pds">"</span><span class="pl-cce">\t</span>Godfather 4 9.0<span class="pl-cce">\n</span><span class="pl-pds">"</span></span> <span class="pl-k">+</span>
      <span class="pl-s1"><span class="pl-pds">"</span>Amount owed is 9.0<span class="pl-cce">\n</span><span class="pl-pds">"</span></span> <span class="pl-k">+</span>
      <span class="pl-s1"><span class="pl-pds">"</span>You earned 2 frequent renter points<span class="pl-pds">"</span></span>,
      a<span class="pl-k">.</span>customer<span class="pl-k">.</span>w(
        a<span class="pl-k">.</span>rental)<span class="pl-k">.</span>build()<span class="pl-k">.</span>statement());
  }</pre></div>

<div class="highlight highlight-java"><pre>  @<span class="pl-stj">Test</span>
  <span class="pl-s">public</span> <span class="pl-st">void</span> twoRentalsStatement() {
    assertEquals(
      <span class="pl-s1"><span class="pl-pds">"</span>Rental record for Jim<span class="pl-cce">\n</span><span class="pl-pds">"</span></span> <span class="pl-k">+</span>
      <span class="pl-s1"><span class="pl-pds">"</span><span class="pl-cce">\t</span>Godfather 4 9.0<span class="pl-cce">\n</span><span class="pl-pds">"</span></span> <span class="pl-k">+</span>
      <span class="pl-s1"><span class="pl-pds">"</span><span class="pl-cce">\t</span>Godfather 4 9.0<span class="pl-cce">\n</span><span class="pl-pds">"</span></span> <span class="pl-k">+</span>
      <span class="pl-s1"><span class="pl-pds">"</span>Amount owed is 18.0<span class="pl-cce">\n</span><span class="pl-pds">"</span></span> <span class="pl-k">+</span>
      <span class="pl-s1"><span class="pl-pds">"</span>You earned 4 frequent renter points<span class="pl-pds">"</span></span>,
      a<span class="pl-k">.</span>customer<span class="pl-k">.</span>w(
        a<span class="pl-k">.</span>rental, a<span class="pl-k">.</span>rental)<span class="pl-k">.</span>build()
      .statement());
  }

  @<span class="pl-stj">Test</span>
  <span class="pl-s">public</span> <span class="pl-st">void</span> noRentalsGetTotalPoints() {
    assertEquals(
      <span class="pl-c1">0</span>,
      a<span class="pl-k">.</span>customer<span class="pl-k">.</span>build()<span class="pl-k">.</span>getTotalPoints());
  }

  @<span class="pl-stj">Test</span>
  <span class="pl-s">public</span> <span class="pl-st">void</span> oneRentalGetTotalPoints() {
    assertEquals(
      <span class="pl-c1">2</span>,
      a<span class="pl-k">.</span>customer<span class="pl-k">.</span>w(
        a<span class="pl-k">.</span>rental)<span class="pl-k">.</span>build()<span class="pl-k">.</span>getTotalPoints());
  }</pre></div>

<div class="highlight highlight-java"><pre>  @<span class="pl-stj">Test</span>
  <span class="pl-s">public</span> <span class="pl-st">void</span> twoRentalsGetTotalPoints() {
    assertEquals(
      <span class="pl-c1">4</span>,
      a<span class="pl-k">.</span>customer<span class="pl-k">.</span>w(a<span class="pl-k">.</span>rental, a<span class="pl-k">.</span>rental)
      .build()
      .getTotalPoints());
  }

  <span class="pl-c">// 3 tests for htmlStatement()</span>
  <span class="pl-c">// left to the imagination</span>
}</pre></div>

<div class="highlight highlight-java"><pre><span class="pl-s">public</span> <span class="pl-s">class</span> <span class="pl-en">RentalTest</span> {
  <span class="pl-st">@Test</span>
  <span class="pl-s">public</span> <span class="pl-st">void</span> <span class="pl-en">getPointsFromMovie</span>() {
    assertEquals(
      <span class="pl-c1">2</span>, a<span class="pl-k">.</span>rental<span class="pl-k">.</span>build()<span class="pl-k">.</span>getPoints());
  }
}</pre></div>

<div class="highlight highlight-java"><pre><span class="pl-s">public</span> <span class="pl-s">class</span> <span class="pl-en">MovieTest</span> {
  <span class="pl-st">@Test</span>
  <span class="pl-s">public</span> <span class="pl-st">void</span> <span class="pl-en">getPoints</span>() {
    assertEquals(
      <span class="pl-c1">2</span>, a<span class="pl-k">.</span>movie<span class="pl-k">.</span>build()<span class="pl-k">.</span>getPoints(<span class="pl-c1">2</span>));
  }
}</pre></div>

<div class="highlight highlight-java"><pre><span class="pl-s">public</span> <span class="pl-s">class</span> <span class="pl-en">NewReleasePrice</span> <span class="pl-s">extends</span> <span class="pl-e">Price</span> {

  <span class="pl-st">@Override</span>
  <span class="pl-s">public</span> <span class="pl-st">double</span> <span class="pl-en">getCharge</span>(<span class="pl-st">int</span> <span class="pl-v">daysRented</span>) {
    <span class="pl-k">return</span> daysRented <span class="pl-k">*</span> <span class="pl-c1">3</span>;
  }

  <span class="pl-st">@Override</span>
  <span class="pl-s">public</span> <span class="pl-st">int</span> <span class="pl-en">getPoints</span>(<span class="pl-st">int</span> <span class="pl-v">daysRented</span>) {
    <span class="pl-k">if</span> (daysRented <span class="pl-k">&gt;</span> <span class="pl-c1">1</span>)

      <span class="pl-k">return</span> <span class="pl-c1">3</span>; <span class="pl-c">// was 2</span>

    <span class="pl-k">return</span> <span class="pl-c1">1</span>;
  }
}</pre></div>

<h4>
<a id="class-under-test" class="anchor" href="#class-under-test" aria-hidden="true"><span class="octicon octicon-link"></span></a>Class Under Test</h4>

<div class="highlight highlight-java"><pre><span class="pl-s">public</span> <span class="pl-s">class</span> <span class="pl-en">CustomerTest</span> {
  <span class="pl-st">@Test</span>
  <span class="pl-s">public</span> <span class="pl-st">void</span> <span class="pl-en">noRentalsStatement</span>() {
    assertEquals(
      <span class="pl-s1"><span class="pl-pds">"</span>Rental record for Jim<span class="pl-cce">\n</span>Amount owed <span class="pl-pds">"</span></span> <span class="pl-k">+</span>
      <span class="pl-s1"><span class="pl-pds">"</span>is 0.0<span class="pl-cce">\n</span><span class="pl-pds">"</span></span> <span class="pl-k">+</span>
      <span class="pl-s1"><span class="pl-pds">"</span>You earned 0 frequent renter points<span class="pl-pds">"</span></span>,
      a<span class="pl-k">.</span>customer<span class="pl-k">.</span>build()<span class="pl-k">.</span>statement());
  }

  <span class="pl-st">@Test</span>
  <span class="pl-s">public</span> <span class="pl-st">void</span> <span class="pl-en">oneRentalStatement</span>() {
    <span class="pl-stj">Rental</span> rental <span class="pl-k">=</span> mock(<span class="pl-stj">Rental</span><span class="pl-k">.</span>class);
    when(rental<span class="pl-k">.</span>getLineItem())
      .thenReturn(<span class="pl-s1"><span class="pl-pds">"</span>Godfather 4 9.0<span class="pl-pds">"</span></span>);
    when(rental<span class="pl-k">.</span>getCharge())
      .thenReturn(<span class="pl-c1">9.0</span>);
    when(rental<span class="pl-k">.</span>getPoints())
      .thenReturn(<span class="pl-c1">2</span>);
    assertEquals(
      <span class="pl-s1"><span class="pl-pds">"</span>Rental record for Jim<span class="pl-cce">\n</span><span class="pl-pds">"</span></span> <span class="pl-k">+</span>
      <span class="pl-s1"><span class="pl-pds">"</span><span class="pl-cce">\t</span>Godfather 4 9.0<span class="pl-cce">\n</span><span class="pl-pds">"</span></span> <span class="pl-k">+</span>
      <span class="pl-s1"><span class="pl-pds">"</span>Amount owed is 9.0<span class="pl-cce">\n</span><span class="pl-pds">"</span></span> <span class="pl-k">+</span>
      <span class="pl-s1"><span class="pl-pds">"</span>You earned 2 frequent renter points<span class="pl-pds">"</span></span>,
      a<span class="pl-k">.</span>customer<span class="pl-k">.</span>w(rental)<span class="pl-k">.</span>build()
      .statement());
  }</pre></div>

<div class="highlight highlight-java"><pre>  @<span class="pl-stj">Test</span>
  <span class="pl-s">public</span> <span class="pl-st">void</span> twoRentalsStatement() {
    <span class="pl-stj">Rental</span> one <span class="pl-k">=</span> mock(<span class="pl-stj">Rental</span><span class="pl-k">.</span>class);
    when(one<span class="pl-k">.</span>getLineItem())
      .thenReturn(<span class="pl-s1"><span class="pl-pds">"</span>Godfather 4 9.0<span class="pl-pds">"</span></span>);
    when(one<span class="pl-k">.</span>getCharge())
      .thenReturn(<span class="pl-c1">9.0</span>);
    when(one<span class="pl-k">.</span>getPoints())
      .thenReturn(<span class="pl-c1">2</span>);
    <span class="pl-stj">Rental</span> two <span class="pl-k">=</span> mock(<span class="pl-stj">Rental</span><span class="pl-k">.</span>class);
    when(two<span class="pl-k">.</span>getLineItem())
      .thenReturn(<span class="pl-s1"><span class="pl-pds">"</span>Godfather 4 9.0<span class="pl-pds">"</span></span>);
    when(two<span class="pl-k">.</span>getCharge())
      .thenReturn(<span class="pl-c1">9.0</span>);
    when(two<span class="pl-k">.</span>getPoints())
      .thenReturn(<span class="pl-c1">2</span>);
    assertEquals(
      <span class="pl-s1"><span class="pl-pds">"</span>Rental record for Jim<span class="pl-cce">\n</span><span class="pl-pds">"</span></span> <span class="pl-k">+</span>
      <span class="pl-s1"><span class="pl-pds">"</span><span class="pl-cce">\t</span>Godfather 4 9.0<span class="pl-cce">\n</span><span class="pl-pds">"</span></span> <span class="pl-k">+</span>
      <span class="pl-s1"><span class="pl-pds">"</span><span class="pl-cce">\t</span>Godfather 4 9.0<span class="pl-cce">\n</span><span class="pl-pds">"</span></span> <span class="pl-k">+</span>
      <span class="pl-s1"><span class="pl-pds">"</span>Amount owed is 18.0<span class="pl-cce">\n</span><span class="pl-pds">"</span></span> <span class="pl-k">+</span>
      <span class="pl-s1"><span class="pl-pds">"</span>You earned 4 frequent renter points<span class="pl-pds">"</span></span>,
      a<span class="pl-k">.</span>customer<span class="pl-k">.</span>w(one, two)<span class="pl-k">.</span>build()
      .statement());
  }

  @<span class="pl-stj">Test</span>
  <span class="pl-s">public</span> <span class="pl-st">void</span> noRentalsGetTotalPoints() {
    assertEquals(
      <span class="pl-c1">0</span>,
      a<span class="pl-k">.</span>customer<span class="pl-k">.</span>build()<span class="pl-k">.</span>getTotalPoints());
  }</pre></div>

<div class="highlight highlight-java"><pre>  @<span class="pl-stj">Test</span>
  <span class="pl-s">public</span> <span class="pl-st">void</span> oneRentalGetTotalPoints() {
    <span class="pl-stj">Rental</span> rental <span class="pl-k">=</span> mock(<span class="pl-stj">Rental</span><span class="pl-k">.</span>class);
    when(rental<span class="pl-k">.</span>getPoints())
      .thenReturn(<span class="pl-c1">2</span>);
    assertEquals(
      <span class="pl-c1">2</span>,
      a<span class="pl-k">.</span>customer<span class="pl-k">.</span>w(
        rental)<span class="pl-k">.</span>build()<span class="pl-k">.</span>getTotalPoints());
  }

  @<span class="pl-stj">Test</span>
  <span class="pl-s">public</span> <span class="pl-st">void</span> twoRentalsGetTotalPoints() {
    <span class="pl-stj">Rental</span> one <span class="pl-k">=</span> mock(<span class="pl-stj">Rental</span><span class="pl-k">.</span>class);
    when(one<span class="pl-k">.</span>getPoints())
      .thenReturn(<span class="pl-c1">2</span>);
    <span class="pl-stj">Rental</span> two <span class="pl-k">=</span> mock(<span class="pl-stj">Rental</span><span class="pl-k">.</span>class);
    when(two<span class="pl-k">.</span>getPoints())
      .thenReturn(<span class="pl-c1">3</span>);
    assertEquals(
      <span class="pl-c1">5</span>,
      a<span class="pl-k">.</span>customer<span class="pl-k">.</span>w(
        one, two)<span class="pl-k">.</span>build()<span class="pl-k">.</span>getTotalPoints());
  }
}</pre></div>

<div class="highlight highlight-java"><pre><span class="pl-s">public</span> <span class="pl-s">class</span> <span class="pl-en">RentalTest</span> {
  <span class="pl-st">@Test</span>
  <span class="pl-s">public</span> <span class="pl-st">void</span> <span class="pl-en">getPointsFromMovie</span>() {
    <span class="pl-stj">Movie</span> movie <span class="pl-k">=</span> mock(<span class="pl-stj">Movie</span><span class="pl-k">.</span>class);
    when(movie<span class="pl-k">.</span>getPoints(<span class="pl-c1">2</span>))
      .thenReturn(<span class="pl-c1">2</span>);
    assertEquals(
      <span class="pl-c1">2</span>,
      a<span class="pl-k">.</span>rental<span class="pl-k">.</span>w(
        <span class="pl-c1">2</span>)<span class="pl-k">.</span>w(movie)<span class="pl-k">.</span>build()<span class="pl-k">.</span>getPoints());
  }
}</pre></div>

<div class="highlight highlight-java"><pre><span class="pl-s">public</span> <span class="pl-s">class</span> <span class="pl-en">Rental</span> {

  <span class="pl-stj">Movie</span> movie;
  <span class="pl-s">private</span> <span class="pl-st">int</span> daysRented;
  <span class="pl-s">private</span> <span class="pl-st">boolean</span> started;

  <span class="pl-s">public</span> <span class="pl-en">Rental</span>(
    <span class="pl-stj">Movie</span> <span class="pl-v">movie</span>, <span class="pl-st">int</span> <span class="pl-v">daysRented</span>) {
    <span class="pl-v">this</span><span class="pl-k">.</span>movie <span class="pl-k">=</span> movie;
    <span class="pl-v">this</span><span class="pl-k">.</span>daysRented <span class="pl-k">=</span> daysRented;
  }

  <span class="pl-s">public</span> <span class="pl-st">double</span> <span class="pl-en">getCharge</span>() {
    <span class="pl-k">return</span> movie<span class="pl-k">.</span>getCharge(daysRented);
  }

  <span class="pl-s">public</span> <span class="pl-st">int</span> <span class="pl-en">getPoints</span>() {
    <span class="pl-k">return</span>
      movie<span class="pl-k">.</span>getPoints(daysRented, <span class="pl-c1">false</span>);
  }


  <span class="pl-s">public</span> <span class="pl-st">int</span> <span class="pl-en">getPoints</span>(<span class="pl-st">boolean</span> <span class="pl-v">vipFlag</span>) {
    <span class="pl-k">return</span>
      movie<span class="pl-k">.</span>getPoints(daysRented, vipFlag);
  }


  <span class="pl-s">public</span> <span class="pl-stj">String</span> <span class="pl-en">getLineItem</span>() {
    <span class="pl-k">return</span>
      movie<span class="pl-k">.</span>getTitle() <span class="pl-k">+</span> <span class="pl-s1"><span class="pl-pds">"</span> <span class="pl-pds">"</span></span> <span class="pl-k">+</span> getCharge();
  }
}</pre></div>

<div class="highlight highlight-java"><pre><span class="pl-s">public</span> <span class="pl-s">class</span> <span class="pl-en">CustomerTest</span> {
  <span class="pl-st">@Test</span>
  <span class="pl-s">public</span> <span class="pl-st">void</span> <span class="pl-en">noRentalsStatement</span>() {
    assertEquals(
      <span class="pl-s1"><span class="pl-pds">"</span>Rental record for Jim<span class="pl-cce">\n</span>Amount owed <span class="pl-pds">"</span></span> <span class="pl-k">+</span>
      <span class="pl-s1"><span class="pl-pds">"</span>is 0.0<span class="pl-cce">\n</span><span class="pl-pds">"</span></span> <span class="pl-k">+</span>
      <span class="pl-s1"><span class="pl-pds">"</span>You earned 0 frequent renter points<span class="pl-pds">"</span></span>,
      a<span class="pl-k">.</span>customer<span class="pl-k">.</span>build()<span class="pl-k">.</span>statement());
  }

  <span class="pl-st">@Test</span>
  <span class="pl-s">public</span> <span class="pl-st">void</span> <span class="pl-en">oneRentalStatement</span>() {
    <span class="pl-stj">Rental</span> rental <span class="pl-k">=</span> mock(<span class="pl-stj">Rental</span><span class="pl-k">.</span>class);
    assertEquals(
      <span class="pl-s1"><span class="pl-pds">"</span>Rental record for Jim<span class="pl-cce">\n\t</span>null<span class="pl-cce">\n</span><span class="pl-pds">"</span></span> <span class="pl-k">+</span>
      <span class="pl-s1"><span class="pl-pds">"</span>Amount owed is 0.0<span class="pl-cce">\n</span><span class="pl-pds">"</span></span> <span class="pl-k">+</span>
      <span class="pl-s1"><span class="pl-pds">"</span>You earned 0 frequent renter points<span class="pl-pds">"</span></span>,
      a<span class="pl-k">.</span>customer<span class="pl-k">.</span>w(
        rental)<span class="pl-k">.</span>build()<span class="pl-k">.</span>statement());
  }

  <span class="pl-st">@Test</span>
  <span class="pl-s">public</span> <span class="pl-st">void</span> <span class="pl-en">twoRentalsStatement</span>() {
    <span class="pl-stj">Rental</span> rental <span class="pl-k">=</span> mock(<span class="pl-stj">Rental</span><span class="pl-k">.</span>class);
    assertEquals(
      <span class="pl-s1"><span class="pl-pds">"</span>Rental record for Jim<span class="pl-cce">\n\t</span>null<span class="pl-cce">\n</span><span class="pl-pds">"</span></span> <span class="pl-k">+</span>
      <span class="pl-s1"><span class="pl-pds">"</span><span class="pl-cce">\t</span>null<span class="pl-cce">\n</span>Amount owed is 0.0<span class="pl-cce">\n</span><span class="pl-pds">"</span></span> <span class="pl-k">+</span>
      <span class="pl-s1"><span class="pl-pds">"</span>You earned 0 frequent renter points<span class="pl-pds">"</span></span>,
      a<span class="pl-k">.</span>customer<span class="pl-k">.</span>w(
        rental, rental)<span class="pl-k">.</span>build()<span class="pl-k">.</span>statement());
  }</pre></div>

<div class="highlight highlight-java"><pre>  @<span class="pl-stj">Test</span>
  <span class="pl-s">public</span> <span class="pl-st">void</span> noRentalsGetTotalPoints() {
    assertEquals(
      <span class="pl-c1">0</span>,
      a<span class="pl-k">.</span>customer<span class="pl-k">.</span>build()<span class="pl-k">.</span>getTotalPoints());
  }

  @<span class="pl-stj">Test</span>
  <span class="pl-s">public</span> <span class="pl-st">void</span> oneRentalGetTotalPoints() {
    <span class="pl-stj">Rental</span> rental <span class="pl-k">=</span> mock(<span class="pl-stj">Rental</span><span class="pl-k">.</span>class);
    when(rental<span class="pl-k">.</span>getPoints())
      .thenReturn(<span class="pl-c1">2</span>);
    assertEquals(
      <span class="pl-c1">2</span>,
      a<span class="pl-k">.</span>customer<span class="pl-k">.</span>w(
        rental)<span class="pl-k">.</span>build()<span class="pl-k">.</span>getTotalPoints());
  }

  @<span class="pl-stj">Test</span>
  <span class="pl-s">public</span> <span class="pl-st">void</span> twoRentalsGetTotalPoints() {
    <span class="pl-stj">Rental</span> one <span class="pl-k">=</span> mock(<span class="pl-stj">Rental</span><span class="pl-k">.</span>class);
    when(one<span class="pl-k">.</span>getPoints())
      .thenReturn(<span class="pl-c1">2</span>);
    <span class="pl-stj">Rental</span> two <span class="pl-k">=</span> mock(<span class="pl-stj">Rental</span><span class="pl-k">.</span>class);
    when(two<span class="pl-k">.</span>getPoints())
      .thenReturn(<span class="pl-c1">3</span>);
    assertEquals(
      <span class="pl-c1">5</span>,
      a<span class="pl-k">.</span>customer<span class="pl-k">.</span>w(
        one, two)<span class="pl-k">.</span>build()<span class="pl-k">.</span>getTotalPoints());
  }
}</pre></div>

<h4>
<a id="revisiting-the-definition-of-solitary-unit-test" class="anchor" href="#revisiting-the-definition-of-solitary-unit-test" aria-hidden="true"><span class="octicon octicon-link"></span></a>Revisiting the Definition of Solitary Unit Test</h4>

<div class="highlight highlight-java"><pre><span class="pl-s">public</span> <span class="pl-s">class</span> <span class="pl-en">MovieTest</span> {
  <span class="pl-st">@Test</span>
  <span class="pl-s">public</span> <span class="pl-st">void</span> <span class="pl-en">getChargeForChildrens</span>() {
    assertEquals(
      <span class="pl-c1">1.5</span>,
      a<span class="pl-k">.</span>movie<span class="pl-k">.</span>w(
        <span class="pl-c1">CHILDREN</span>)<span class="pl-k">.</span>build()<span class="pl-k">.</span>getCharge(<span class="pl-c1">1</span>),
      <span class="pl-c1">0</span>);
    assertEquals(
      <span class="pl-c1">1.5</span>,
      a<span class="pl-k">.</span>movie<span class="pl-k">.</span>w(
        <span class="pl-c1">CHILDREN</span>)<span class="pl-k">.</span>build()<span class="pl-k">.</span>getCharge(<span class="pl-c1">2</span>),
      <span class="pl-c1">0</span>);
    assertEquals(
      <span class="pl-c1">1.5</span>,
      a<span class="pl-k">.</span>movie<span class="pl-k">.</span>w(
        <span class="pl-c1">CHILDREN</span>)<span class="pl-k">.</span>build()<span class="pl-k">.</span>getCharge(<span class="pl-c1">3</span>),
      <span class="pl-c1">0</span>);
    assertEquals(
      <span class="pl-c1">3.0</span>,
      a<span class="pl-k">.</span>movie<span class="pl-k">.</span>w(
        <span class="pl-c1">CHILDREN</span>)<span class="pl-k">.</span>build()<span class="pl-k">.</span>getCharge(<span class="pl-c1">4</span>),
      <span class="pl-c1">0</span>);
    assertEquals(
      <span class="pl-c1">4.5</span>,
      a<span class="pl-k">.</span>movie<span class="pl-k">.</span>w(
        <span class="pl-c1">CHILDREN</span>)<span class="pl-k">.</span>build()<span class="pl-k">.</span>getCharge(<span class="pl-c1">5</span>),
      <span class="pl-c1">0</span>);
  }
}</pre></div>

<div class="highlight highlight-java"><pre><span class="pl-s">public</span> <span class="pl-s">class</span> <span class="pl-en">Movie</span> {

  <span class="pl-s">public</span> <span class="pl-s">enum</span> <span class="pl-en">Type</span> {
    <span class="pl-c1">REGULAR</span>, <span class="pl-c1">NEW_RELEASE</span>, <span class="pl-c1">CHILDREN</span>, <span class="pl-c1">UNKNOWN</span>;
  }

  <span class="pl-s">private</span> <span class="pl-stj">String</span> title;
  <span class="pl-stj">Price</span> price;

  <span class="pl-s">public</span> <span class="pl-en">Movie</span>(
    <span class="pl-stj">String</span> <span class="pl-v">title</span>, <span class="pl-stj">Movie</span>.<span class="pl-stj">Type</span> <span class="pl-v">priceCode</span>) {
    <span class="pl-v">this</span><span class="pl-k">.</span>title <span class="pl-k">=</span> title;
    setPriceCode(priceCode);
  }

  <span class="pl-s">public</span> <span class="pl-stj">String</span> <span class="pl-en">getTitle</span>() {
    <span class="pl-k">return</span> title;
  }</pre></div>

<div class="highlight highlight-java"><pre>  <span class="pl-s">private</span> <span class="pl-st">void</span> setPriceCode(
    <span class="pl-stj">Movie</span><span class="pl-k">.</span><span class="pl-stj">Type</span> priceCode) {
    <span class="pl-k">switch</span> (priceCode) {
    <span class="pl-k">case</span> <span class="pl-c1">CHILDREN</span><span class="pl-k">:</span>
      price <span class="pl-k">=</span> <span class="pl-k">new</span> <span class="pl-stj">ChildrensPrice</span>();
      <span class="pl-k">break</span>;
    <span class="pl-k">case</span> <span class="pl-c1">NEW_RELEASE</span><span class="pl-k">:</span>
      price <span class="pl-k">=</span> <span class="pl-k">new</span> <span class="pl-stj">NewReleasePrice</span>();
      <span class="pl-k">break</span>;
    <span class="pl-k">case</span> <span class="pl-c1">REGULAR</span><span class="pl-k">:</span>
      price <span class="pl-k">=</span> <span class="pl-k">new</span> <span class="pl-stj">RegularPrice</span>();
      <span class="pl-k">break</span>;
    <span class="pl-k">default</span><span class="pl-k">:</span>
      <span class="pl-k">throw</span> <span class="pl-k">new</span> <span class="pl-stj">IllegalArgumentException</span>(
        <span class="pl-s1"><span class="pl-pds">"</span>invalid price code<span class="pl-pds">"</span></span>);
    }
  }

  <span class="pl-s">public</span> <span class="pl-st">double</span> getCharge(<span class="pl-st">int</span> daysRented) {
    <span class="pl-k">return</span> price<span class="pl-k">.</span>getCharge(daysRented);
  }

  <span class="pl-s">public</span> <span class="pl-st">int</span> getPoints(<span class="pl-st">int</span> daysRented) {
    <span class="pl-k">return</span> price<span class="pl-k">.</span>getPoints(daysRented);
  }
}</pre></div>

<div class="highlight highlight-java"><pre><span class="pl-s">public</span> <span class="pl-s">class</span> <span class="pl-en">ChildrensPrice</span> <span class="pl-s">extends</span> <span class="pl-e">Price</span> {

  <span class="pl-st">@Override</span>
  <span class="pl-s">public</span> <span class="pl-st">double</span> <span class="pl-en">getCharge</span>(<span class="pl-st">int</span> <span class="pl-v">daysRented</span>) {
    <span class="pl-st">double</span> amount <span class="pl-k">=</span> <span class="pl-c1">1.5</span>;

    <span class="pl-k">if</span> (daysRented <span class="pl-k">&gt;</span> <span class="pl-c1">2</span>) <span class="pl-c">// *was 3*</span>
      amount <span class="pl-k">+=</span> (daysRented <span class="pl-k">-</span> <span class="pl-c1">2</span>) <span class="pl-k">*</span> <span class="pl-c1">1.5</span>;

    <span class="pl-k">return</span> amount;
  }
}</pre></div>

<h2>
<a id="questionable-tests" class="anchor" href="#questionable-tests" aria-hidden="true"><span class="octicon octicon-link"></span></a>Questionable Tests</h2>

<h3>
<a id="testing-language-features-or-standard-library-classes" class="anchor" href="#testing-language-features-or-standard-library-classes" aria-hidden="true"><span class="octicon octicon-link"></span></a>Testing Language Features or Standard Library Classes</h3>

<div class="highlight highlight-java"><pre><span class="pl-s">public</span> <span class="pl-s">class</span> <span class="pl-en">JavaTest</span> {
  <span class="pl-st">@Test</span>
  <span class="pl-s">public</span> <span class="pl-st">void</span> <span class="pl-en">arrayListGet</span>() {
    <span class="pl-st">ArrayList&lt;<span class="pl-stj">Integer</span>&gt;</span> list <span class="pl-k">=</span>
      <span class="pl-k">new</span> <span class="pl-st">ArrayList&lt;<span class="pl-stj">Integer</span>&gt;</span>();
    list<span class="pl-k">.</span>add(<span class="pl-c1">1</span>);
    assertEquals(
      <span class="pl-stj">Integer</span><span class="pl-k">.</span>valueOf(<span class="pl-c1">1</span>), list<span class="pl-k">.</span>get(<span class="pl-c1">0</span>));
  }

  <span class="pl-st">@Test</span>
  <span class="pl-s">public</span> <span class="pl-st">void</span> <span class="pl-en">hashMapGet</span>() {
    <span class="pl-st">HashMap&lt;<span class="pl-stj">Integer</span>, <span class="pl-stj">String</span>&gt;</span> map <span class="pl-k">=</span>
      <span class="pl-k">new</span> <span class="pl-st">HashMap&lt;<span class="pl-stj">Integer</span>, <span class="pl-stj">String</span>&gt;</span>();
    map<span class="pl-k">.</span>put(<span class="pl-c1">1</span>, <span class="pl-s1"><span class="pl-pds">"</span>a str<span class="pl-pds">"</span></span>);
    assertEquals(<span class="pl-s1"><span class="pl-pds">"</span>a str<span class="pl-pds">"</span></span>, map<span class="pl-k">.</span>get(<span class="pl-c1">1</span>));
  }

  <span class="pl-st">@Test</span>
  <span class="pl-s">public</span> <span class="pl-st">void</span> <span class="pl-en">throwCatch</span>() {
    <span class="pl-stj">Exception</span> ex <span class="pl-k">=</span> <span class="pl-c1">null</span>;
    <span class="pl-k">try</span> {
      <span class="pl-k">throw</span> <span class="pl-k">new</span> <span class="pl-stj">RuntimeException</span>(<span class="pl-s1"><span class="pl-pds">"</span>ex<span class="pl-pds">"</span></span>);
    } <span class="pl-k">catch</span> (<span class="pl-stj">Exception</span> eCaught) {
      ex <span class="pl-k">=</span> eCaught;
    }
    assertEquals(<span class="pl-s1"><span class="pl-pds">"</span>ex<span class="pl-pds">"</span></span>, ex<span class="pl-k">.</span>getMessage());
  }
}</pre></div>

<h3>
<a id="testing-framework-features-or-classes" class="anchor" href="#testing-framework-features-or-classes" aria-hidden="true"><span class="octicon octicon-link"></span></a>Testing Framework Features or Classes</h3>

<div class="highlight highlight-java"><pre><span class="pl-s">public</span> <span class="pl-s">class</span> <span class="pl-en">JodaTest</span> {
  <span class="pl-st">@Test</span>
  <span class="pl-s">public</span> <span class="pl-st">void</span> <span class="pl-en">parseStr</span>() {
    assertEquals(
      <span class="pl-c1">286347600000L</span>,
      <span class="pl-stj">DateTime</span><span class="pl-k">.</span>parse(
        <span class="pl-s1"><span class="pl-pds">"</span>1979-01-28<span class="pl-pds">"</span></span>)<span class="pl-k">.</span>getMillis());
  }
}</pre></div>

<h3>
<a id="testing-private-methods" class="anchor" href="#testing-private-methods" aria-hidden="true"><span class="octicon octicon-link"></span></a>Testing Private Methods</h3>

<h2>
<a id="custom-assertions" class="anchor" href="#custom-assertions" aria-hidden="true"><span class="octicon octicon-link"></span></a>Custom Assertions</h2>

<div class="highlight highlight-java"><pre><span class="pl-s">public</span> <span class="pl-s">class</span> <span class="pl-en">Assert</span> {
  <span class="pl-s">public</span> <span class="pl-s">static</span> <span class="pl-st">void</span> <span class="pl-en">assertThrows</span>(
    <span class="pl-stj">Class</span> <span class="pl-v">ex</span>, <span class="pl-stj">Runnable</span> <span class="pl-v">runnable</span>) {
    <span class="pl-stj">Exception</span> exThrown <span class="pl-k">=</span> <span class="pl-c1">null</span>;
    <span class="pl-k">try</span> {
      runnable<span class="pl-k">.</span>run();
    } <span class="pl-k">catch</span> (<span class="pl-stj">Exception</span> exThrownActual) {
      exThrown <span class="pl-k">=</span> exThrownActual;
    }
    <span class="pl-k">if</span> (<span class="pl-c1">null</span> <span class="pl-k">==</span> exThrown)
      fail(<span class="pl-s1"><span class="pl-pds">"</span>No exception thrown<span class="pl-pds">"</span></span>);
    <span class="pl-k">else</span>
      assertEquals(ex, exThrown<span class="pl-k">.</span>getClass());
  }
}</pre></div>

<div class="highlight highlight-java"><pre><span class="pl-s">public</span> <span class="pl-s">class</span> <span class="pl-en">MovieTest</span> {
  <span class="pl-st">@Test</span>
  <span class="pl-s">public</span> <span class="pl-st">void</span> <span class="pl-en">invalidTitleCustomAssertion</span>() {
    assertThrows(
      <span class="pl-stj">IllegalArgumentException</span><span class="pl-k">.</span>class,
      () <span class="pl-k">-</span><span class="pl-k">&gt;</span> a<span class="pl-k">.</span>movie<span class="pl-k">.</span>w(<span class="pl-c1">UNKNOWN</span>)<span class="pl-k">.</span>build());
  }

  <span class="pl-st">@Test</span>
  <span class="pl-s">public</span> <span class="pl-st">void</span> <span class="pl-en">invalidTitleWithoutCA</span>() {
    <span class="pl-stj">Exception</span> e <span class="pl-k">=</span> <span class="pl-c1">null</span>;
    <span class="pl-k">try</span> {
      a<span class="pl-k">.</span>movie<span class="pl-k">.</span>w(<span class="pl-c1">UNKNOWN</span>)<span class="pl-k">.</span>build();
    } <span class="pl-k">catch</span> (<span class="pl-stj">Exception</span> ex) {
      e <span class="pl-k">=</span> ex;
    }
    assertEquals(
      <span class="pl-stj">IllegalArgumentException</span><span class="pl-k">.</span>class,
      e<span class="pl-k">.</span>getClass());
  }
}</pre></div>

<div class="highlight highlight-java"><pre><span class="pl-s">public</span> <span class="pl-s">class</span> <span class="pl-en">AssertTest</span> {
  <span class="pl-st">@Test</span>
  <span class="pl-s">public</span> <span class="pl-st">void</span> <span class="pl-en">failIfNoThrow</span>() {
    <span class="pl-stj">AssertionError</span> e <span class="pl-k">=</span> <span class="pl-c1">null</span>;
    <span class="pl-k">try</span> {
      assertThrows(
        <span class="pl-stj">IllegalArgumentException</span><span class="pl-k">.</span>class,
        mock(<span class="pl-stj">Runnable</span><span class="pl-k">.</span>class));
    } <span class="pl-k">catch</span> (<span class="pl-stj">AssertionError</span> ex) {
      e <span class="pl-k">=</span> ex;
    }
    assertEquals(
      <span class="pl-stj">AssertionError</span><span class="pl-k">.</span>class,
      e<span class="pl-k">.</span>getClass());
  }

  <span class="pl-st">@Test</span>
  <span class="pl-s">public</span> <span class="pl-st">void</span> <span class="pl-en">failWithMessageIfNoThrow</span>() {
    <span class="pl-stj">AssertionError</span> e <span class="pl-k">=</span> <span class="pl-c1">null</span>;
    <span class="pl-k">try</span> {
      assertThrows(
        <span class="pl-stj">IllegalArgumentException</span><span class="pl-k">.</span>class,
        mock(<span class="pl-stj">Runnable</span><span class="pl-k">.</span>class));
    } <span class="pl-k">catch</span> (<span class="pl-stj">AssertionError</span> ex) {
      e <span class="pl-k">=</span> ex;
    }
    assertEquals(
      <span class="pl-s1"><span class="pl-pds">"</span>No exception thrown<span class="pl-pds">"</span></span>,
      e<span class="pl-k">.</span>getMessage());
  }</pre></div>

<div class="highlight highlight-java"><pre>  @<span class="pl-stj">Test</span>
  <span class="pl-s">public</span> <span class="pl-st">void</span> failIfClassMismatch() {
    <span class="pl-stj">AssertionError</span> e <span class="pl-k">=</span> <span class="pl-c1">null</span>;
    <span class="pl-k">try</span> {
      assertThrows(
        <span class="pl-stj">IllegalArgumentException</span><span class="pl-k">.</span>class,
        () <span class="pl-k">-</span><span class="pl-k">&gt;</span> {
          <span class="pl-k">throw</span> <span class="pl-k">new</span> <span class="pl-stj">RuntimeException</span>(<span class="pl-s1"><span class="pl-pds">"</span><span class="pl-pds">"</span></span>);});
    } <span class="pl-k">catch</span> (<span class="pl-stj">AssertionError</span> ex) {
      e <span class="pl-k">=</span> ex;
    }
    assertEquals(
      <span class="pl-stj">AssertionError</span><span class="pl-k">.</span>class,
      e<span class="pl-k">.</span>getClass());
  }</pre></div>

<div class="highlight highlight-java"><pre>  @<span class="pl-stj">Test</span>
  <span class="pl-s">public</span> <span class="pl-st">void</span> failWithMessageIfClassWrong() {
    <span class="pl-stj">AssertionError</span> e <span class="pl-k">=</span> <span class="pl-c1">null</span>;
    <span class="pl-k">try</span> {
      assertThrows(
        <span class="pl-stj">IllegalArgumentException</span><span class="pl-k">.</span>class,
        () <span class="pl-k">-</span><span class="pl-k">&gt;</span> {
          <span class="pl-k">throw</span> <span class="pl-k">new</span> <span class="pl-stj">RuntimeException</span>(<span class="pl-s1"><span class="pl-pds">"</span><span class="pl-pds">"</span></span>);});
    } <span class="pl-k">catch</span> (<span class="pl-stj">AssertionError</span> ex) {
      e <span class="pl-k">=</span> ex;
    }
    assertEquals(
      <span class="pl-s1"><span class="pl-pds">"</span>expected:&lt;class java.lang.<span class="pl-pds">"</span></span><span class="pl-k">+</span>
      <span class="pl-s1"><span class="pl-pds">"</span>IllegalArgumentException&gt; <span class="pl-pds">"</span></span><span class="pl-k">+</span>
      <span class="pl-s1"><span class="pl-pds">"</span>but was:&lt;class java.lang.<span class="pl-pds">"</span></span><span class="pl-k">+</span>
      <span class="pl-s1"><span class="pl-pds">"</span>RuntimeException&gt;<span class="pl-pds">"</span></span>,
      e<span class="pl-k">.</span>getMessage());
  }</pre></div>

<div class="highlight highlight-java"><pre>  @<span class="pl-stj">Test</span>
  <span class="pl-s">public</span> <span class="pl-st">void</span> passWithCorrectException() {
    <span class="pl-stj">AssertionError</span> e <span class="pl-k">=</span> <span class="pl-c1">null</span>;
    <span class="pl-k">try</span> {
      assertThrows(
        <span class="pl-stj">RuntimeException</span><span class="pl-k">.</span>class,
        () <span class="pl-k">-</span><span class="pl-k">&gt;</span> {
          <span class="pl-k">throw</span> <span class="pl-k">new</span> <span class="pl-stj">RuntimeException</span>(<span class="pl-s1"><span class="pl-pds">"</span><span class="pl-pds">"</span></span>);});
    } <span class="pl-k">catch</span> (<span class="pl-stj">AssertionError</span> ex) {
      e <span class="pl-k">=</span> ex;
    }
    assertEquals(<span class="pl-c1">null</span>, e);
  }
}</pre></div>

<h3>
<a id="custom-assertions-on-value-objects" class="anchor" href="#custom-assertions-on-value-objects" aria-hidden="true"><span class="octicon octicon-link"></span></a>Custom Assertions on Value Objects</h3>

<div class="highlight highlight-java"><pre><span class="pl-s">public</span> <span class="pl-s">class</span> <span class="pl-en">MovieTest</span> {
  <span class="pl-st">@Test</span>
  <span class="pl-s">public</span> <span class="pl-st">void</span> <span class="pl-en">compareDates</span>() {
    <span class="pl-stj">Movie</span> godfather <span class="pl-k">=</span>
      a<span class="pl-k">.</span>movie<span class="pl-k">.</span>w(
        <span class="pl-k">new</span> <span class="pl-stj">Date</span>(<span class="pl-c1">70261200000L</span>))<span class="pl-k">.</span>build();
    assertEquals(
      <span class="pl-s1"><span class="pl-pds">"</span>1972-03-24<span class="pl-pds">"</span></span>,
      <span class="pl-k">new</span> <span class="pl-stj">SimpleDateFormat</span>(
        <span class="pl-s1"><span class="pl-pds">"</span>yyyy-MM-dd<span class="pl-pds">"</span></span>)<span class="pl-k">.</span>format(
          godfather<span class="pl-k">.</span>releaseDate()));
  }
}</pre></div>

<div class="highlight highlight-java"><pre><span class="pl-s">public</span> <span class="pl-s">class</span> <span class="pl-en">Assert</span> {
  <span class="pl-s">public</span> <span class="pl-s">static</span> <span class="pl-st">void</span> <span class="pl-en">assertDateWithFormat</span>(
    <span class="pl-stj">String</span> <span class="pl-v">expected</span>,
    <span class="pl-stj">String</span> <span class="pl-v">format</span>,
    <span class="pl-stj">Date</span> <span class="pl-v">dt</span>) {
    assertEquals(
      expected,
      <span class="pl-k">new</span> <span class="pl-stj">SimpleDateFormat</span>(
        format)<span class="pl-k">.</span>format(dt));
  }
}</pre></div>

<div class="highlight highlight-java"><pre><span class="pl-s">public</span> <span class="pl-s">class</span> <span class="pl-en">MovieTest</span> {
  <span class="pl-st">@Test</span>
  <span class="pl-s">public</span> <span class="pl-st">void</span> <span class="pl-en">compareDates</span>() {
    <span class="pl-stj">Movie</span> godfather <span class="pl-k">=</span>
      a<span class="pl-k">.</span>movie<span class="pl-k">.</span>w(
        <span class="pl-k">new</span> <span class="pl-stj">Date</span>(<span class="pl-c1">70261200000L</span>))<span class="pl-k">.</span>build();
    assertDateWithFormat(
      <span class="pl-s1"><span class="pl-pds">"</span>1972-03-24<span class="pl-pds">"</span></span>,
      <span class="pl-s1"><span class="pl-pds">"</span>yyyy-MM-dd<span class="pl-pds">"</span></span>,
      godfather<span class="pl-k">.</span>releaseDate());
  }
}</pre></div>

<h4>
<a id="custom-assertions-for-money" class="anchor" href="#custom-assertions-for-money" aria-hidden="true"><span class="octicon octicon-link"></span></a>Custom Assertions for Money</h4>

<div class="highlight highlight-java"><pre><span class="pl-s">public</span> <span class="pl-s">class</span> <span class="pl-en">Money</span> {
  <span class="pl-s">private</span> <span class="pl-stj">BigDecimal</span> val;

  <span class="pl-s">public</span> <span class="pl-en">Money</span>(<span class="pl-st">double</span> <span class="pl-v">val</span>) {
    <span class="pl-v">this</span>(<span class="pl-stj">BigDecimal</span><span class="pl-k">.</span>valueOf(val));
  }

  <span class="pl-s">public</span> <span class="pl-en">Money</span>(<span class="pl-stj">BigDecimal</span> <span class="pl-v">val</span>) {
    <span class="pl-v">this</span><span class="pl-k">.</span>val <span class="pl-k">=</span> val;
  }

  <span class="pl-s">public</span> <span class="pl-stj">Money</span> <span class="pl-en">add</span>(<span class="pl-st">double</span> <span class="pl-v">d</span>) {
    <span class="pl-k">return</span> <span class="pl-k">new</span> <span class="pl-stj">Money</span>(
      val<span class="pl-k">.</span>add(<span class="pl-stj">BigDecimal</span><span class="pl-k">.</span>valueOf(d)));
  }

  <span class="pl-s">public</span> <span class="pl-stj">Money</span> <span class="pl-en">add</span>(<span class="pl-stj">Money</span> <span class="pl-v">m</span>) {
    <span class="pl-k">return</span> <span class="pl-k">new</span> <span class="pl-stj">Money</span>(val<span class="pl-k">.</span>add(m<span class="pl-k">.</span>val));
  }

  <span class="pl-s">public</span> <span class="pl-st">double</span> <span class="pl-en">toDouble</span>() {
    <span class="pl-k">return</span> val
      .setScale(<span class="pl-c1">2</span>, <span class="pl-stj">BigDecimal</span><span class="pl-c1"><span class="pl-k">.</span>ROUND_HALF_UP</span>)
      .doubleValue();
  }
}</pre></div>

<div class="highlight highlight-java"><pre><span class="pl-s">public</span> <span class="pl-s">class</span> <span class="pl-en">MoneyTest</span> {
  <span class="pl-st">@Test</span>
  <span class="pl-s">public</span> <span class="pl-st">void</span> <span class="pl-en">doubleAddition</span>() {
    assertEquals(
      <span class="pl-c1">11.0</span>,
      a<span class="pl-k">.</span>money<span class="pl-k">.</span>w(<span class="pl-c1">1.0</span>)<span class="pl-k">.</span>build()<span class="pl-k">.</span>add(
        <span class="pl-c1">10.0</span>)<span class="pl-k">.</span>toDouble(),
      <span class="pl-c1">0</span>);
  }

  <span class="pl-st">@Test</span>
  <span class="pl-s">public</span> <span class="pl-st">void</span> <span class="pl-en">moneyAddition</span>() {
    assertEquals(
      <span class="pl-c1">11.0</span>,
      a<span class="pl-k">.</span>money<span class="pl-k">.</span>w(<span class="pl-c1">1.0</span>)<span class="pl-k">.</span>build()<span class="pl-k">.</span>add(
        a<span class="pl-k">.</span>money<span class="pl-k">.</span>w(<span class="pl-c1">10.0</span>)<span class="pl-k">.</span>build())<span class="pl-k">.</span>toDouble(),
      <span class="pl-c1">0</span>);
  }

  <span class="pl-st">@Test</span>
  <span class="pl-s">public</span> <span class="pl-st">void</span> <span class="pl-en">oneDecimalToDouble</span>() {
    assertEquals(
      <span class="pl-c1">1.0</span>,
      a<span class="pl-k">.</span>money<span class="pl-k">.</span>w(<span class="pl-c1">1.0</span>)<span class="pl-k">.</span>build()<span class="pl-k">.</span>toDouble(),
      <span class="pl-c1">0</span>);
  }</pre></div>

<div class="highlight highlight-java"><pre>  @<span class="pl-stj">Test</span>
  <span class="pl-s">public</span> <span class="pl-st">void</span> twoDecimalToDouble() {
    assertEquals(
      <span class="pl-c1">1.12</span>,
      a<span class="pl-k">.</span>money<span class="pl-k">.</span>w(<span class="pl-c1">1.12</span>)<span class="pl-k">.</span>build()<span class="pl-k">.</span>toDouble(),
      <span class="pl-c1">0</span>);
  }

  @<span class="pl-stj">Test</span>
  <span class="pl-s">public</span> <span class="pl-st">void</span> thrDecimalUpToDouble() {
    assertEquals(
      <span class="pl-c1">1.12</span>,
      a<span class="pl-k">.</span>money<span class="pl-k">.</span>w(<span class="pl-c1">1.123</span>)<span class="pl-k">.</span>build()<span class="pl-k">.</span>toDouble(),
      <span class="pl-c1">0</span>);
  }

  @<span class="pl-stj">Test</span>
  <span class="pl-s">public</span> <span class="pl-st">void</span> thrDecimalDownToDouble() {
    assertEquals(
      <span class="pl-c1">1.13</span>,
      a<span class="pl-k">.</span>money<span class="pl-k">.</span>w(<span class="pl-c1">1.125</span>)<span class="pl-k">.</span>build()<span class="pl-k">.</span>toDouble(),
      <span class="pl-c1">0</span>);
  }
}</pre></div>

<div class="highlight highlight-java"><pre><span class="pl-s">public</span> <span class="pl-s">class</span> <span class="pl-en">Movie</span> {

  <span class="pl-s">public</span> <span class="pl-s">enum</span> <span class="pl-en">Type</span> {
    <span class="pl-c1">REGULAR</span>, <span class="pl-c1">NEW_RELEASE</span>, <span class="pl-c1">CHILDREN</span>;
  }

  <span class="pl-s">private</span> <span class="pl-stj">String</span> title;
  <span class="pl-stj">Price</span> price;

  <span class="pl-s">public</span> <span class="pl-en">Movie</span>(
    <span class="pl-stj">String</span> <span class="pl-v">title</span>, <span class="pl-stj">Movie</span>.<span class="pl-stj">Type</span> <span class="pl-v">priceCode</span>) {
    <span class="pl-v">this</span><span class="pl-k">.</span>title <span class="pl-k">=</span> title;
    setPriceCode(priceCode);
  }

  <span class="pl-s">private</span> <span class="pl-st">void</span> <span class="pl-en">setPriceCode</span>(
    <span class="pl-stj">Movie</span>.<span class="pl-stj">Type</span> <span class="pl-v">priceCode</span>) {
    <span class="pl-k">switch</span> (priceCode) {
    <span class="pl-k">case</span> <span class="pl-c1">CHILDREN</span><span class="pl-k">:</span>
      price <span class="pl-k">=</span> <span class="pl-k">new</span> <span class="pl-stj">ChildrensPrice</span>();
      <span class="pl-k">break</span>;
    <span class="pl-k">case</span> <span class="pl-c1">NEW_RELEASE</span><span class="pl-k">:</span>
      price <span class="pl-k">=</span> <span class="pl-k">new</span> <span class="pl-stj">NewReleasePrice</span>();
      <span class="pl-k">break</span>;
    <span class="pl-k">case</span> <span class="pl-c1">REGULAR</span><span class="pl-k">:</span>
      price <span class="pl-k">=</span> <span class="pl-k">new</span> <span class="pl-stj">RegularPrice</span>();
      <span class="pl-k">break</span>;
    }
  }</pre></div>

<div class="highlight highlight-java"><pre>
  <span class="pl-s">public</span> <span class="pl-stj">Money</span> getCharge(<span class="pl-st">int</span> daysRented) {
    <span class="pl-k">return</span> price<span class="pl-k">.</span>getCharge(daysRented);
  }

}</pre></div>

<div class="highlight highlight-java"><pre><span class="pl-s">public</span> <span class="pl-s">class</span> <span class="pl-en">MovieTest</span> {
  <span class="pl-st">@Test</span>
  <span class="pl-s">public</span> <span class="pl-st">void</span> <span class="pl-en">getChargeForChildrens1Day</span>() {
    assertEquals(
      <span class="pl-c1">1.5</span>,
      a<span class="pl-k">.</span>movie<span class="pl-k">.</span>w(
        <span class="pl-c1">CHILDREN</span>)<span class="pl-k">.</span>build()<span class="pl-k">.</span>getCharge(

          <span class="pl-c1">1</span>)<span class="pl-k">.</span>toDouble(),

      <span class="pl-c1">0</span>);
  }

  <span class="pl-st">@Test</span>
  <span class="pl-s">public</span> <span class="pl-st">void</span> <span class="pl-en">getChargeForChildrens2Day</span>() {
    assertEquals(
      <span class="pl-c1">1.5</span>,
      a<span class="pl-k">.</span>movie<span class="pl-k">.</span>w(
        <span class="pl-c1">CHILDREN</span>)<span class="pl-k">.</span>build()<span class="pl-k">.</span>getCharge(

          <span class="pl-c1">2</span>)<span class="pl-k">.</span>toDouble(),

      <span class="pl-c1">0</span>);
  }

  <span class="pl-st">@Test</span>
  <span class="pl-s">public</span> <span class="pl-st">void</span> <span class="pl-en">getChargeForChildrens3Day</span>() {
    assertEquals(
      <span class="pl-c1">1.5</span>,
      a<span class="pl-k">.</span>movie<span class="pl-k">.</span>w(
        <span class="pl-c1">CHILDREN</span>)<span class="pl-k">.</span>build()<span class="pl-k">.</span>getCharge(

          <span class="pl-c1">3</span>)<span class="pl-k">.</span>toDouble(),

      <span class="pl-c1">0</span>);
  }</pre></div>

<div class="highlight highlight-java"><pre>  @<span class="pl-stj">Test</span>
  <span class="pl-s">public</span> <span class="pl-st">void</span> getChargeForChildrens4Day() {
    assertEquals(
      <span class="pl-c1">3.0</span>,
      a<span class="pl-k">.</span>movie<span class="pl-k">.</span>w(
        <span class="pl-c1">CHILDREN</span>)<span class="pl-k">.</span>build()<span class="pl-k">.</span>getCharge(

          <span class="pl-c1">4</span>)<span class="pl-k">.</span>toDouble(),

      <span class="pl-c1">0</span>);
  }

  @<span class="pl-stj">Test</span>
  <span class="pl-s">public</span> <span class="pl-st">void</span> getChargeForChildrens5Day() {
    assertEquals(
      <span class="pl-c1">4.5</span>,
      a<span class="pl-k">.</span>movie<span class="pl-k">.</span>w(
        <span class="pl-c1">CHILDREN</span>)<span class="pl-k">.</span>build()<span class="pl-k">.</span>getCharge(

          <span class="pl-c1">5</span>)<span class="pl-k">.</span>toDouble(),

      <span class="pl-c1">0</span>);
  }
}</pre></div>

<div class="highlight highlight-java"><pre><span class="pl-s">public</span> <span class="pl-s">class</span> <span class="pl-en">Assert</span> {
  <span class="pl-s">public</span> <span class="pl-s">static</span> <span class="pl-st">void</span> <span class="pl-en">assertMoney</span>(
    <span class="pl-st">double</span> <span class="pl-v">d</span>, <span class="pl-stj">Money</span> <span class="pl-v">m</span>) {
    assertEquals(d, m<span class="pl-k">.</span>toDouble(), <span class="pl-c1">0</span>);
  }
}</pre></div>

<div class="highlight highlight-java"><pre><span class="pl-s">public</span> <span class="pl-s">class</span> <span class="pl-en">MoneyTest</span> {
  <span class="pl-st">@Test</span>
  <span class="pl-s">public</span> <span class="pl-st">void</span> <span class="pl-en">doubleAddition</span>() {
    assertMoney(
      <span class="pl-c1">11.0</span>, a<span class="pl-k">.</span>money<span class="pl-k">.</span>w(<span class="pl-c1">1.0</span>)<span class="pl-k">.</span>build()<span class="pl-k">.</span>add(<span class="pl-c1">10.0</span>));
  }

  <span class="pl-st">@Test</span>
  <span class="pl-s">public</span> <span class="pl-st">void</span> <span class="pl-en">moneyAddition</span>() {
    assertMoney(
      <span class="pl-c1">11.0</span>,
      a<span class="pl-k">.</span>money<span class="pl-k">.</span>w(<span class="pl-c1">1.0</span>)<span class="pl-k">.</span>build()<span class="pl-k">.</span>add(
        a<span class="pl-k">.</span>money<span class="pl-k">.</span>w(<span class="pl-c1">10.0</span>)<span class="pl-k">.</span>build()));
  }

  <span class="pl-st">@Test</span>
  <span class="pl-s">public</span> <span class="pl-st">void</span> <span class="pl-en">oneDecimalToDouble</span>() {
    assertMoney(
      <span class="pl-c1">1.0</span>, a<span class="pl-k">.</span>money<span class="pl-k">.</span>w(<span class="pl-c1">1.0</span>)<span class="pl-k">.</span>build());
  }

  <span class="pl-st">@Test</span>
  <span class="pl-s">public</span> <span class="pl-st">void</span> <span class="pl-en">twoDecimalToDouble</span>() {
    assertMoney(
      <span class="pl-c1">1.12</span>, a<span class="pl-k">.</span>money<span class="pl-k">.</span>w(<span class="pl-c1">1.12</span>)<span class="pl-k">.</span>build());
  }

  <span class="pl-st">@Test</span>
  <span class="pl-s">public</span> <span class="pl-st">void</span> <span class="pl-en">thrDecimalUpToDouble</span>() {
    assertMoney(
      <span class="pl-c1">1.12</span>, a<span class="pl-k">.</span>money<span class="pl-k">.</span>w(<span class="pl-c1">1.123</span>)<span class="pl-k">.</span>build());
  }</pre></div>

<div class="highlight highlight-java"><pre>  @<span class="pl-stj">Test</span>
  <span class="pl-s">public</span> <span class="pl-st">void</span> thrDecimalDownToDouble() {
    assertMoney(
      <span class="pl-c1">1.13</span>, a<span class="pl-k">.</span>money<span class="pl-k">.</span>w(<span class="pl-c1">1.125</span>)<span class="pl-k">.</span>build());
  }
}</pre></div>

<div class="highlight highlight-java"><pre><span class="pl-s">public</span> <span class="pl-s">class</span> <span class="pl-en">MovieTest</span> {
  <span class="pl-st">@Test</span>
  <span class="pl-s">public</span> <span class="pl-st">void</span> <span class="pl-en">getChargeForChildrens1Day</span>() {
    assertMoney(
      <span class="pl-c1">1.5</span>,
      a<span class="pl-k">.</span>movie<span class="pl-k">.</span>w(
        <span class="pl-c1">CHILDREN</span>)<span class="pl-k">.</span>build()<span class="pl-k">.</span>getCharge(<span class="pl-c1">1</span>));
  }

  <span class="pl-st">@Test</span>
  <span class="pl-s">public</span> <span class="pl-st">void</span> <span class="pl-en">getChargeForChildrens2Day</span>() {
    assertMoney(
      <span class="pl-c1">1.5</span>,
      a<span class="pl-k">.</span>movie<span class="pl-k">.</span>w(
        <span class="pl-c1">CHILDREN</span>)<span class="pl-k">.</span>build()<span class="pl-k">.</span>getCharge(<span class="pl-c1">2</span>));
  }

  <span class="pl-st">@Test</span>
  <span class="pl-s">public</span> <span class="pl-st">void</span> <span class="pl-en">getChargeForChildrens3Day</span>() {
    assertMoney(
      <span class="pl-c1">1.5</span>,
      a<span class="pl-k">.</span>movie<span class="pl-k">.</span>w(
        <span class="pl-c1">CHILDREN</span>)<span class="pl-k">.</span>build()<span class="pl-k">.</span>getCharge(<span class="pl-c1">3</span>));
  }

  <span class="pl-st">@Test</span>
  <span class="pl-s">public</span> <span class="pl-st">void</span> <span class="pl-en">getChargeForChildrens4Day</span>() {
    assertMoney(
      <span class="pl-c1">3.0</span>,
      a<span class="pl-k">.</span>movie<span class="pl-k">.</span>w(
        <span class="pl-c1">CHILDREN</span>)<span class="pl-k">.</span>build()<span class="pl-k">.</span>getCharge(<span class="pl-c1">4</span>));
  }</pre></div>

<div class="highlight highlight-java"><pre>  @<span class="pl-stj">Test</span>
  <span class="pl-s">public</span> <span class="pl-st">void</span> getChargeForChildrens5Day() {
    assertMoney(
      <span class="pl-c1">4.5</span>,
      a<span class="pl-k">.</span>movie<span class="pl-k">.</span>w(
        <span class="pl-c1">CHILDREN</span>)<span class="pl-k">.</span>build()<span class="pl-k">.</span>getCharge(<span class="pl-c1">5</span>));
  }
}</pre></div>

<div class="highlight highlight-java"><pre><span class="pl-s">public</span> <span class="pl-s">class</span> <span class="pl-en">Rental</span> {

  <span class="pl-stj">Movie</span> movie;
  <span class="pl-s">private</span> <span class="pl-st">int</span> daysRented;

  <span class="pl-s">public</span> <span class="pl-en">Rental</span>(
    <span class="pl-stj">Movie</span> <span class="pl-v">movie</span>, <span class="pl-st">int</span> <span class="pl-v">daysRented</span>) {
    <span class="pl-v">this</span><span class="pl-k">.</span>movie <span class="pl-k">=</span> movie;
    <span class="pl-v">this</span><span class="pl-k">.</span>daysRented <span class="pl-k">=</span> daysRented;
  }


  <span class="pl-s">public</span> <span class="pl-stj">Money</span> <span class="pl-en">getCharge</span>() {
    <span class="pl-k">return</span> movie<span class="pl-k">.</span>getCharge(daysRented);
  }

}</pre></div>

<div class="highlight highlight-java"><pre><span class="pl-s">public</span> <span class="pl-s">class</span> <span class="pl-en">RentalTest</span> {
  <span class="pl-st">@Test</span>
  <span class="pl-s">public</span> <span class="pl-st">void</span> <span class="pl-en">getChargeFromMovie</span>() {
    <span class="pl-stj">Movie</span> movie <span class="pl-k">=</span> mock(<span class="pl-stj">Movie</span><span class="pl-k">.</span>class);
    when(movie<span class="pl-k">.</span>getCharge(any(<span class="pl-stj">Integer</span><span class="pl-k">.</span>class)))
      .thenReturn(a<span class="pl-k">.</span>money<span class="pl-k">.</span>w(<span class="pl-c1">1.5</span>)<span class="pl-k">.</span>build());
    assertMoney(
      <span class="pl-c1">1.5</span>,
      a<span class="pl-k">.</span>rental<span class="pl-k">.</span>w(movie)<span class="pl-k">.</span>build()<span class="pl-k">.</span>getCharge());
  }
}</pre></div>

<div class="highlight highlight-java"><pre><span class="pl-s">public</span> <span class="pl-s">class</span> <span class="pl-en">Customer</span> {

  <span class="pl-s">private</span> <span class="pl-st">List&lt;<span class="pl-stj">Rental</span>&gt;</span> rentals <span class="pl-k">=</span>
    <span class="pl-k">new</span> <span class="pl-st">ArrayList&lt;<span class="pl-stj">Rental</span>&gt;</span>();

  <span class="pl-s">public</span> <span class="pl-st">void</span> <span class="pl-en">addRental</span>(<span class="pl-stj">Rental</span> <span class="pl-v">rental</span>) {
    rentals<span class="pl-k">.</span>add(rental);
  }


  <span class="pl-s">public</span> <span class="pl-stj">Money</span> <span class="pl-en">getTotalCharge</span>() {
    <span class="pl-stj">Money</span> total <span class="pl-k">=</span> <span class="pl-k">new</span> <span class="pl-stj">Money</span>(<span class="pl-c1">0.0</span>);
    <span class="pl-k">for</span> (<span class="pl-stj">Rental</span> rental <span class="pl-k">:</span> rentals)
      total <span class="pl-k">=</span> total<span class="pl-k">.</span>add(rental<span class="pl-k">.</span>getCharge());
    <span class="pl-k">return</span> total;
  }

}</pre></div>

<div class="highlight highlight-java"><pre><span class="pl-s">public</span> <span class="pl-s">class</span> <span class="pl-en">CustomerTest</span> {
  <span class="pl-st">@Test</span>
  <span class="pl-s">public</span> <span class="pl-st">void</span> <span class="pl-en">chargeForNoRentals</span>() {
    assertMoney(
      <span class="pl-c1">0.0</span>,
      a<span class="pl-k">.</span>customer<span class="pl-k">.</span>build()<span class="pl-k">.</span>getTotalCharge());
  }

  <span class="pl-st">@Test</span>
  <span class="pl-s">public</span> <span class="pl-st">void</span> <span class="pl-en">chargeForOneRental</span>() {
    <span class="pl-stj">Rental</span> rental <span class="pl-k">=</span> mock(<span class="pl-stj">Rental</span><span class="pl-k">.</span>class);
    when(rental<span class="pl-k">.</span>getCharge())
      .thenReturn(a<span class="pl-k">.</span>money<span class="pl-k">.</span>w(<span class="pl-c1">2.0</span>)<span class="pl-k">.</span>build());
    assertMoney(
      <span class="pl-c1">2.0</span>,
      a<span class="pl-k">.</span>customer<span class="pl-k">.</span>w(
        rental)<span class="pl-k">.</span>build()<span class="pl-k">.</span>getTotalCharge());
  }</pre></div>

<div class="highlight highlight-java"><pre>  @<span class="pl-stj">Test</span>
  <span class="pl-s">public</span> <span class="pl-st">void</span> chargeForTwoRentals() {
    <span class="pl-stj">Rental</span> rental1 <span class="pl-k">=</span> mock(<span class="pl-stj">Rental</span><span class="pl-k">.</span>class);
    when(rental1<span class="pl-k">.</span>getCharge())
      .thenReturn(a<span class="pl-k">.</span>money<span class="pl-k">.</span>w(<span class="pl-c1">2.2</span>)<span class="pl-k">.</span>build());
    <span class="pl-stj">Rental</span> rental2 <span class="pl-k">=</span> mock(<span class="pl-stj">Rental</span><span class="pl-k">.</span>class);
    when(rental2<span class="pl-k">.</span>getCharge())
      .thenReturn(a<span class="pl-k">.</span>money<span class="pl-k">.</span>w(<span class="pl-c1">3.5</span>)<span class="pl-k">.</span>build());
    assertMoney(
      <span class="pl-c1">5.7</span>,
      a<span class="pl-k">.</span>customer<span class="pl-k">.</span>w(
        rental1,
        rental2)<span class="pl-k">.</span>build()<span class="pl-k">.</span>getTotalCharge());
  }
}</pre></div>

<h2>
<a id="global-definition" class="anchor" href="#global-definition" aria-hidden="true"><span class="octicon octicon-link"></span></a>Global Definition</h2>

<h3>
<a id="creating-domain-objects-within-tests" class="anchor" href="#creating-domain-objects-within-tests" aria-hidden="true"><span class="octicon octicon-link"></span></a>Creating Domain Objects Within Tests</h3>

<h4>
<a id="new-is-the-new-new" class="anchor" href="#new-is-the-new-new" aria-hidden="true"><span class="octicon octicon-link"></span></a>New Is The New New</h4>

<h4>
<a id="object-mother" class="anchor" href="#object-mother" aria-hidden="true"><span class="octicon octicon-link"></span></a>Object Mother</h4>

<h4>
<a id="test-data-builders" class="anchor" href="#test-data-builders" aria-hidden="true"><span class="octicon octicon-link"></span></a>Test Data Builders</h4>

<h4>
<a id="test-data-builder-syntax" class="anchor" href="#test-data-builder-syntax" aria-hidden="true"><span class="octicon octicon-link"></span></a>Test Data Builder Syntax</h4>

<h4>
<a id="test-data-builder-guidelines-revisited" class="anchor" href="#test-data-builder-guidelines-revisited" aria-hidden="true"><span class="octicon octicon-link"></span></a>Test Data Builder Guidelines Revisited</h4>

<div class="highlight highlight-java"><pre><span class="pl-s">public</span> <span class="pl-s">class</span> <span class="pl-en">a</span> {
  <span class="pl-s">public</span> <span class="pl-s">static</span> <span class="pl-stj">CustomerBuilder</span> customer <span class="pl-k">=</span>
    <span class="pl-k">new</span> <span class="pl-stj">CustomerBuilder</span>();
  <span class="pl-s">public</span> <span class="pl-s">static</span> <span class="pl-stj">MoneyBuilder</span> money <span class="pl-k">=</span>
    <span class="pl-k">new</span> <span class="pl-stj">MoneyBuilder</span>();

  <span class="pl-s">public</span> <span class="pl-s">static</span> <span class="pl-s">class</span> <span class="pl-en">CustomerBuilder</span> {
    <span class="pl-st">Rental</span>[] rentals;

    <span class="pl-en">CustomerBuilder</span>() {
      <span class="pl-v">this</span>(<span class="pl-k">new</span> <span class="pl-stj">Rental</span>[<span class="pl-c1">0</span>]);
    }

    <span class="pl-en">CustomerBuilder</span>(<span class="pl-st">Rental</span>[] <span class="pl-v">rentals</span>) {
      <span class="pl-v">this</span><span class="pl-k">.</span>rentals <span class="pl-k">=</span> rentals;
    }

    <span class="pl-s">public</span> <span class="pl-stj">CustomerBuilder</span> <span class="pl-en">w</span>(
      <span class="pl-stj">Rental</span>... <span class="pl-v">rentals</span>) {
      <span class="pl-k">return</span> <span class="pl-k">new</span> <span class="pl-stj">CustomerBuilder</span>(rentals);
    }

    <span class="pl-s">public</span> <span class="pl-stj">Customer</span> <span class="pl-en">build</span>() {
      <span class="pl-stj">Customer</span> result <span class="pl-k">=</span> <span class="pl-k">new</span> <span class="pl-stj">Customer</span>();
      <span class="pl-k">for</span> (<span class="pl-stj">Rental</span> rental <span class="pl-k">:</span> rentals) {
        result<span class="pl-k">.</span>addRental(rental);
      }
      <span class="pl-k">return</span> result;
    }
  }</pre></div>

<div class="highlight highlight-java"><pre>  <span class="pl-s">public</span> <span class="pl-s">static</span> <span class="pl-s">class</span> <span class="pl-en">MoneyBuilder</span> {
    <span class="pl-s">final</span> <span class="pl-st">double</span> val;

    <span class="pl-en">MoneyBuilder</span>() {
      <span class="pl-v">this</span>(<span class="pl-c1">1.0</span>);
    }

    <span class="pl-en">MoneyBuilder</span>(<span class="pl-st">double</span> <span class="pl-v">val</span>) {
      <span class="pl-v">this</span><span class="pl-k">.</span>val <span class="pl-k">=</span> val;
    }

    <span class="pl-s">public</span> <span class="pl-stj">MoneyBuilder</span> <span class="pl-en">w</span>(<span class="pl-st">double</span> <span class="pl-v">val</span>) {
      <span class="pl-k">return</span> <span class="pl-k">new</span> <span class="pl-stj">MoneyBuilder</span>(val);
    }

    <span class="pl-s">public</span> <span class="pl-stj">Money</span> <span class="pl-en">build</span>() {
      <span class="pl-k">return</span> <span class="pl-k">new</span> <span class="pl-stj">Money</span>(val);
    }
  }
}</pre></div>

<div class="highlight highlight-java"><pre><span class="pl-s">public</span> <span class="pl-s">class</span> <span class="pl-en">CustomerTest</span> {
  <span class="pl-st">@Test</span>
  <span class="pl-s">public</span> <span class="pl-st">void</span> <span class="pl-en">chargeForTwoRentals</span>() {
    <span class="pl-stj">Rental</span> rental1 <span class="pl-k">=</span> mock(<span class="pl-stj">Rental</span><span class="pl-k">.</span>class);
    when(rental1<span class="pl-k">.</span>getCharge())
      .thenReturn(a<span class="pl-k">.</span>money<span class="pl-k">.</span>w(<span class="pl-c1">2.2</span>)<span class="pl-k">.</span>build());
    <span class="pl-stj">Rental</span> rental2 <span class="pl-k">=</span> mock(<span class="pl-stj">Rental</span><span class="pl-k">.</span>class);
    when(rental2<span class="pl-k">.</span>getCharge())
      .thenReturn(a<span class="pl-k">.</span>money<span class="pl-k">.</span>w(<span class="pl-c1">3.5</span>)<span class="pl-k">.</span>build());
    assertMoney(
      <span class="pl-c1">5.7</span>,
      a<span class="pl-k">.</span>customer<span class="pl-k">.</span>w(
        rental1,
        rental2)<span class="pl-k">.</span>build()<span class="pl-k">.</span>getTotalCharge());
  }
}</pre></div>

<div class="highlight highlight-java"><pre><span class="pl-s">public</span> <span class="pl-s">class</span> <span class="pl-en">CustomerTest</span> {
  <span class="pl-st">@Test</span>
  <span class="pl-s">public</span> <span class="pl-st">void</span> <span class="pl-en">chargeForTwoRentals</span>() {
    <span class="pl-stj">Rental</span> rental1 <span class="pl-k">=</span> mock(<span class="pl-stj">Rental</span><span class="pl-k">.</span>class);
    when(rental1<span class="pl-k">.</span>getCharge())
      .thenReturn(a<span class="pl-k">.</span>money<span class="pl-k">.</span>w(<span class="pl-c1">2.2</span>)<span class="pl-k">.</span>build());
    <span class="pl-stj">Rental</span> rental2 <span class="pl-k">=</span> mock(<span class="pl-stj">Rental</span><span class="pl-k">.</span>class);
    when(rental2<span class="pl-k">.</span>getCharge())
      .thenReturn(a<span class="pl-k">.</span>money<span class="pl-k">.</span>w(<span class="pl-c1">3.5</span>)<span class="pl-k">.</span>build());

    <span class="pl-stj">Customer</span> customer <span class="pl-k">=</span> a<span class="pl-k">.</span>customer<span class="pl-k">.</span>build();
    customer<span class="pl-k">.</span>addRental(rental1);
    customer<span class="pl-k">.</span>addRental(rental2);

    assertMoney(
      <span class="pl-c1">5.7</span>, customer<span class="pl-k">.</span>getTotalCharge());
  }
}</pre></div>

<div class="highlight highlight-java"><pre><span class="pl-s">public</span> <span class="pl-s">class</span> <span class="pl-en">Customer</span> {
  <span class="pl-s">private</span> <span class="pl-st">List&lt;<span class="pl-stj">Rental</span>&gt;</span> rentals <span class="pl-k">=</span>
    <span class="pl-k">new</span> <span class="pl-st">ArrayList&lt;<span class="pl-stj">Rental</span>&gt;</span>();

  <span class="pl-s">public</span> <span class="pl-st">void</span> <span class="pl-en">addRental</span>(<span class="pl-stj">Rental</span> <span class="pl-v">rental</span>) {
    rentals<span class="pl-k">.</span>add(rental);
  }

  <span class="pl-s">public</span> <span class="pl-stj">Money</span> <span class="pl-en">getTotalCharge</span>() {
    <span class="pl-stj">Money</span> total <span class="pl-k">=</span> <span class="pl-k">new</span> <span class="pl-stj">Money</span>(<span class="pl-c1">0.0</span>);
    <span class="pl-k">for</span> (<span class="pl-stj">Rental</span> rental <span class="pl-k">:</span> rentals)
      total <span class="pl-k">=</span> total<span class="pl-k">.</span>add(rental<span class="pl-k">.</span>getCharge());
    <span class="pl-k">return</span> total;
  }
}</pre></div>

<div class="highlight highlight-java"><pre><span class="pl-s">public</span> <span class="pl-s">class</span> <span class="pl-en">Customer</span> {
  <span class="pl-s">private</span> <span class="pl-st">ArrayList&lt;<span class="pl-stj">Rental</span>&gt;</span> rentals <span class="pl-k">=</span>
    <span class="pl-k">new</span> <span class="pl-st">ArrayList&lt;<span class="pl-stj">Rental</span>&gt;</span>();


  <span class="pl-s">public</span> <span class="pl-stj">Customer</span> <span class="pl-en">addRentals</span>(
    <span class="pl-stj">Rental</span>... <span class="pl-v">newRentals</span>) {
    rentals<span class="pl-k">.</span>addAll(<span class="pl-stj">Arrays</span><span class="pl-k">.</span>asList(newRentals));
    <span class="pl-k">return</span> <span class="pl-v">this</span>;
  }


  <span class="pl-s">public</span> <span class="pl-stj">Money</span> <span class="pl-en">getTotalCharge</span>() {
    <span class="pl-stj">Money</span> total <span class="pl-k">=</span> <span class="pl-k">new</span> <span class="pl-stj">Money</span>(<span class="pl-c1">0.0</span>);
    <span class="pl-k">for</span> (<span class="pl-stj">Rental</span> rental <span class="pl-k">:</span> rentals)
      total <span class="pl-k">=</span> total<span class="pl-k">.</span>add(rental<span class="pl-k">.</span>getCharge());
    <span class="pl-k">return</span> total;
  }
}</pre></div>

<div class="highlight highlight-java"><pre><span class="pl-s">public</span> <span class="pl-s">class</span> <span class="pl-en">CustomerTest</span> {
  <span class="pl-st">@Test</span>
  <span class="pl-s">public</span> <span class="pl-st">void</span> <span class="pl-en">chargeForTwoRentals</span>() {
    <span class="pl-stj">Rental</span> rental1 <span class="pl-k">=</span> mock(<span class="pl-stj">Rental</span><span class="pl-k">.</span>class);
    when(rental1<span class="pl-k">.</span>getCharge())
      .thenReturn(a<span class="pl-k">.</span>money<span class="pl-k">.</span>w(<span class="pl-c1">2.2</span>)<span class="pl-k">.</span>build());
    <span class="pl-stj">Rental</span> rental2 <span class="pl-k">=</span> mock(<span class="pl-stj">Rental</span><span class="pl-k">.</span>class);
    when(rental2<span class="pl-k">.</span>getCharge())
      .thenReturn(a<span class="pl-k">.</span>money<span class="pl-k">.</span>w(<span class="pl-c1">3.5</span>)<span class="pl-k">.</span>build());
    assertMoney(
      <span class="pl-c1">5.7</span>,

      a<span class="pl-k">.</span>customer<span class="pl-k">.</span>build()<span class="pl-k">.</span>addRentals(
        rental1, rental2)<span class="pl-k">.</span>getTotalCharge());

  }
}</pre></div>

<h3>
<a id="creating-stubs" class="anchor" href="#creating-stubs" aria-hidden="true"><span class="octicon octicon-link"></span></a>Creating Stubs</h3>

<h4>
<a id="create-stub-return" class="anchor" href="#create-stub-return" aria-hidden="true"><span class="octicon octicon-link"></span></a>Create, Stub, Return</h4>

<div class="highlight highlight-java"><pre><span class="pl-s">public</span> <span class="pl-s">class</span> <span class="pl-en">MockitoExtensions</span> {
  <span class="pl-st">@SuppressWarnings</span>(<span class="pl-s1"><span class="pl-pds">"</span>unchecked<span class="pl-pds">"</span></span>)
  <span class="pl-s">public</span> <span class="pl-s">static</span> <span class="pl-st">&lt;<span class="pl-stj">T</span>&gt;</span> <span class="pl-stj">T</span> <span class="pl-en">create</span>(
    <span class="pl-stj">Object</span> <span class="pl-v">methodCall</span>) {
    when(methodCall)
      .thenReturn(
        <span class="pl-stj">StubBuilder</span><span class="pl-k">.</span>current<span class="pl-k">.</span>returnValue);
    <span class="pl-k">return</span> (<span class="pl-stj">T</span>)
      <span class="pl-stj">StubBuilder</span><span class="pl-k">.</span>current<span class="pl-k">.</span>mockInstance;
  }
  <span class="pl-s">public</span> <span class="pl-s">static</span> <span class="pl-st">&lt;<span class="pl-stj">T</span>&gt;</span> <span class="pl-st">StubBuilder&lt;<span class="pl-stj">T</span>&gt;</span> <span class="pl-en">stub</span>(
    <span class="pl-st">Class&lt;<span class="pl-stj">T</span>&gt;</span> <span class="pl-v">klass</span>) {
    <span class="pl-k">return</span> <span class="pl-k">new</span> <span class="pl-st">StubBuilder&lt;<span class="pl-stj">T</span>&gt;</span>(mock(klass));
  }
  <span class="pl-s">public</span> <span class="pl-s">static</span> <span class="pl-s">class</span> <span class="pl-en">StubBuilder</span>&lt;T&gt; {
    <span class="pl-s">public</span> <span class="pl-s">static</span> <span class="pl-stj">StubBuilder</span> current;
    <span class="pl-s">public</span> <span class="pl-s">final</span> <span class="pl-stj">T</span> mockInstance;
    <span class="pl-s">private</span> <span class="pl-stj">Object</span> returnValue;
    <span class="pl-s">public</span> <span class="pl-en">StubBuilder</span>(<span class="pl-stj">T</span> <span class="pl-v">mockInstance</span>) {
      current <span class="pl-k">=</span> <span class="pl-v">this</span>;
      <span class="pl-v">this</span><span class="pl-k">.</span>mockInstance <span class="pl-k">=</span> mockInstance;
    }
    <span class="pl-s">public</span> <span class="pl-stj">T</span> <span class="pl-en">from</span>() {
      <span class="pl-k">return</span> mockInstance;
    }
    <span class="pl-s">public</span> <span class="pl-st">StubBuilder&lt;<span class="pl-stj">T</span>&gt;</span> <span class="pl-en">returning</span>(
      <span class="pl-stj">Object</span> <span class="pl-v">returnValue</span>) {
      <span class="pl-v">this</span><span class="pl-k">.</span>returnValue <span class="pl-k">=</span> returnValue;
      <span class="pl-k">return</span> <span class="pl-v">this</span>;
    }
  }
}</pre></div>

<div class="highlight highlight-java"><pre><span class="pl-s">public</span> <span class="pl-s">class</span> <span class="pl-en">CustomerTest</span> {
  <span class="pl-st">@Test</span>
  <span class="pl-s">public</span> <span class="pl-st">void</span> <span class="pl-en">chargeForTwoRentals</span>() {
    assertMoney(
      <span class="pl-c1">5.7</span>,
      a<span class="pl-k">.</span>customer<span class="pl-k">.</span>build()<span class="pl-k">.</span>addRentals(
        create(
          stub(<span class="pl-stj">Rental</span><span class="pl-k">.</span>class)
          .returning(a<span class="pl-k">.</span>money<span class="pl-k">.</span>w(<span class="pl-c1">2.2</span>)<span class="pl-k">.</span>build())
          .from()<span class="pl-k">.</span>getCharge()),
        create(
          stub(<span class="pl-stj">Rental</span><span class="pl-k">.</span>class)
          .returning(a<span class="pl-k">.</span>money<span class="pl-k">.</span>w(<span class="pl-c1">3.5</span>)<span class="pl-k">.</span>build())
          .from()<span class="pl-k">.</span>getCharge()))
      .getTotalCharge());
  }
}</pre></div>

<h4>
<a id="create-lambda-return" class="anchor" href="#create-lambda-return" aria-hidden="true"><span class="octicon octicon-link"></span></a>Create, Lambda, Return</h4>

<div class="highlight highlight-java"><pre><span class="pl-s">public</span> <span class="pl-s">class</span> <span class="pl-en">MockitoExtensions</span> {
  <span class="pl-s">public</span> <span class="pl-s">static</span> <span class="pl-st">&lt;<span class="pl-stj">T</span>&gt;</span> <span class="pl-stj">T</span> <span class="pl-en">stub</span>(
    <span class="pl-st">Class&lt;<span class="pl-stj">T</span>&gt;</span> <span class="pl-v">klass</span>,
    <span class="pl-st">Function&lt;<span class="pl-stj">T</span>,<span class="pl-stj">Object</span>&gt;</span> <span class="pl-v">f</span>,
    <span class="pl-stj">Object</span> <span class="pl-v">returnVal</span>) {
    <span class="pl-k">try</span> {
      <span class="pl-stj">T</span> result <span class="pl-k">=</span> mock(klass);
      when(f<span class="pl-k">.</span>apply(result))
        .thenReturn(returnVal);
      <span class="pl-k">return</span> result;
    } <span class="pl-k">catch</span> (<span class="pl-stj">Exception</span> e) {
      <span class="pl-k">throw</span> <span class="pl-k">new</span> <span class="pl-stj">RuntimeException</span>(e);
    }
  }
}</pre></div>

<div class="highlight highlight-java"><pre><span class="pl-s">public</span> <span class="pl-s">class</span> <span class="pl-en">CustomerTest</span> {
  <span class="pl-st">@Test</span>
  <span class="pl-s">public</span> <span class="pl-st">void</span> <span class="pl-en">chargeForTwoRentals</span>() {
    assertMoney(
      <span class="pl-c1">5.7</span>,
      a<span class="pl-k">.</span>customer<span class="pl-k">.</span>build()<span class="pl-k">.</span>addRentals(

        stub(<span class="pl-stj">Rental</span><span class="pl-k">.</span>class,
             s <span class="pl-k">-</span><span class="pl-k">&gt;</span> s<span class="pl-k">.</span>getCharge(),
             a<span class="pl-k">.</span>money<span class="pl-k">.</span>w(<span class="pl-c1">2.2</span>)<span class="pl-k">.</span>build()),
        stub(<span class="pl-stj">Rental</span><span class="pl-k">.</span>class,
             s <span class="pl-k">-</span><span class="pl-k">&gt;</span> s<span class="pl-k">.</span>getCharge(),
             a<span class="pl-k">.</span>money<span class="pl-k">.</span>w(<span class="pl-c1">3.5</span>)<span class="pl-k">.</span>build()))

      .getTotalCharge());
  }
}</pre></div>

<h3>
<a id="more-than-creation" class="anchor" href="#more-than-creation" aria-hidden="true"><span class="octicon octicon-link"></span></a>More Than Creation</h3>

<h1>
<a id="closing-thoughts" class="anchor" href="#closing-thoughts" aria-hidden="true"><span class="octicon octicon-link"></span></a>Closing Thoughts</h1>

<h2>
<a id="broad-stack-tests" class="anchor" href="#broad-stack-tests" aria-hidden="true"><span class="octicon octicon-link"></span></a>Broad Stack Tests</h2>

<h2>
<a id="test-pyramid" class="anchor" href="#test-pyramid" aria-hidden="true"><span class="octicon octicon-link"></span></a>Test Pyramid</h2>

<h2>
<a id="final-thoughts-on-roi" class="anchor" href="#final-thoughts-on-roi" aria-hidden="true"><span class="octicon octicon-link"></span></a>Final Thoughts On ROI</h2>

<h2>
<a id="more" class="anchor" href="#more" aria-hidden="true"><span class="octicon octicon-link"></span></a>More...</h2>

<h1>
<a id="foreword" class="anchor" href="#foreword" aria-hidden="true"><span class="octicon octicon-link"></span></a>Foreword</h1>

<h1>
<a id="preface" class="anchor" href="#preface" aria-hidden="true"><span class="octicon octicon-link"></span></a>Preface</h1>

<h3>
<a id="why-test" class="anchor" href="#why-test" aria-hidden="true"><span class="octicon octicon-link"></span></a>Why Test?</h3>

<h3>
<a id="who-should-read-this-book" class="anchor" href="#who-should-read-this-book" aria-hidden="true"><span class="octicon octicon-link"></span></a>Who Should Read This Book</h3>

<h3>
<a id="building-on-the-foundations-laid-by-others" class="anchor" href="#building-on-the-foundations-laid-by-others" aria-hidden="true"><span class="octicon octicon-link"></span></a>Building on the Foundations Laid by Others</h3>

<h1>
<a id="more-1" class="anchor" href="#more-1" aria-hidden="true"><span class="octicon octicon-link"></span></a>More...</h1>
      </section>
    </div>

    <!-- FOOTER  -->
    <div id="footer_wrap" class="outer">
      <footer class="inner">
        <p class="copyright">wewut-code maintained by <a href="https://github.com/jaycfields">jaycfields</a></p>
        <p>Published with <a href="http://pages.github.com">GitHub Pages</a></p>
      </footer>
    </div>

    

  </body>
</html>
